import{_ as pe,r as w,a as v,n as ce,o as be,e as i,b,g as f,h as s,d as l,v as V,w as a,k as u,F as O,t as fe,q as Q}from"./index-DywBidbG.js";const _e={class:"cc-protection-tab"},ve={class:"tab-header"},he={class:"tab-actions"},ge={key:0,class:"tab-content"},ye={key:0,class:"form-tip"},Ce={key:1,class:"form-tip"},Ve={key:2,class:"form-tip"},ke={key:0,class:"url-rules"},we={class:"section-header"},Re={key:1,class:"whitelist"},Ue={class:"section-header"},xe={key:1,class:"tab-disabled"},Pe={class:"dialog-footer"},Te={class:"dialog-footer"},qe={__name:"CcProtectionTab",props:{protectionId:{type:[Number,String],required:!0},protectionData:{type:Object,required:!0}},emits:["update"],setup($,{emit:M}){const k=$,H=M,o=w({enabled:!1,mode:"normal",qpsThreshold:100,statisticsPeriod:10,blockDuration:300,action:"block",urlRules:[],whitelist:[]}),g=v(!1),R=v(!1),U=v(-1),D=v(null),d=w({url:"",qpsThreshold:50,action:"block",enabled:!0}),z=w({url:[{required:!0,message:"请输入URL",trigger:"blur"}],qpsThreshold:[{required:!0,message:"请输入QPS阈值",trigger:"blur"},{type:"number",min:1,message:"QPS阈值必须大于0",trigger:"blur"}],action:[{required:!0,message:"请选择防护动作",trigger:"change"}]}),y=v(!1),x=v(!1),P=v(-1),I=v(null),c=w({ip:"",comment:""}),G=w({ip:[{required:!0,message:"请输入IP或CIDR",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?$/,message:"请输入有效的IP或CIDR格式",trigger:"blur"}]}),E=()=>{if(k.protectionData&&k.protectionData.securityConfig&&k.protectionData.securityConfig.ccProtection){const t=k.protectionData.securityConfig.ccProtection;o.enabled=t.enabled||!1,o.mode=t.mode||"normal",o.qpsThreshold=t.qpsThreshold||100,o.statisticsPeriod=t.statisticsPeriod||10,o.blockDuration=t.blockDuration||300,o.action=t.action||"block",t.urlRules&&Array.isArray(t.urlRules)&&(o.urlRules=[...t.urlRules]),t.whitelist&&Array.isArray(t.whitelist)&&(o.whitelist=[...t.whitelist])}},J=t=>{o.enabled=t,_()},K=t=>{o.mode=t,_()},T=()=>{_()},X=t=>{_()},Y=()=>{R.value=!1,U.value=-1,Object.assign(d,{url:"",qpsThreshold:50,action:"block",enabled:!0}),g.value=!0},Z=(t,e)=>{R.value=!0,U.value=e,Object.assign(d,{url:t.url,qpsThreshold:t.qpsThreshold,action:t.action,enabled:t.enabled}),g.value=!0},ee=t=>{Q.confirm("确定要删除该URL规则吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.urlRules.splice(t,1),_()}).catch(()=>{})},le=async()=>{if(D.value)try{await D.value.validate();const t={url:d.url,qpsThreshold:d.qpsThreshold,action:d.action,enabled:d.enabled};R.value&&U.value!==-1?o.urlRules[U.value]=t:o.urlRules.push(t),g.value=!1,_()}catch(t){console.error("URL规则表单验证失败:",t)}},te=()=>{x.value=!1,P.value=-1,Object.assign(c,{ip:"",comment:""}),y.value=!0},oe=(t,e)=>{x.value=!0,P.value=e,Object.assign(c,{ip:t.ip,comment:t.comment}),y.value=!0},ae=t=>{Q.confirm("确定要删除该白名单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.whitelist.splice(t,1),_()}).catch(()=>{})},ne=async()=>{if(I.value)try{await I.value.validate();const t={ip:c.ip,comment:c.comment};x.value&&P.value!==-1?o.whitelist[P.value]=t:o.whitelist.push(t),y.value=!1,_()}catch(t){console.error("白名单表单验证失败:",t)}},se=t=>({block:"封禁",captcha:"人机验证",monitor:"监控"})[t]||t,ie=t=>({block:"danger",captcha:"warning",monitor:"info"})[t]||"info",_=()=>{const t={enabled:o.enabled,mode:o.mode,qpsThreshold:o.qpsThreshold,statisticsPeriod:o.statisticsPeriod,blockDuration:o.blockDuration,action:o.action,urlRules:o.urlRules,whitelist:o.whitelist};H("update","ccProtection",t)};return ce(()=>k.protectionData,()=>{E()},{deep:!0}),be(()=>{E()}),(t,e)=>{const S=i("el-switch"),de=i("el-divider"),L=i("el-radio"),ue=i("el-radio-group"),r=i("el-form-item"),q=i("el-input-number"),C=i("el-option"),N=i("el-select"),A=i("el-form"),m=i("el-button"),p=i("el-table-column"),re=i("el-tag"),W=i("el-table"),me=i("el-empty"),B=i("el-input"),j=i("el-dialog");return f(),b(O,null,[s("div",_e,[s("div",ve,[e[16]||(e[16]=s("div",{class:"tab-title"},[s("h3",null,"CC攻击防护"),s("p",{class:"tab-description"}," CC攻击防护可以防止恶意用户或爬虫短时间内发起大量HTTP请求，耗尽服务器资源，导致正常用户无法访问 ")],-1)),s("div",he,[l(S,{modelValue:o.enabled,"onUpdate:modelValue":e[0]||(e[0]=n=>o.enabled=n),"active-text":"启用","inactive-text":"禁用",onChange:J},null,8,["modelValue"])])]),l(de),o.enabled?(f(),b("div",ge,[l(A,{model:o,"label-width":"120px"},{default:a(()=>[l(r,{label:"防护模式"},{default:a(()=>[l(ue,{modelValue:o.mode,"onUpdate:modelValue":e[1]||(e[1]=n=>o.mode=n),onChange:K},{default:a(()=>[l(L,{label:"normal"},{default:a(()=>e[17]||(e[17]=[u("正常")])),_:1,__:[17]}),l(L,{label:"strict"},{default:a(()=>e[18]||(e[18]=[u("严格")])),_:1,__:[18]}),l(L,{label:"custom"},{default:a(()=>e[19]||(e[19]=[u("自定义")])),_:1,__:[19]})]),_:1},8,["modelValue"]),o.mode==="normal"?(f(),b("div",ye," 正常模式：适用于大多数网站，可防御一般的CC攻击 ")):V("",!0),o.mode==="strict"?(f(),b("div",Ce," 严格模式：适用于经常遭受CC攻击的网站，防护更严格，可能会影响少量正常用户 ")):V("",!0),o.mode==="custom"?(f(),b("div",Ve," 自定义模式：根据需求自定义CC防护规则 ")):V("",!0)]),_:1}),o.mode==="custom"?(f(),b(O,{key:0},[l(r,{label:"QPS阈值"},{default:a(()=>[l(q,{modelValue:o.qpsThreshold,"onUpdate:modelValue":e[2]||(e[2]=n=>o.qpsThreshold=n),min:10,max:1e4,onChange:T},null,8,["modelValue"]),e[20]||(e[20]=s("span",{class:"input-suffix"},"次/秒",-1)),e[21]||(e[21]=s("div",{class:"form-tip"}," 当单个IP在1秒内的请求次数超过该阈值时触发防护 ",-1))]),_:1,__:[20,21]}),l(r,{label:"统计周期"},{default:a(()=>[l(q,{modelValue:o.statisticsPeriod,"onUpdate:modelValue":e[3]||(e[3]=n=>o.statisticsPeriod=n),min:1,max:60,onChange:T},null,8,["modelValue"]),e[22]||(e[22]=s("span",{class:"input-suffix"},"秒",-1)),e[23]||(e[23]=s("div",{class:"form-tip"}," 统计单个IP请求次数的时间周期 ",-1))]),_:1,__:[22,23]}),l(r,{label:"封禁时长"},{default:a(()=>[l(q,{modelValue:o.blockDuration,"onUpdate:modelValue":e[4]||(e[4]=n=>o.blockDuration=n),min:5,max:1800,onChange:T},null,8,["modelValue"]),e[24]||(e[24]=s("span",{class:"input-suffix"},"秒",-1)),e[25]||(e[25]=s("div",{class:"form-tip"}," 触发防护后，封禁IP的时长 ",-1))]),_:1,__:[24,25]}),l(r,{label:"防护动作"},{default:a(()=>[l(N,{modelValue:o.action,"onUpdate:modelValue":e[5]||(e[5]=n=>o.action=n),style:{width:"200px"},onChange:T},{default:a(()=>[l(C,{label:"封禁",value:"block"}),l(C,{label:"人机验证",value:"captcha"}),l(C,{label:"监控",value:"monitor"})]),_:1},8,["modelValue"]),e[26]||(e[26]=s("div",{class:"form-tip"}," 触发防护后执行的动作 ",-1))]),_:1,__:[26]})],64)):V("",!0)]),_:1},8,["model"]),o.enabled?(f(),b("div",ke,[s("div",we,[e[28]||(e[28]=s("h4",null,"URL防护规则",-1)),l(m,{type:"primary",onClick:Y},{default:a(()=>e[27]||(e[27]=[u("添加规则")])),_:1,__:[27]})]),l(W,{data:o.urlRules,border:"",style:{width:"100%"}},{default:a(()=>[l(p,{label:"序号",width:"80",type:"index"}),l(p,{label:"URL",prop:"url","min-width":"200"}),l(p,{label:"QPS阈值",prop:"qpsThreshold",width:"120"}),l(p,{label:"防护动作",width:"120"},{default:a(({row:n})=>[l(re,{type:ie(n.action)},{default:a(()=>[u(fe(se(n.action)),1)]),_:2},1032,["type"])]),_:1}),l(p,{label:"状态",width:"100"},{default:a(({row:n})=>[l(S,{modelValue:n.enabled,"onUpdate:modelValue":h=>n.enabled=h,onChange:()=>X(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(p,{label:"操作",width:"150"},{default:a(({row:n,$index:h})=>[l(m,{type:"primary",link:"",onClick:F=>Z(n,h)},{default:a(()=>e[29]||(e[29]=[u("编辑")])),_:2,__:[29]},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:F=>ee(h)},{default:a(()=>e[30]||(e[30]=[u("删除")])),_:2,__:[30]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):V("",!0),o.enabled?(f(),b("div",Re,[s("div",Ue,[e[32]||(e[32]=s("h4",null,"IP白名单",-1)),l(m,{type:"primary",onClick:te},{default:a(()=>e[31]||(e[31]=[u("添加白名单")])),_:1,__:[31]})]),l(W,{data:o.whitelist,border:"",style:{width:"100%"}},{default:a(()=>[l(p,{label:"序号",width:"80",type:"index"}),l(p,{label:"IP/CIDR",prop:"ip","min-width":"180"}),l(p,{label:"备注",prop:"comment","min-width":"200"}),l(p,{label:"操作",width:"150"},{default:a(({row:n,$index:h})=>[l(m,{type:"primary",link:"",onClick:F=>oe(n,h)},{default:a(()=>e[33]||(e[33]=[u("编辑")])),_:2,__:[33]},1032,["onClick"]),l(m,{type:"danger",link:"",onClick:F=>ae(h)},{default:a(()=>e[34]||(e[34]=[u("删除")])),_:2,__:[34]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):V("",!0)])):(f(),b("div",xe,[l(me,{description:"CC攻击防护功能已禁用，请先启用该功能"})]))]),l(j,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=n=>g.value=n),title:R.value?"编辑URL规则":"添加URL规则",width:"500px"},{footer:a(()=>[s("span",Pe,[l(m,{onClick:e[10]||(e[10]=n=>g.value=!1)},{default:a(()=>e[35]||(e[35]=[u("取消")])),_:1,__:[35]}),l(m,{type:"primary",onClick:le},{default:a(()=>e[36]||(e[36]=[u("确定")])),_:1,__:[36]})])]),default:a(()=>[l(A,{ref_key:"urlRuleFormRef",ref:D,model:d,rules:z,"label-width":"100px"},{default:a(()=>[l(r,{label:"URL",prop:"url"},{default:a(()=>[l(B,{modelValue:d.url,"onUpdate:modelValue":e[6]||(e[6]=n=>d.url=n),placeholder:"请输入URL，支持通配符*"},null,8,["modelValue"])]),_:1}),l(r,{label:"QPS阈值",prop:"qpsThreshold"},{default:a(()=>[l(q,{modelValue:d.qpsThreshold,"onUpdate:modelValue":e[7]||(e[7]=n=>d.qpsThreshold=n),min:1,max:1e4,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"防护动作",prop:"action"},{default:a(()=>[l(N,{modelValue:d.action,"onUpdate:modelValue":e[8]||(e[8]=n=>d.action=n),style:{width:"200px"}},{default:a(()=>[l(C,{label:"封禁",value:"block"}),l(C,{label:"人机验证",value:"captcha"}),l(C,{label:"监控",value:"monitor"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"状态"},{default:a(()=>[l(S,{modelValue:d.enabled,"onUpdate:modelValue":e[9]||(e[9]=n=>d.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:y.value,"onUpdate:modelValue":e[15]||(e[15]=n=>y.value=n),title:x.value?"编辑白名单":"添加白名单",width:"500px"},{footer:a(()=>[s("span",Te,[l(m,{onClick:e[14]||(e[14]=n=>y.value=!1)},{default:a(()=>e[37]||(e[37]=[u("取消")])),_:1,__:[37]}),l(m,{type:"primary",onClick:ne},{default:a(()=>e[38]||(e[38]=[u("确定")])),_:1,__:[38]})])]),default:a(()=>[l(A,{ref_key:"whitelistFormRef",ref:I,model:c,rules:G,"label-width":"100px"},{default:a(()=>[l(r,{label:"IP/CIDR",prop:"ip"},{default:a(()=>[l(B,{modelValue:c.ip,"onUpdate:modelValue":e[12]||(e[12]=n=>c.ip=n),placeholder:"请输入IP或CIDR，例如：192.168.1.1或192.168.1.0/24"},null,8,["modelValue"])]),_:1}),l(r,{label:"备注",prop:"comment"},{default:a(()=>[l(B,{modelValue:c.comment,"onUpdate:modelValue":e[13]||(e[13]=n=>c.comment=n),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}},Ie=pe(qe,[["__scopeId","data-v-d307cd10"]]);export{Ie as default};
