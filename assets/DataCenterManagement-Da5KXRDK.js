import{_ as be,r as j,a as m,c as L,o as ye,b as we,d as t,w as l,e as i,R as O,D as V,f as ke,g as S,h as p,i as H,j as Ve,k as s,l as K,t as w,u as Ce,m as xe,C as G,E as f,n as J}from"./index-BNlzmaqd.js";const he={class:"datacenter-management"},De={class:"card-header"},Pe={class:"search-area"},Ee={class:"ellipsis-cell"},Ie={class:"ellipsis-cell"},Te={class:"mt-2 flex justify-end"},Se={class:"dialog-footer"},Ue={class:"text-xs text-gray-500 mt-2"},$e={__name:"DataCenterManagement",setup(Re){const g=j({name:""}),U=m([]),C=m(!1),D=m(null),x=m(!1),$=m([]),R=m([]),b=m(!1),P=m(),k=m(!1),h=m(null),r=j({id:"",name:"",regionId:"",status:"active",contactPerson:"",contactPhone:"",contactEmail:"",remark:"",createTime:"",createAccount:"",updateTime:"",updateAccount:""}),Q={name:[{required:!0,message:"请输入机房名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],regionId:[{required:!0,message:"请选择地域",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],contactPerson:[{required:!1,message:"请输入联系人",trigger:"blur"}],contactPhone:[{required:!1,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],contactEmail:[{required:!1,message:"请输入联系邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},E=m(!1),v=m([]),_=m({prop:"",order:""});function W(){v.value=[]}function X(){E.value=!1}const Y=L(()=>R.value),Z=async()=>{try{R.value=await O.getRegionTree(),$.value=await O.getRegions()}catch(o){console.error("获取地域数据失败:",o)}},z=o=>{const e=$.value.find(n=>n.id===o);return e?e.name:o},I=async()=>{C.value=!0;try{U.value=await V.getDataCenters(),C.value=!1}catch(o){console.error("获取机房数据失败:",o),C.value=!1}},ee=L(()=>{let o=U.value;if(g.name){const e=g.name.toLowerCase();o=o.filter(n=>n.name.toLowerCase().includes(e))}return v.value.length&&(o=o.filter(e=>v.value.includes(e.status))),_.value.prop&&_.value.order&&(o=[...o].sort((e,n)=>{let d=e[_.value.prop],u=n[_.value.prop];return(_.value.prop==="createTime"||_.value.prop==="updateTime")&&(d=new Date(d).getTime(),u=new Date(u).getTime()),_.value.order==="ascending"?d>u?1:-1:d<u?1:-1})),o}),T=()=>{console.log("搜索:",g)},te=()=>{g.name="",v.value=[],T()},le=async()=>{x.value=!1,Object.assign(r,{id:"",name:"",regionId:"",status:"active",contactPerson:"",contactPhone:"",contactEmail:"",remark:"",createTime:"",createAccount:"",updateTime:"",updateAccount:""}),b.value=!0},ae=o=>{x.value=!0,Object.assign(r,{id:o.id,name:o.name,regionId:o.regionId,status:o.status,contactPerson:o.contactPerson,contactPhone:o.contactPhone,contactEmail:o.contactEmail,remark:o.remark}),b.value=!0},oe=async o=>{try{const e=await G.getClustersByDataCenterId(o.id);if(e.length>0){J.alert(`该机房已被${e.length}个集群关联使用，无法删除。请先移除关联集群再进行删除操作。`,"无法删除",{type:"warning"});return}h.value=o,k.value=!0}catch(e){console.error("检查关联集群失败:",e),f.error("操作失败")}},ne=async()=>{try{await V.deleteDataCenter(h.value.id),f.success("删除成功"),I()}catch(o){console.error("删除机房失败:",o),f.error("删除机房失败")}k.value=!1},re=async o=>{const e=o.status==="active"?"disabled":"active";try{await V.updateDataCenter(o.id,{status:e}),o.status=e,f.success(`机房已${e==="active"?"启用":"禁用"}`)}catch(n){console.error("更新机房状态失败:",n),f.error("更新机房状态失败")}},se=async()=>{P.value.validate(async o=>{if(o)try{x.value?(await V.updateDataCenter(r.id,r),f.success("编辑成功")):(await V.addDataCenter(r),f.success("新增成功")),b.value=!1,I()}catch(e){console.error("提交表单失败:",e),f.error("提交表单失败")}})},ie=()=>{var o;(o=P.value)==null||o.resetFields()},de=async o=>{D.value=o.id;try{const e=await G.getClustersByDataCenterId(o.id);if(e.length===0){f.info("当前机房暂无关联集群");return}const n=e.map(d=>`<li>${d.displayName} (${d.name})</li>`).join("");J.alert(`<div>
        <p>机房 <b>${o.name}</b> 关联的集群列表:</p>
        <ul>${n}</ul>
      </div>`,"关联集群",{dangerouslyUseHTMLString:!0})}catch(e){console.error("获取关联集群失败:",e),f.error("获取关联集群失败")}finally{D.value=null}};return ye(async()=>{await Z(),await I()}),(o,e)=>{const n=i("el-button"),d=i("el-input"),u=i("el-form-item"),A=i("el-form"),c=i("el-table-column"),B=i("el-tooltip"),F=i("el-checkbox"),ue=i("el-checkbox-group"),ce=i("el-icon"),me=i("el-popover"),pe=i("el-tag"),fe=i("el-table"),ge=i("el-card"),ve=i("el-cascader"),q=i("el-radio"),_e=i("el-radio-group"),M=i("el-dialog"),N=ke("loading");return S(),we("div",he,[t(ge,{class:"box-card"},{header:l(()=>[p("div",De,[e[15]||(e[15]=p("span",null,"机房管理",-1)),t(n,{type:"primary",onClick:le},{default:l(()=>e[14]||(e[14]=[s("新建机房")])),_:1,__:[14]})])]),default:l(()=>[p("div",Pe,[t(A,{inline:!0,model:g},{default:l(()=>[t(u,{label:"名称"},{default:l(()=>[t(d,{modelValue:g.name,"onUpdate:modelValue":e[0]||(e[0]=a=>g.name=a),placeholder:"请输入机房名称",clearable:"",style:{"max-width":"260px"},onKeyup:Ve(T,["enter"])},null,8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(n,{type:"primary",onClick:T},{default:l(()=>e[16]||(e[16]=[s("搜索")])),_:1,__:[16]}),t(n,{onClick:te},{default:l(()=>e[17]||(e[17]=[s("重置")])),_:1,__:[17]})]),_:1})]),_:1},8,["model"])]),H((S(),K(fe,{data:ee.value,style:{width:"100%","min-height":"500px","margin-top":"20px"},border:"",stripe:"","max-height":"700","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2},"row-class-name":"dense-row"},{empty:l(()=>e[26]||(e[26]=[p("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:l(()=>[t(c,{prop:"id",label:"ID",width:"180",fixed:"left"}),t(c,{prop:"name",label:"名称",width:"150"},{default:l(a=>[t(B,{effect:"dark",content:a.row.name,placement:"top"},{default:l(()=>[p("span",Ee,w(a.row.name),1)]),_:2},1032,["content"])]),_:1}),t(c,{prop:"regionId",label:"地域",width:"120"},{default:l(a=>[t(B,{effect:"dark",content:z(a.row.regionId),placement:"top"},{default:l(()=>[p("span",Ie,w(z(a.row.regionId)),1)]),_:2},1032,["content"])]),_:1}),t(c,{prop:"status",label:"状态",width:"100"},{header:l(()=>[e[22]||(e[22]=p("span",null,"状态",-1)),t(me,{placement:"bottom",width:"160",trigger:"click",visible:E.value,"onUpdate:visible":e[2]||(e[2]=a=>E.value=a)},{reference:l(()=>[t(ce,{color:v.value.length?"#409EFF":"#909399",class:"ml-1 cursor-pointer"},{default:l(()=>[t(Ce(xe))]),_:1},8,["color"])]),default:l(()=>[p("div",null,[t(ue,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a)},{default:l(()=>[t(F,{label:"active"},{default:l(()=>e[18]||(e[18]=[s("启用")])),_:1,__:[18]}),t(F,{label:"disabled"},{default:l(()=>e[19]||(e[19]=[s("禁用")])),_:1,__:[19]})]),_:1},8,["modelValue"]),p("div",Te,[t(n,{size:"small",onClick:W},{default:l(()=>e[20]||(e[20]=[s("重置")])),_:1,__:[20]}),t(n,{size:"small",type:"primary",onClick:X},{default:l(()=>e[21]||(e[21]=[s("确定")])),_:1,__:[21]})])])]),_:1},8,["visible"])]),default:l(a=>[t(pe,{type:a.row.status==="active"?"success":"danger"},{default:l(()=>[s(w(a.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"contactPerson",label:"联系人",width:"120"}),t(c,{prop:"contactPhone",label:"联系电话",width:"140"}),t(c,{prop:"contactEmail",label:"联系邮箱",width:"180"}),t(c,{label:"关联集群",width:"100"},{default:l(a=>[H((S(),K(n,{type:"info",link:"",size:"small",onClick:y=>de(a.row)},{default:l(()=>e[23]||(e[23]=[s(" 查看关联 ")])),_:2,__:[23]},1032,["onClick"])),[[N,D.value===a.row.id,void 0,{inline:!0}]])]),_:1}),t(c,{prop:"remark",label:"备注","min-width":"200","show-overflow-tooltip":""}),t(c,{prop:"createTime",label:"创建时间",width:"160",sortable:""}),t(c,{prop:"createAccount",label:"创建人",width:"120"}),t(c,{prop:"updateTime",label:"修改时间",width:"160",sortable:""}),t(c,{prop:"updateAccount",label:"修改人",width:"120"}),t(c,{label:"操作",width:"180",fixed:"right"},{default:l(a=>[t(n,{type:"primary",link:"",size:"small",onClick:y=>ae(a.row)},{default:l(()=>e[24]||(e[24]=[s("编辑")])),_:2,__:[24]},1032,["onClick"]),t(n,{type:a.row.status==="active"?"danger":"success",link:"",size:"small",onClick:y=>re(a.row)},{default:l(()=>[s(w(a.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(n,{type:"danger",link:"",size:"small",onClick:y=>oe(a.row)},{default:l(()=>e[25]||(e[25]=[s("删除")])),_:2,__:[25]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,C.value]])]),_:1}),t(M,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=a=>b.value=a),title:x.value?"编辑机房":"新建机房",width:"600px","close-on-click-modal":!1,onClose:ie},{footer:l(()=>[p("span",Se,[t(n,{onClick:e[10]||(e[10]=a=>b.value=!1)},{default:l(()=>e[29]||(e[29]=[s("取消")])),_:1,__:[29]}),t(n,{type:"primary",onClick:se},{default:l(()=>e[30]||(e[30]=[s("确定")])),_:1,__:[30]})])]),default:l(()=>[t(A,{model:r,rules:Q,ref_key:"formRef",ref:P,"label-width":"100px"},{default:l(()=>[t(u,{label:"名称",prop:"name"},{default:l(()=>[t(d,{modelValue:r.name,"onUpdate:modelValue":e[3]||(e[3]=a=>r.name=a),placeholder:"请输入机房名称"},null,8,["modelValue"])]),_:1}),t(u,{label:"地域",prop:"regionId"},{default:l(()=>[t(ve,{modelValue:r.regionId,"onUpdate:modelValue":e[4]||(e[4]=a=>r.regionId=a),options:Y.value,props:{checkStrictly:!0,value:"id",label:"name",emitPath:!1,expandTrigger:"hover"},placeholder:"请选择地域",clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(u,{label:"状态",prop:"status"},{default:l(()=>[t(_e,{modelValue:r.status,"onUpdate:modelValue":e[5]||(e[5]=a=>r.status=a)},{default:l(()=>[t(q,{label:"active"},{default:l(()=>e[27]||(e[27]=[s("启用")])),_:1,__:[27]}),t(q,{label:"disabled"},{default:l(()=>e[28]||(e[28]=[s("禁用")])),_:1,__:[28]})]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"联系人",prop:"contactPerson"},{default:l(()=>[t(d,{modelValue:r.contactPerson,"onUpdate:modelValue":e[6]||(e[6]=a=>r.contactPerson=a),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),t(u,{label:"联系电话",prop:"contactPhone"},{default:l(()=>[t(d,{modelValue:r.contactPhone,"onUpdate:modelValue":e[7]||(e[7]=a=>r.contactPhone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),t(u,{label:"联系邮箱",prop:"contactEmail"},{default:l(()=>[t(d,{modelValue:r.contactEmail,"onUpdate:modelValue":e[8]||(e[8]=a=>r.contactEmail=a),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),t(u,{label:"备注",prop:"remark"},{default:l(()=>[t(d,{modelValue:r.remark,"onUpdate:modelValue":e[9]||(e[9]=a=>r.remark=a),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(M,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=a=>k.value=a),title:"确认删除",width:"400px"},{footer:l(()=>[t(n,{onClick:e[12]||(e[12]=a=>k.value=!1)},{default:l(()=>e[33]||(e[33]=[s("取消")])),_:1,__:[33]}),t(n,{type:"danger",onClick:ne},{default:l(()=>e[34]||(e[34]=[s("确认删除")])),_:1,__:[34]})]),default:l(()=>{var a,y;return[p("div",null,[e[31]||(e[31]=s("确定要删除机房 ")),p("b",null,w((a=h.value)==null?void 0:a.name),1),e[32]||(e[32]=s(" 吗？"))]),p("div",Ue,"ID: "+w((y=h.value)==null?void 0:y.id),1)]}),_:1},8,["modelValue"])])}}},Ae=be($e,[["__scopeId","data-v-92830cca"]]);export{Ae as default};
