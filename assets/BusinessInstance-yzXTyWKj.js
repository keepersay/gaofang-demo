import{_ as Ve,a as _,r as oe,c as ne,n as j,e as m,l as b,g as y,w as s,d as a,h as u,i as X,b as R,F as le,p as se,t as v,I as ae,v as A,k as i,J as U,E as g,K as ke,C as we,q as Pe,o as xe,j as De,u as he,L as Se,f as Ae}from"./index-C5hzwVST.js";const Ue={style:{color:"#999"}},Be={style:{display:"flex","justify-content":"space-between","align-items":"center"}},$e={key:0,class:"form-tip"},Re={style:{"margin-top":"20px",display:"flex","justify-content":"space-between"}},ze={__name:"BusinessInstanceModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(P,{emit:M}){const w=P,h=M,x=_(!1),V=oe({customers:!1,orders:!1,regions:!1,clusterGroups:!1,resourceCheck:!1}),C=_({}),G=ne({get:()=>w.modelValue,set:n=>h("update:modelValue",n)}),k=ne(()=>w.isEdit),D=_(),f=_(0),e=oe({instanceName:"",customerId:"",customerName:"",orderId:"",packageId:"",packageName:"",packageType:1,clusterType:"standby",addressType:"IPv4",regionId:"",adsProtection:!0,ccProtection:!1,wafProtection:!1,bandwidth:100,businessBandwidth:50,qps:1e3,protectionIpCount:1,domainCount:10,portCount:10,status:"active",remark:"",clusterGroupId:"",previousClusterGroupId:""}),p={instanceName:[{required:!0,message:"请输入业务实例名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"change"}],orderId:[{required:!0,message:"请选择关联订单",trigger:"change"}],clusterType:[{required:!0,message:"请选择集群类型",trigger:"change"}],addressType:[{required:!0,message:"请选择地址类型",trigger:"change"}],regionId:[{required:()=>e.clusterType==="standby",message:"请选择地域",trigger:"change"}],clusterGroupId:[{required:!0,message:"请选择逻辑集群组",trigger:"change"}],status:[{required:!0,message:"请选择实例状态",trigger:"change"}]},q=_([]),B=_([]),Y=_([]),E=_([]),F=()=>{e.instanceName="",e.customerId="",e.customerName="",e.orderId="",e.packageId="",e.packageName="",e.packageType=1,e.clusterType="standby",e.addressType="IPv4",e.regionId="",e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1,e.bandwidth=100,e.businessBandwidth=50,e.qps=1e3,e.protectionIpCount=1,e.domainCount=10,e.portCount=10,e.status="active",e.remark="",e.clusterGroupId="",e.previousClusterGroupId=""};j(()=>w.instanceData,n=>{n?(Object.keys(e).forEach(t=>{n[t]!==void 0&&(e[t]=n[t])}),n.packageName&&(n.packageName==="DDOS防护"?(e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1,e.packageType=1,n.clusterType||(e.clusterType="standby")):n.packageName==="WAF标准防护"?(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1,e.packageType=2,n.clusterType||(e.clusterType="distributed")):n.packageName==="WAF增强防护"&&(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0,e.packageType=3,n.clusterType||(e.clusterType="anycast"))),!n.clusterType&&n.isAnycast!==void 0&&(e.clusterType=n.isAnycast?"anycast":"standby"),n.clusterGroupId&&fe(n.clusterGroupId),W()):F()},{immediate:!0,deep:!0}),j(()=>G.value,n=>{n&&(f.value=0,ke(()=>{Z(),z(),me()}))});const Z=async()=>{try{q.value=[{customerId:"CUST1001",customerName:"北京科技有限公司"},{customerId:"CUST1002",customerName:"上海网络科技有限公司"},{customerId:"CUST1003",customerName:"广州信息技术有限公司"},{customerId:"CUST1004",customerName:"深圳互联网有限公司"},{customerId:"CUST1005",customerName:"杭州数字科技有限公司"}]}catch(n){console.error("获取客户列表失败:",n)}},W=async()=>{try{const n=new URLSearchParams;e.customerId&&n.append("customerId",e.customerId);const t=await U.getAvailableOrders({customerId:e.customerId});t.code===200&&(B.value=t.data)}catch(n){console.error("获取订单列表失败:",n)}},z=async()=>{try{Y.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(n){console.error("获取地域列表失败:",n)}},ee=n=>{e.orderId="";const t=q.value.find(N=>N.customerId===n);t&&(e.customerName=t.customerName),W()},K=n=>{const t=B.value.find(N=>N.orderId===n);t&&(e.packageName=t.packageName,t.packageName==="DDOS防护"?(e.packageType=1,e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1):t.packageName==="WAF标准防护"?(e.packageType=2,e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1):t.packageName==="WAF增强防护"&&(e.packageType=3,e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0),t.clusterType&&(e.clusterType=t.clusterType),e.clusterType==="anycast"&&(e.regionId=""),e.clusterGroupId="",e.previousClusterGroupId="")},re=()=>{f.value>0&&f.value--},ue=async()=>{if(f.value===0)try{await D.value.validateField(["instanceName","customerId","orderId"]),f.value++}catch(n){console.error(n)}else if(f.value===1)try{await D.value.validateField(["addressType"]),e.clusterType==="standby"&&await D.value.validateField(["regionId"]),await D.value.validateField(["clusterGroupId"]),f.value++}catch(n){console.error(n)}else f.value<4&&f.value++},de=()=>{G.value=!1,F()},ie=async()=>{try{await D.value.validate(),x.value=!0;let n;if(w.isEdit){const t={...e},N=t.clusterGroupId!==w.instanceData.clusterGroupId;n=await U.updateBusinessInstance(w.instanceData.instanceId,t),n.code===200?(g.success("更新成功"),N&&((await U.autoAllocateIpGroups(n.data.instanceId)).code===200?g.success("已自动重新分配防护IP组"):g.warning("自动分配防护IP组失败，可能需要手动分配")),G.value=!1,h("success")):g.error(n.message||"更新失败")}else n=await U.createBusinessInstance(e),n.code===200?(g.success("创建成功"),(await U.autoAllocateIpGroups(n.data.instanceId)).code===200?g.success("已自动分配防护IP组"):g.warning("自动分配防护IP组失败，可能需要手动分配"),G.value=!1,h("success")):g.error(n.message||"创建失败")}catch(n){console.error("表单提交失败:",n)}finally{x.value=!1}},ce=n=>{n===1?(e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1):n===2?(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1):n===3&&(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0)},pe=()=>{e.clusterType!=="anycast"&&e.regionId};j(()=>e.clusterType,n=>{(n==="anycast"||n==="distributed")&&(e.regionId="")}),j([()=>e.clusterType,()=>e.addressType],([n])=>{(n==="anycast"||n==="distributed")&&(e.regionId=""),e.clusterGroupId&&te(e.clusterGroupId)}),j(()=>e.protectionIpCount,(n,t)=>{n!==t&&e.clusterGroupId&&te(e.clusterGroupId)});const me=async()=>{try{V.clusterGroups=!0;const n=await we.getClusterGroups();E.value=n}catch(n){console.error("获取逻辑集群组列表失败:",n),g.error("获取逻辑集群组列表失败")}finally{V.clusterGroups=!1}},fe=async n=>{try{const t=await we.getClusterGroupById(n);t&&(e.clusterGroupId=t.id)}catch(t){console.error("获取逻辑集群组详情失败:",t)}},ye=ne(()=>E.value.length?E.value.filter(n=>n.status!=="active"?!1:e.clusterType==="standby"?n.type==="standby"||!n.type&&!n.distributed:e.clusterType==="distributed"?n.type==="distributed"||!n.type&&n.distributed:e.clusterType==="anycast"?n.type==="anycast":!0):[]),ge=n=>n.type==="anycast"?"warning":n.type==="distributed"||n.distributed?"success":"info",ve=n=>n.type==="anycast"?"Anycast":n.type==="distributed"||n.distributed?"分布式":"主备",Ie=async()=>{e.clusterGroupId!==e.previousClusterGroupId&&(await te(e.clusterGroupId),e.previousClusterGroupId=e.clusterGroupId)},te=async n=>{if(n){V.resourceCheck=!0;try{const t=await U.checkClusterGroupIpResource(n,e.addressType,e.protectionIpCount);t.code===200?(C.value={...C.value,[n]:t.data.sufficient?"sufficient":"insufficient"},t.data.sufficient||g.warning(`所选逻辑集群组的IP资源不足，无法满足${e.protectionIpCount}组IP的分配需求`)):g.error(t.message||"检查资源充足性失败")}catch(t){console.error("检查资源充足性失败:",t),g.error("检查资源充足性失败")}finally{V.resourceCheck=!1}}},be=()=>{(e.clusterType==="anycast"||e.clusterType==="distributed")&&(e.regionId=""),e.clusterGroupId="",e.previousClusterGroupId=""};return(n,t)=>{const N=m("el-step"),o=m("el-steps"),l=m("el-input"),c=m("el-form-item"),O=m("el-option"),Q=m("el-select"),T=m("el-radio"),J=m("el-radio-group"),L=m("el-tag"),I=m("el-alert"),$=m("el-input-number"),_e=m("el-form"),H=m("el-button"),Ce=m("el-dialog");return y(),b(Ce,{modelValue:G.value,"onUpdate:modelValue":t[16]||(t[16]=r=>G.value=r),title:k.value?"修改业务实例":"新增业务实例",width:"60%","destroy-on-close":""},{default:s(()=>[a(o,{active:f.value,"finish-status":"success",simple:"",style:{"margin-bottom":"20px"}},{default:s(()=>[a(N,{title:"基本信息"}),a(N,{title:"部署配置"}),a(N,{title:"防护选项"}),a(N,{title:"资源配置"}),a(N,{title:"状态与备注"})]),_:1},8,["active"]),a(_e,{ref_key:"formRef",ref:D,model:e,rules:p,"label-width":"120px",style:{"max-height":"500px","overflow-y":"auto"}},{default:s(()=>[X(u("div",null,[a(c,{label:"业务实例名称",prop:"instanceName"},{default:s(()=>[a(l,{modelValue:e.instanceName,"onUpdate:modelValue":t[0]||(t[0]=r=>e.instanceName=r),placeholder:"请输入业务实例名称"},null,8,["modelValue"])]),_:1}),a(c,{label:"客户",prop:"customerId"},{default:s(()=>[a(Q,{modelValue:e.customerId,"onUpdate:modelValue":t[1]||(t[1]=r=>e.customerId=r),placeholder:"请选择客户",filterable:"",style:{width:"100%"},onChange:ee},{default:s(()=>[(y(!0),R(le,null,se(q.value,r=>(y(),b(O,{key:r.customerId,label:r.customerName,value:r.customerId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"关联订单",prop:"orderId"},{default:s(()=>[a(Q,{modelValue:e.orderId,"onUpdate:modelValue":t[2]||(t[2]=r=>e.orderId=r),placeholder:"请选择关联订单",filterable:"",style:{width:"100%"},disabled:!e.customerId,onChange:K},{default:s(()=>[(y(!0),R(le,null,se(B.value,r=>(y(),b(O,{key:r.orderId,label:r.orderId,value:r.orderId},{default:s(()=>[u("div",null,[u("div",null,v(r.orderId),1),u("small",Ue,v(r.packageName),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})],512),[[ae,f.value===0]]),X(u("div",null,[a(c,{label:"集群类型",prop:"clusterType"},{default:s(()=>[a(J,{modelValue:e.clusterType,"onUpdate:modelValue":t[3]||(t[3]=r=>e.clusterType=r),onChange:be},{default:s(()=>[a(T,{label:"standby"},{default:s(()=>t[17]||(t[17]=[i("主备")])),_:1,__:[17]}),a(T,{label:"distributed"},{default:s(()=>t[18]||(t[18]=[i("分布式")])),_:1,__:[18]}),a(T,{label:"anycast"},{default:s(()=>t[19]||(t[19]=[i("Anycast")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"地址类型",prop:"addressType"},{default:s(()=>[a(J,{modelValue:e.addressType,"onUpdate:modelValue":t[4]||(t[4]=r=>e.addressType=r)},{default:s(()=>[a(T,{label:"IPv4"},{default:s(()=>t[20]||(t[20]=[i("IPv4")])),_:1,__:[20]}),a(T,{label:"IPv6"},{default:s(()=>t[21]||(t[21]=[i("IPv6")])),_:1,__:[21]}),a(T,{label:"dual"},{default:s(()=>t[22]||(t[22]=[i("双栈")])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),e.clusterType==="standby"?(y(),b(c,{key:0,label:"地域",prop:"regionId"},{default:s(()=>[a(Q,{modelValue:e.regionId,"onUpdate:modelValue":t[5]||(t[5]=r=>e.regionId=r),placeholder:"请选择地域",style:{width:"100%"},onChange:pe},{default:s(()=>[(y(!0),R(le,null,se(Y.value,r=>(y(),b(O,{key:r.regionId,label:r.regionName,value:r.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):A("",!0),a(c,{label:"逻辑集群组",prop:"clusterGroupId"},{default:s(()=>[a(Q,{modelValue:e.clusterGroupId,"onUpdate:modelValue":t[6]||(t[6]=r=>e.clusterGroupId=r),placeholder:"请选择逻辑集群组",filterable:"",style:{width:"100%"},loading:V.clusterGroups,onChange:Ie},{default:s(()=>[(y(!0),R(le,null,se(ye.value,r=>(y(),b(O,{key:r.id,label:r.name,value:r.id,disabled:C.value[r.id]==="insufficient"},{default:s(()=>[u("div",Be,[u("span",null,v(r.name),1),u("div",null,[a(L,{size:"small",type:ge(r),style:{"margin-right":"5px"}},{default:s(()=>[i(v(ve(r)),1)]),_:2},1032,["type"]),C.value[r.id]?(y(),b(L,{key:0,size:"small",type:C.value[r.id]==="sufficient"?"success":"danger"},{default:s(()=>[i(v(C.value[r.id]==="sufficient"?"资源充足":"资源不足"),1)]),_:2},1032,["type"])):A("",!0)])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"]),t[23]||(t[23]=u("div",{class:"form-tip"},"请选择与订单集群类型相匹配的逻辑集群组",-1)),V.resourceCheck?(y(),R("div",$e,"正在检查网池资源充足性...")):A("",!0)]),_:1,__:[23]})],512),[[ae,f.value===1]]),X(u("div",null,[a(I,{title:"防护配置与套餐对应关系",type:"info",description:"ADS防护 -> DDOS防护；ADS防护+CC防护 -> WAF标准防护；ADS防护+CC防护+WAF防护 -> WAF增强防护",closable:!1,style:{"margin-bottom":"20px"}}),a(c,{label:"套餐选择",prop:"packageType"},{default:s(()=>[a(J,{modelValue:e.packageType,"onUpdate:modelValue":t[7]||(t[7]=r=>e.packageType=r),onChange:ce},{default:s(()=>[a(T,{label:1},{default:s(()=>t[24]||(t[24]=[i("DDOS防护（仅ADS防护）")])),_:1,__:[24]}),a(T,{label:2},{default:s(()=>t[25]||(t[25]=[i("WAF标准防护（ADS+CC防护）")])),_:1,__:[25]}),a(T,{label:3},{default:s(()=>t[26]||(t[26]=[i("WAF增强防护（ADS+CC+WAF防护）")])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"防护内容"},{default:s(()=>[e.adsProtection?(y(),b(L,{key:0,type:"success",style:{"margin-right":"5px"}},{default:s(()=>t[27]||(t[27]=[i("ADS防护")])),_:1,__:[27]})):A("",!0),e.ccProtection?(y(),b(L,{key:1,type:"warning",style:{"margin-right":"5px"}},{default:s(()=>t[28]||(t[28]=[i("CC防护")])),_:1,__:[28]})):A("",!0),e.wafProtection?(y(),b(L,{key:2,type:"danger"},{default:s(()=>t[29]||(t[29]=[i("WAF防护")])),_:1,__:[29]})):A("",!0)]),_:1})],512),[[ae,f.value===2]]),X(u("div",null,[a(c,{label:"防护带宽(Mbps)",prop:"bandwidth"},{default:s(()=>[a($,{modelValue:e.bandwidth,"onUpdate:modelValue":t[8]||(t[8]=r=>e.bandwidth=r),min:1,max:1e4},null,8,["modelValue"])]),_:1}),a(c,{label:"业务带宽(Mbps)",prop:"businessBandwidth"},{default:s(()=>[a($,{modelValue:e.businessBandwidth,"onUpdate:modelValue":t[9]||(t[9]=r=>e.businessBandwidth=r),min:1,max:5e3},null,8,["modelValue"])]),_:1}),a(c,{label:"业务QPS",prop:"qps"},{default:s(()=>[a($,{modelValue:e.qps,"onUpdate:modelValue":t[10]||(t[10]=r=>e.qps=r),min:1,max:1e5},null,8,["modelValue"])]),_:1}),a(c,{label:"防护IP数",prop:"protectionIpCount"},{default:s(()=>[a($,{modelValue:e.protectionIpCount,"onUpdate:modelValue":t[11]||(t[11]=r=>e.protectionIpCount=r),min:1,max:100},null,8,["modelValue"])]),_:1}),a(c,{label:"防护域名数",prop:"domainCount"},{default:s(()=>[a($,{modelValue:e.domainCount,"onUpdate:modelValue":t[12]||(t[12]=r=>e.domainCount=r),min:1,max:1e3},null,8,["modelValue"])]),_:1}),a(c,{label:"端口数量",prop:"portCount"},{default:s(()=>[a($,{modelValue:e.portCount,"onUpdate:modelValue":t[13]||(t[13]=r=>e.portCount=r),min:1,max:100},null,8,["modelValue"])]),_:1})],512),[[ae,f.value===3]]),X(u("div",null,[a(c,{label:"实例状态",prop:"status"},{default:s(()=>[a(J,{modelValue:e.status,"onUpdate:modelValue":t[14]||(t[14]=r=>e.status=r)},{default:s(()=>[a(T,{label:"active"},{default:s(()=>t[30]||(t[30]=[i("启用")])),_:1,__:[30]}),a(T,{label:"inactive"},{default:s(()=>t[31]||(t[31]=[i("禁用")])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"备注",prop:"remark"},{default:s(()=>[a(l,{modelValue:e.remark,"onUpdate:modelValue":t[15]||(t[15]=r=>e.remark=r),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})],512),[[ae,f.value===4]])]),_:1},8,["model"]),u("div",Re,[u("div",null,[f.value>0?(y(),b(H,{key:0,onClick:re},{default:s(()=>t[32]||(t[32]=[i("上一步")])),_:1,__:[32]})):A("",!0)]),u("div",null,[a(H,{onClick:de},{default:s(()=>t[33]||(t[33]=[i("取消")])),_:1,__:[33]}),f.value<4?(y(),b(H,{key:0,type:"primary",onClick:ue},{default:s(()=>t[34]||(t[34]=[i("下一步")])),_:1,__:[34]})):(y(),b(H,{key:1,type:"primary",onClick:ie},{default:s(()=>t[35]||(t[35]=[i("提交")])),_:1,__:[35]}))])])]),_:1},8,["modelValue","title"])}}},Fe=Ve(ze,[["__scopeId","data-v-6fda1d28"]]),Oe={key:0},Me={class:"info-section"},qe={class:"info-item"},Ee={class:"info-item"},We={class:"info-item"},Le={class:"info-item"},je={class:"info-item"},Ye={class:"info-item"},Ke={key:0},Qe={class:"group-header"},Je={class:"dialog-footer"},He={__name:"IpAllocationModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isAdmin:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(P,{emit:M}){const w=P,h=M,x=ne({get:()=>w.modelValue,set:e=>h("update:modelValue",e)}),V=_(!1),C=_([]),G=()=>{var e;C.value=Array.isArray((e=w.instanceData)==null?void 0:e.protectionIpGroups)?[...w.instanceData.protectionIpGroups]:[]};j(()=>w.instanceData,e=>{e&&ke(()=>{G()})},{immediate:!0}),j(()=>x.value,e=>{e&&ke(()=>{G()})});const k=()=>{x.value=!1},D=async()=>{if(w.instanceData)try{await Pe.confirm("重新生成IP组将删除当前所有IP组并重新分配，确定要继续吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.value=!0;const e=await U.autoAllocateIpGroups(w.instanceData.instanceId);e.code===200?(g.success("重新生成IP组成功"),C.value=e.data.protectionIpGroups,h("success")):g.error(e.message||"重新生成IP组失败")}catch(e){e!=="cancel"&&(console.error("重新生成IP组失败:",e),g.error("重新生成IP组失败"))}finally{V.value=!1}},f=e=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[e]||e;return(e,p)=>{var W;const q=m("el-divider"),B=m("el-table-column"),Y=m("el-table"),E=m("el-empty"),F=m("el-button"),Z=m("el-dialog");return y(),b(Z,{modelValue:x.value,"onUpdate:modelValue":p[0]||(p[0]=z=>x.value=z),title:`防护IP组 - ${((W=P.instanceData)==null?void 0:W.instanceName)||""}`,width:"80%","destroy-on-close":""},{default:s(()=>[P.instanceData?(y(),R("div",Oe,[u("div",Me,[u("div",qe,[p[1]||(p[1]=u("span",{class:"label"},"业务实例ID:",-1)),u("span",null,v(P.instanceData.instanceId),1)]),u("div",Ee,[p[2]||(p[2]=u("span",{class:"label"},"客户名称:",-1)),u("span",null,v(P.instanceData.customerName),1)]),u("div",We,[p[3]||(p[3]=u("span",{class:"label"},"地址类型:",-1)),u("span",null,v(f(P.instanceData.addressType)),1)]),u("div",Le,[p[4]||(p[4]=u("span",{class:"label"},"IP组数量配额:",-1)),u("span",null,v(P.instanceData.protectionIpCount),1)]),u("div",je,[p[5]||(p[5]=u("span",{class:"label"},"已分配组数量:",-1)),u("span",null,v(C.value.length),1)]),u("div",Ye,[p[6]||(p[6]=u("span",{class:"label"},"关联逻辑集群组:",-1)),u("span",null,v(P.instanceData.clusterGroupName||P.instanceData.clusterGroupId),1)])]),a(q,{"content-position":"left"},{default:s(()=>p[7]||(p[7]=[i("IP组列表")])),_:1,__:[7]}),C.value.length>0?(y(),R("div",Ke,[(y(!0),R(le,null,se(C.value,(z,ee)=>(y(),R("div",{key:z.groupId,class:"ip-group"},[u("div",Qe,[u("h3",null,"IP组 #"+v(ee+1)+" (ID: "+v(z.groupId)+")",1)]),a(Y,{data:z.addresses,style:{width:"100%"},border:"",size:"small"},{default:s(()=>[a(B,{label:"IP地址",prop:"ip","min-width":"180"}),a(B,{label:"类型",prop:"type",width:"100"}),a(B,{label:"逻辑集群","min-width":"180"},{default:s(K=>[i(v(K.row.logicClusterName||K.row.clusterId),1)]),_:1})]),_:2},1032,["data"])]))),128))])):(y(),b(E,{key:1,description:"暂无已分配IP组"})),u("div",Je,[a(F,{onClick:k},{default:s(()=>p[8]||(p[8]=[i("关闭")])),_:1,__:[8]}),P.isAdmin?(y(),b(F,{key:0,type:"primary",onClick:D},{default:s(()=>p[9]||(p[9]=[i("重新生成IP组")])),_:1,__:[9]})):A("",!0)])])):A("",!0)]),_:1},8,["modelValue","title"])}}},Xe=Ve(He,[["__scopeId","data-v-5c57cb96"]]),Ze={class:"business-instance-container"},et={class:"card-header"},tt={class:"search-area"},at={class:"pagination-container"},lt={class:"text-xs text-gray-500 mt-2"},st={class:"text-xs text-gray-500 mt-2"},nt={__name:"BusinessInstance",setup(P){const M=_(!1),w=_([]),h=_(!1),x=_(!1),V=_(!1),C=_(!1),G=_(!1),k=_(null),D=_([]),f=oe({keyword:"",dateRange:[]}),e=oe({pageNum:1,pageSize:10,total:0});xe(()=>{p(),q()});const p=async()=>{try{M.value=!0;const o={keyword:f.keyword,status:f.status,pageNum:e.pageNum,pageSize:e.pageSize};f.dateRange&&f.dateRange.length===2&&(o.dateRange=f.dateRange);const l=await U.getBusinessInstances(o);l.code===200?(w.value=l.data.list.map(c=>(!c.clusterType&&c.isAnycast!==void 0&&(c.clusterType=c.isAnycast?"anycast":"standby"),c)),e.total=l.data.total,e.pageNum=l.data.pageNum,e.pageSize=l.data.pageSize):g.error(l.message||"获取业务实例列表失败")}catch(o){console.error("获取业务实例列表失败:",o),g.error("获取业务实例列表失败")}finally{M.value=!1}},q=async()=>{try{D.value=await we.getClusterGroups()}catch(o){console.error("获取逻辑集群组列表失败:",o)}},B=o=>{if(o.clusterGroupName)return o.clusterGroupName;const l=D.value.find(c=>c.id===o.clusterGroupId);return l?l.name:o.clusterGroupId},Y=o=>{const l=D.value.find(O=>O.id===o.clusterGroupId);if(!l)return`集群组ID: ${o.clusterGroupId}`;let c="主备";return l.type==="anycast"?c="Anycast":(l.type==="distributed"||l.distributed)&&(c="分布式"),`${l.name} (${c}类型)
${l.remark||""}`},E=o=>{o.clusterGroupId&&g({message:`查看集群组: ${B(o)}`,type:"info"})},F=()=>{e.pageNum=1,p()},Z=()=>{f.keyword="",f.dateRange=[],e.pageNum=1,p()},W=o=>{e.pageSize=o,p()},z=o=>{e.pageNum=o,p()},ee=()=>{k.value=null,G.value=!1,h.value=!0},K=o=>{k.value={...o},G.value=!0,h.value=!0},re=o=>{k.value={...o},V.value=!0},ue=async()=>{try{const o=await U.enableBusinessInstance(k.value.instanceId);o.code===200?(g.success("启用成功"),V.value=!1,p()):g.error(o.message||"启用失败")}catch(o){console.error("启用业务实例失败:",o),g.error("启用业务实例失败")}},de=o=>{k.value={...o},C.value=!0},ie=async()=>{try{const o=await U.disableBusinessInstance(k.value.instanceId);o.code===200?(g.success("禁用成功"),C.value=!1,p()):g.error(o.message||"禁用失败")}catch(o){console.error("禁用业务实例失败:",o),g.error("禁用业务实例失败")}},ce=o=>{k.value=o,x.value=!0},pe=o=>{Pe.confirm("确定要删除该业务实例吗？删除后无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await U.deleteBusinessInstance(o.instanceId);l.code===200?(g.success("删除成功"),p()):g.error(l.message||"删除失败")}catch(l){console.error("删除业务实例失败:",l),g.error("删除业务实例失败")}}).catch(()=>{})},me=()=>{p()},fe=()=>{p(),k.value=null,x.value=!1},ye=(o,l)=>l.status===o,ge=(o,l)=>l.clusterType===o,ve=(o,l)=>l.addressType===o,Ie=o=>({active:"success",inactive:"info"})[o]||"info",te=o=>({active:"已启用",inactive:"已禁用"})[o]||o,be=o=>({standby:"primary",distributed:"success",anycast:"warning"})[o]||"info",n=o=>({standby:"主备",distributed:"分布式",anycast:"Anycast"})[o]||o,t=o=>({IPv4:"primary",IPv6:"success",dual:"warning"})[o]||"info",N=o=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[o]||o;return(o,l)=>{const c=m("el-button"),O=m("el-icon"),Q=m("el-input"),T=m("el-form-item"),J=m("el-date-picker"),L=m("el-form"),I=m("el-table-column"),$=m("el-tag"),_e=m("el-link"),H=m("el-tooltip"),Ce=m("el-table"),r=m("el-pagination"),Ge=m("el-card"),Te=m("el-dialog"),Ne=Ae("loading");return y(),R("div",Ze,[a(Ge,{class:"box-card"},{header:s(()=>[u("div",et,[l[11]||(l[11]=u("span",null,"业务实例管理",-1)),a(c,{type:"primary",onClick:ee},{default:s(()=>l[10]||(l[10]=[i("新增业务实例")])),_:1,__:[10]})])]),default:s(()=>[u("div",tt,[a(L,{inline:!0,model:f,class:"search-form"},{default:s(()=>[a(T,null,{default:s(()=>[a(Q,{modelValue:f.keyword,"onUpdate:modelValue":l[0]||(l[0]=d=>f.keyword=d),placeholder:"搜索业务实例名称/ID/客户名称/订单ID",clearable:"",onKeyup:De(F,["enter"])},{prefix:s(()=>[a(O,null,{default:s(()=>[a(he(Se))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(T,null,{default:s(()=>[a(J,{modelValue:f.dateRange,"onUpdate:modelValue":l[1]||(l[1]=d=>f.dateRange=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(T,null,{default:s(()=>[a(c,{type:"primary",onClick:F},{default:s(()=>l[12]||(l[12]=[i("搜索")])),_:1,__:[12]}),a(c,{onClick:Z},{default:s(()=>l[13]||(l[13]=[i("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),X((y(),b(Ce,{data:w.value,border:"",stripe:"",style:{width:"100%","min-height":"320px"},"row-key":"instanceId","max-height":"500","row-class-name":"dense-row","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2}},{empty:s(()=>l[19]||(l[19]=[u("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:s(()=>[a(I,{prop:"instanceId",label:"业务实例ID",width:"150",fixed:"left"}),a(I,{prop:"instanceName",label:"业务实例名称","min-width":"150"}),a(I,{prop:"customerName",label:"客户名称","min-width":"180"}),a(I,{prop:"orderId",label:"订单ID",width:"150"}),a(I,{prop:"packageName",label:"套餐名称",width:"120"}),a(I,{label:"集群类型",width:"120",filters:[{text:"主备",value:"standby"},{text:"分布式",value:"distributed"},{text:"Anycast",value:"anycast"}],"filter-method":ge,"filter-placement":"bottom-end"},{default:s(({row:d})=>[a($,{type:be(d.clusterType)},{default:s(()=>[i(v(n(d.clusterType)),1)]),_:2},1032,["type"])]),_:1}),a(I,{prop:"addressType",label:"地址类型",width:"100",filters:[{text:"IPv4",value:"IPv4"},{text:"IPv6",value:"IPv6"},{text:"双栈",value:"dual"}],"filter-method":ve,"filter-placement":"bottom-end"},{default:s(({row:d})=>[a($,{type:t(d.addressType)},{default:s(()=>[i(v(N(d.addressType)),1)]),_:2},1032,["type"])]),_:1}),a(I,{label:"逻辑集群组","min-width":"180"},{default:s(({row:d})=>[a(H,{effect:"light",content:Y(d),placement:"top","show-after":500},{default:s(()=>[a(_e,{type:"primary",onClick:S=>E(d)},{default:s(()=>[i(v(B(d)),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1}),a(I,{prop:"bandwidth",label:"防护带宽(Mbps)",width:"140",sortable:""}),a(I,{prop:"businessBandwidth",label:"业务带宽(Mbps)",width:"140",sortable:""}),a(I,{prop:"qps",label:"业务QPS",width:"120",sortable:""}),a(I,{prop:"protectionIpCount",label:"防护IP数",width:"120",sortable:""}),a(I,{prop:"domainCount",label:"防护域名数",width:"120",sortable:""}),a(I,{prop:"portCount",label:"端口数量",width:"120",sortable:""}),a(I,{prop:"status",label:"状态",width:"100",filters:[{text:"已启用",value:"active"},{text:"已禁用",value:"inactive"}],"filter-method":ye,"filter-placement":"bottom-end"},{default:s(({row:d})=>[a($,{type:Ie(d.status)},{default:s(()=>[i(v(te(d.status)),1)]),_:2},1032,["type"])]),_:1}),a(I,{prop:"createTime",label:"创建时间",width:"180",sortable:""}),a(I,{label:"操作",width:"320",fixed:"right"},{default:s(({row:d})=>[d.status==="inactive"?(y(),b(c,{key:0,type:"success",link:"",onClick:S=>re(d)},{default:s(()=>l[14]||(l[14]=[i(" 启用 ")])),_:2,__:[14]},1032,["onClick"])):A("",!0),d.status==="active"?(y(),b(c,{key:1,type:"warning",link:"",onClick:S=>de(d)},{default:s(()=>l[15]||(l[15]=[i(" 禁用 ")])),_:2,__:[15]},1032,["onClick"])):A("",!0),a(c,{type:"primary",link:"",onClick:S=>K(d)},{default:s(()=>l[16]||(l[16]=[i(" 修改配置 ")])),_:2,__:[16]},1032,["onClick"]),a(c,{type:"primary",link:"",onClick:S=>ce(d)},{default:s(()=>l[17]||(l[17]=[i(" 分配防护IP ")])),_:2,__:[17]},1032,["onClick"]),a(c,{type:"danger",link:"",onClick:S=>pe(d)},{default:s(()=>l[18]||(l[18]=[i(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ne,M.value]]),u("div",at,[a(r,{"current-page":e.pageNum,"onUpdate:currentPage":l[2]||(l[2]=d=>e.pageNum=d),"page-size":e.pageSize,"onUpdate:pageSize":l[3]||(l[3]=d=>e.pageSize=d),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.total,background:"",onSizeChange:W,onCurrentChange:z},null,8,["current-page","page-size","total"])])]),_:1}),a(Fe,{modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=d=>h.value=d),"instance-data":k.value,"is-edit":G.value,onSuccess:me},null,8,["modelValue","instance-data","is-edit"]),a(Xe,{modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=d=>x.value=d),"instance-data":k.value,onSuccess:fe},null,8,["modelValue","instance-data"]),a(Te,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=d=>V.value=d),title:"确认启用",width:"400px"},{footer:s(()=>[a(c,{onClick:l[6]||(l[6]=d=>V.value=!1)},{default:s(()=>l[22]||(l[22]=[i("取消")])),_:1,__:[22]}),a(c,{type:"success",onClick:ue},{default:s(()=>l[23]||(l[23]=[i("确认启用")])),_:1,__:[23]})]),default:s(()=>{var d,S;return[u("div",null,[l[20]||(l[20]=i("确定要启用业务实例 ")),u("b",null,v((d=k.value)==null?void 0:d.instanceName),1),l[21]||(l[21]=i(" 吗？"))]),u("div",lt,"ID: "+v((S=k.value)==null?void 0:S.instanceId),1)]}),_:1},8,["modelValue"]),a(Te,{modelValue:C.value,"onUpdate:modelValue":l[9]||(l[9]=d=>C.value=d),title:"确认禁用",width:"400px"},{footer:s(()=>[a(c,{onClick:l[8]||(l[8]=d=>C.value=!1)},{default:s(()=>l[26]||(l[26]=[i("取消")])),_:1,__:[26]}),a(c,{type:"warning",onClick:ie},{default:s(()=>l[27]||(l[27]=[i("确认禁用")])),_:1,__:[27]})]),default:s(()=>{var d,S;return[u("div",null,[l[24]||(l[24]=i("确定要禁用业务实例 ")),u("b",null,v((d=k.value)==null?void 0:d.instanceName),1),l[25]||(l[25]=i(" 吗？"))]),u("div",st,"ID: "+v((S=k.value)==null?void 0:S.instanceId),1)]}),_:1},8,["modelValue"])])}}},rt=Ve(nt,[["__scopeId","data-v-564e6ba4"]]);export{rt as default};
