import{_ as S,r as U,n as x,f as i,b as $,d as y,h as p,e,w as a,k as b,a as P,l as j,v as I,t as G,A as R}from"./index-BVji5qTU.js";const H={class:"cc-basic-protection-form"},K={class:"form-header"},L={__name:"CcBasicProtectionForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(k,{emit:C}){const f=k,w=C,t=U({...f.modelValue});return x(()=>f.modelValue,r=>{Object.assign(t,r)}),x(t,r=>{w("update:modelValue",{...r})},{deep:!0}),(r,l)=>{const m=i("el-switch"),n=i("el-checkbox"),_=i("el-checkbox-group"),c=i("el-form-item"),q=i("el-radio"),D=i("el-radio-group"),u=i("el-input-number"),o=i("el-form");return y(),$("div",H,[p("div",K,[l[7]||(l[7]=p("span",{class:"form-title"},"基础CC防护",-1)),e(m,{modelValue:t.enabled,"onUpdate:modelValue":l[0]||(l[0]=s=>t.enabled=s),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),e(o,{model:t,"label-width":"100px",disabled:!t.enabled},{default:a(()=>[e(c,{label:"统计对象"},{default:a(()=>[e(_,{modelValue:t.statObjects,"onUpdate:modelValue":l[1]||(l[1]=s=>t.statObjects=s)},{default:a(()=>[e(n,{label:"IP"},{default:a(()=>[...l[8]||(l[8]=[b("IP",-1)])]),_:1}),e(n,{label:"Cookie"},{default:a(()=>[...l[9]||(l[9]=[b("Cookie",-1)])]),_:1})]),_:1},8,["modelValue"]),l[10]||(l[10]=p("div",{class:"form-tip"},"可多选，按IP或Cookie统计访问频率",-1))]),_:1}),e(c,{label:"防御方式"},{default:a(()=>[e(D,{modelValue:t.defenseMode,"onUpdate:modelValue":l[2]||(l[2]=s=>t.defenseMode=s)},{default:a(()=>[e(q,{label:"JavaScript"},{default:a(()=>[...l[11]||(l[11]=[b("JavaScript",-1)])]),_:1})]),_:1},8,["modelValue"]),l[12]||(l[12]=p("div",{class:"form-tip"},"当前仅支持JavaScript防御",-1))]),_:1}),e(c,{label:"处理动作"},{default:a(()=>[e(D,{modelValue:t.action,"onUpdate:modelValue":l[3]||(l[3]=s=>t.action=s)},{default:a(()=>[e(q,{label:"block"},{default:a(()=>[...l[13]||(l[13]=[b("请求阻断",-1)])]),_:1}),e(q,{label:"limit"},{default:a(()=>[...l[14]||(l[14]=[b("请求限频",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"访问频率"},{default:a(()=>[e(u,{modelValue:t.frequency,"onUpdate:modelValue":l[4]||(l[4]=s=>t.frequency=s),min:100,max:1e5},null,8,["modelValue"]),l[15]||(l[15]=p("span",{class:"input-suffix"},"次",-1)),l[16]||(l[16]=p("div",{class:"form-tip"},"最小值：100，最大值：100000",-1))]),_:1}),e(c,{label:"检测周期"},{default:a(()=>[e(u,{modelValue:t.period,"onUpdate:modelValue":l[5]||(l[5]=s=>t.period=s),min:1,max:3600},null,8,["modelValue"]),l[17]||(l[17]=p("span",{class:"input-suffix"},"秒",-1)),l[18]||(l[18]=p("div",{class:"form-tip"},"1-3600以内的整数",-1))]),_:1}),e(c,{label:"封禁时间"},{default:a(()=>[e(u,{modelValue:t.banTime,"onUpdate:modelValue":l[6]||(l[6]=s=>t.banTime=s),min:1,max:86400},null,8,["modelValue"]),l[19]||(l[19]=p("span",{class:"input-suffix"},"秒",-1)),l[20]||(l[20]=p("div",{class:"form-tip"},"1-86400以内的整数，且必须大于检测周期",-1))]),_:1})]),_:1},8,["model","disabled"])])}}},Q=S(L,[["__scopeId","data-v-0e758287"]]),W={class:"cc-advanced-protection-table"},X={class:"table-header"},Y={__name:"CcAdvancedProtectionTable",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(k,{emit:C}){const f=k,w=C,t=U({...f.modelValue});x(()=>f.modelValue,u=>{JSON.stringify(u)!==JSON.stringify(t)&&Object.assign(t,u)}),x(t,u=>{w("update:modelValue",{...u})},{deep:!0});const r=P(!1),l=P(null),m=P(-1),n=U({name:"",path:"",statDuration:60,frequency:1e3,action:"block",banTime:30,status:!0}),_={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],path:[{required:!0,message:"请输入防护路径",trigger:"blur"}],statDuration:[{required:!0,type:"number",message:"请输入统计时长",trigger:"blur"}],frequency:[{required:!0,type:"number",message:"请输入访问次数",trigger:"blur"}],action:[{required:!0,message:"请选择处理方式",trigger:"change"}],banTime:[{required:!0,type:"number",message:"请输入封禁时长",trigger:"blur"}]};function c(u,o){u?(Object.assign(n,u),m.value=o):(Object.assign(n,{name:"",path:"",statDuration:60,frequency:1e3,action:"block",banTime:30,status:!0}),m.value=-1),r.value=!0}function q(){l.value.validate().then(()=>{const u=[...t.rules];m.value===-1?u.push({...n}):u[m.value]={...n},R(()=>{t.rules=u,r.value=!1})})}function D(u){const o=t.rules.filter((s,g)=>g!==u);R(()=>{t.rules=o})}return(u,o)=>{const s=i("el-switch"),g=i("el-button"),V=i("el-table-column"),F=i("el-table"),N=i("el-empty"),B=i("el-input"),v=i("el-form-item"),O=i("el-input-number"),J=i("el-radio"),A=i("el-radio-group"),M=i("el-form"),z=i("el-dialog");return y(),$("div",W,[p("div",X,[o[12]||(o[12]=p("span",{class:"table-title"},"高级CC防护",-1)),e(s,{modelValue:t.enabled,"onUpdate:modelValue":o[0]||(o[0]=d=>t.enabled=d),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),e(g,{type:"primary",size:"small",onClick:o[1]||(o[1]=d=>c()),disabled:!t.enabled,style:{"margin-left":"16px"}},{default:a(()=>[...o[11]||(o[11]=[b("新增",-1)])]),_:1},8,["disabled"])]),t.enabled&&t.rules.length?(y(),j(F,{key:0,data:t.rules,border:"",style:{width:"100%","margin-top":"12px"}},{default:a(()=>[e(V,{label:"序号",type:"index",width:"60"}),e(V,{label:"规则名称",prop:"name","min-width":"120"}),e(V,{label:"防护路径",prop:"path","min-width":"120"}),e(V,{label:"统计时长(秒)",prop:"statDuration",width:"120"}),e(V,{label:"访问次数",prop:"frequency",width:"100"}),e(V,{label:"处理方式",prop:"action",width:"100"},{default:a(({row:d})=>[p("span",null,G(d.action==="block"?"请求阻断":"请求限频"),1)]),_:1}),e(V,{label:"封禁时长(秒)",prop:"banTime",width:"120"}),e(V,{label:"状态",width:"80"},{default:a(({row:d})=>[e(s,{modelValue:d.status,"onUpdate:modelValue":T=>d.status=T,disabled:!t.enabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),e(V,{label:"操作",width:"120"},{default:a(({row:d,$index:T})=>[e(g,{type:"primary",link:"",onClick:E=>c(d,T),disabled:!t.enabled},{default:a(()=>[...o[13]||(o[13]=[b("编辑",-1)])]),_:1},8,["onClick","disabled"]),e(g,{type:"danger",link:"",onClick:E=>D(T),disabled:!t.enabled},{default:a(()=>[...o[14]||(o[14]=[b("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])):I("",!0),t.enabled&&!t.rules.length?(y(),j(N,{key:1,description:"暂无数据",style:{margin:"32px 0"}})):I("",!0),t.enabled?I("",!0):(y(),j(N,{key:2,description:"高级CC防护功能已禁用，请先启用该功能",style:{margin:"32px 0"}})),e(z,{modelValue:r.value,"onUpdate:modelValue":o[10]||(o[10]=d=>r.value=d),title:m.value===-1?"新建规则":"编辑规则",width:"500px"},{footer:a(()=>[e(g,{onClick:o[9]||(o[9]=d=>r.value=!1)},{default:a(()=>[...o[17]||(o[17]=[b("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:q},{default:a(()=>[...o[18]||(o[18]=[b("确定",-1)])]),_:1})]),default:a(()=>[e(M,{model:n,rules:_,ref_key:"dialogFormRef",ref:l,"label-width":"100px"},{default:a(()=>[e(v,{label:"规则名称",prop:"name"},{default:a(()=>[e(B,{modelValue:n.name,"onUpdate:modelValue":o[2]||(o[2]=d=>n.name=d),maxlength:"32","show-word-limit":"",placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(v,{label:"防护路径",prop:"path"},{default:a(()=>[e(B,{modelValue:n.path,"onUpdate:modelValue":o[3]||(o[3]=d=>n.path=d),maxlength:"128","show-word-limit":"",placeholder:"如 /api/*，支持通配符"},null,8,["modelValue"])]),_:1}),e(v,{label:"统计时长(秒)",prop:"statDuration"},{default:a(()=>[e(O,{modelValue:n.statDuration,"onUpdate:modelValue":o[4]||(o[4]=d=>n.statDuration=d),min:1,max:3600},null,8,["modelValue"])]),_:1}),e(v,{label:"访问次数",prop:"frequency"},{default:a(()=>[e(O,{modelValue:n.frequency,"onUpdate:modelValue":o[5]||(o[5]=d=>n.frequency=d),min:1,max:1e5},null,8,["modelValue"])]),_:1}),e(v,{label:"处理方式",prop:"action"},{default:a(()=>[e(A,{modelValue:n.action,"onUpdate:modelValue":o[6]||(o[6]=d=>n.action=d)},{default:a(()=>[e(J,{label:"block"},{default:a(()=>[...o[15]||(o[15]=[b("请求阻断",-1)])]),_:1}),e(J,{label:"limit"},{default:a(()=>[...o[16]||(o[16]=[b("请求限频",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"封禁时长(秒)",prop:"banTime"},{default:a(()=>[e(O,{modelValue:n.banTime,"onUpdate:modelValue":o[7]||(o[7]=d=>n.banTime=d),min:1,max:86400},null,8,["modelValue"])]),_:1}),e(v,{label:"状态",prop:"status"},{default:a(()=>[e(s,{modelValue:n.status,"onUpdate:modelValue":o[8]||(o[8]=d=>n.status=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Z=S(Y,[["__scopeId","data-v-cfbeb64b"]]),h={class:"cc-protection-tab"},ee={__name:"CcProtectionTab",props:{protectionId:{type:[Number,String],required:!0},protectionData:{type:Object,required:!0}},emits:["update"],setup(k,{emit:C}){const f=k,w=C,t=U({enabled:!1,statObjects:["IP"],defenseMode:"JavaScript",action:"block",frequency:1e3,period:10,banTime:30}),r=U({enabled:!1,rules:[]});return x(()=>f.protectionData,()=>{if(f.protectionData&&f.protectionData.securityConfig&&f.protectionData.securityConfig.ccProtection){const m=f.protectionData.securityConfig.ccProtection;m.basic&&Object.assign(t,m.basic),m.advanced&&Object.assign(r,m.advanced)}},{deep:!0,immediate:!0}),x([t,r],()=>{w("update","ccProtection",{basic:{...t},advanced:{...r}})},{deep:!0}),(m,n)=>(y(),$("div",h,[e(Q,{modelValue:t,"onUpdate:modelValue":n[0]||(n[0]=_=>t=_)},null,8,["modelValue"]),e(Z,{modelValue:r,"onUpdate:modelValue":n[1]||(n[1]=_=>r=_)},null,8,["modelValue"])]))}},te=S(ee,[["__scopeId","data-v-dc048d2c"]]);export{te as default};
