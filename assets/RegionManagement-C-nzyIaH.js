import{_ as de,r as j,a as p,c as B,o as ie,b as ue,d as t,w as l,e as s,R as w,f as pe,g as I,h as i,i as me,j as ce,k as n,l as fe,t as V,u as _e,m as ve,E as m}from"./index-DfQpnEvn.js";const ge={class:"region-management"},be={class:"card-header"},ye={class:"search-area"},ke={class:"ellipsis-cell"},we={class:"mt-2 flex justify-end"},Ve={class:"dialog-footer"},xe={class:"text-xs text-gray-500 mt-2"},Ce={__name:"RegionManagement",setup(he){const v=j({name:""}),A=p([]),c=p(!1),x=p(!1),C=p([]),f=p(!1),T=p(),b=p(!1),h=p(null),r=j({id:"",pid:"0",code:"",name:"",status:"active",remark:"",createTime:"",createAccount:"",updateTime:"",updateAccount:""}),M={pid:[{required:!0,message:"请选择父级节点",trigger:"change"}],code:[{required:!0,message:"请输入地域代码",trigger:"blur"},{pattern:/^[A-Z0-9]{1,10}$/,message:"代码必须是1-10位大写字母或数字",trigger:"blur"}],name:[{required:!0,message:"请输入地域名称",trigger:"blur"}]},D=p(!1),g=p([]);function N(){g.value=[]}function O(){D.value=!1}const q=B(()=>[{id:"0",name:"根节点",children:C.value}]),S=async()=>{c.value=!0;try{C.value=await w.getRegionTree(),c.value=!1}catch(o){console.error("获取地域树形数据失败:",o),c.value=!1}},y=async()=>{c.value=!0;try{C.value=await w.getRegionTree(),A.value=C.value,c.value=!1}catch(o){console.error("获取地域数据失败:",o),c.value=!1}},K=B(()=>{let o=A.value;if(v.name){const e=v.name.toLowerCase();return o.filter(d=>d.name.toLowerCase().includes(e))}return g.value.length?o.filter(e=>g.value.includes(e.status)):o}),U=()=>{y()},L=()=>{Object.assign(v,{name:""}),U()},P=async()=>{x.value=!1,Object.assign(r,{id:"",pid:"0",code:"",name:"",status:"active",remark:"",createTime:"",createAccount:"",updateTime:"",updateAccount:""}),await S(),f.value=!0},Z=async o=>{x.value=!0,Object.assign(r,{id:o.id,pid:o.pid,code:o.code,name:o.name,status:o.status,remark:o.remark}),await S(),f.value=!0},G=o=>{h.value=o,b.value=!0},H=async()=>{try{const o=await w.deleteRegion(h.value.id);o.success?(m.success("删除成功"),y()):m.error(o.message)}catch(o){console.error("删除地域失败:",o),m.error("删除地域失败")}b.value=!1},J=o=>{o.status=o.status==="active"?"disabled":"active",o.updateTime=new Date().toLocaleString(),o.updateAccount="current_user";const e=o.status==="active"?"启用":"禁用";m.success(`地域已${e}`)},Q=async()=>{T.value.validate(async o=>{if(o)if(x.value)try{await w.updateRegion(r.id,r),m.success("编辑成功"),f.value=!1,y()}catch(e){console.error("编辑地域失败:",e),m.error("编辑地域失败")}else try{await w.addRegion(r),m.success("新增成功"),f.value=!1,y()}catch(e){console.error("新增地域失败:",e),m.error("新增地域失败")}})},W=()=>{var o;(o=T.value)==null||o.resetFields()};return ie(()=>{y()}),(o,e)=>{const d=s("el-button"),R=s("el-input"),_=s("el-form-item"),E=s("el-form"),u=s("el-table-column"),X=s("el-tooltip"),F=s("el-checkbox"),Y=s("el-checkbox-group"),ee=s("el-icon"),te=s("el-popover"),le=s("el-tag"),ae=s("el-table"),oe=s("el-card"),ne=s("el-cascader"),$=s("el-radio"),se=s("el-radio-group"),z=s("el-dialog"),re=pe("loading");return I(),ue("div",ge,[t(oe,{class:"box-card"},{header:l(()=>[i("div",be,[e[13]||(e[13]=i("span",null,"地域",-1)),t(d,{type:"primary",onClick:P},{default:l(()=>e[12]||(e[12]=[n("新建地域")])),_:1,__:[12]})])]),default:l(()=>[i("div",ye,[t(E,{inline:!0,model:v},{default:l(()=>[t(_,{label:"名称"},{default:l(()=>[t(R,{modelValue:v.name,"onUpdate:modelValue":e[0]||(e[0]=a=>v.name=a),placeholder:"请输入地域名称",clearable:"",style:{"max-width":"260px"},onKeyup:ce(U,["enter"])},null,8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(d,{type:"primary",onClick:U},{default:l(()=>e[14]||(e[14]=[n("搜索")])),_:1,__:[14]}),t(d,{onClick:L},{default:l(()=>e[15]||(e[15]=[n("重置")])),_:1,__:[15]})]),_:1})]),_:1},8,["model"])]),me((I(),fe(ae,{data:K.value,style:{width:"100%","min-height":"500px","margin-top":"20px"},border:"",stripe:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"max-height":"700","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2},"row-class-name":"dense-row"},{empty:l(()=>e[23]||(e[23]=[i("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:l(()=>[t(u,{prop:"id",label:"ID",width:"120",fixed:"left"}),t(u,{prop:"code",label:"代码",width:"80"}),t(u,{prop:"name",label:"名称",width:"150"},{default:l(a=>[t(X,{effect:"dark",content:a.row.name,placement:"top"},{default:l(()=>[i("span",ke,V(a.row.name),1)]),_:2},1032,["content"])]),_:1}),t(u,{prop:"status",label:"状态",width:"100"},{header:l(()=>[e[20]||(e[20]=i("span",null,"状态",-1)),t(te,{placement:"bottom",width:"160",trigger:"click",visible:D.value,"onUpdate:visible":e[2]||(e[2]=a=>D.value=a)},{reference:l(()=>[t(ee,{color:g.value.length?"#409EFF":"#909399",class:"ml-1 cursor-pointer"},{default:l(()=>[t(_e(ve))]),_:1},8,["color"])]),default:l(()=>[i("div",null,[t(Y,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a)},{default:l(()=>[t(F,{label:"active"},{default:l(()=>e[16]||(e[16]=[n("启用")])),_:1,__:[16]}),t(F,{label:"disabled"},{default:l(()=>e[17]||(e[17]=[n("禁用")])),_:1,__:[17]})]),_:1},8,["modelValue"]),i("div",we,[t(d,{size:"small",onClick:N},{default:l(()=>e[18]||(e[18]=[n("重置")])),_:1,__:[18]}),t(d,{size:"small",type:"primary",onClick:O},{default:l(()=>e[19]||(e[19]=[n("确定")])),_:1,__:[19]})])])]),_:1},8,["visible"])]),default:l(a=>[t(le,{type:a.row.status==="active"?"success":"danger"},{default:l(()=>[n(V(a.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"remark",label:"备注","min-width":"200","show-overflow-tooltip":""}),t(u,{prop:"createTime",label:"创建时间",width:"160"}),t(u,{prop:"createAccount",label:"创建人",width:"120"}),t(u,{prop:"updateTime",label:"修改时间",width:"160"}),t(u,{prop:"updateAccount",label:"修改人",width:"120"}),t(u,{label:"操作",width:"180",fixed:"right"},{default:l(a=>[t(d,{type:"primary",link:"",size:"small",onClick:k=>Z(a.row)},{default:l(()=>e[21]||(e[21]=[n("编辑")])),_:2,__:[21]},1032,["onClick"]),t(d,{type:a.row.status==="active"?"danger":"success",link:"",size:"small",onClick:k=>J(a.row)},{default:l(()=>[n(V(a.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(d,{type:"danger",link:"",size:"small",onClick:k=>G(a.row)},{default:l(()=>e[22]||(e[22]=[n("删除")])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,c.value]])]),_:1}),t(z,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=a=>f.value=a),title:x.value?"编辑地域":"新建地域",width:"500px","close-on-click-modal":!1,onClose:W},{footer:l(()=>[i("span",Ve,[t(d,{onClick:e[8]||(e[8]=a=>f.value=!1)},{default:l(()=>e[26]||(e[26]=[n("取消")])),_:1,__:[26]}),t(d,{type:"primary",onClick:Q},{default:l(()=>e[27]||(e[27]=[n("确定")])),_:1,__:[27]})])]),default:l(()=>[t(E,{model:r,rules:M,ref_key:"formRef",ref:T,"label-width":"120px"},{default:l(()=>[t(_,{label:"父级节点",prop:"pid"},{default:l(()=>[t(ne,{modelValue:r.pid,"onUpdate:modelValue":e[3]||(e[3]=a=>r.pid=a),options:q.value,props:{checkStrictly:!0,value:"id",label:"name",emitPath:!1},placeholder:"请选择父级节点",clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(_,{label:"代码",prop:"code"},{default:l(()=>[t(R,{modelValue:r.code,"onUpdate:modelValue":e[4]||(e[4]=a=>r.code=a),placeholder:"请输入地域代码（如PEK）"},null,8,["modelValue"])]),_:1}),t(_,{label:"名称",prop:"name"},{default:l(()=>[t(R,{modelValue:r.name,"onUpdate:modelValue":e[5]||(e[5]=a=>r.name=a),placeholder:"请输入地域名称"},null,8,["modelValue"])]),_:1}),t(_,{label:"状态",prop:"status"},{default:l(()=>[t(se,{modelValue:r.status,"onUpdate:modelValue":e[6]||(e[6]=a=>r.status=a)},{default:l(()=>[t($,{label:"active"},{default:l(()=>e[24]||(e[24]=[n("启用")])),_:1,__:[24]}),t($,{label:"disabled"},{default:l(()=>e[25]||(e[25]=[n("禁用")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"备注",prop:"remark"},{default:l(()=>[t(R,{modelValue:r.remark,"onUpdate:modelValue":e[7]||(e[7]=a=>r.remark=a),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(z,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=a=>b.value=a),title:"确认删除",width:"400px"},{footer:l(()=>[t(d,{onClick:e[10]||(e[10]=a=>b.value=!1)},{default:l(()=>e[30]||(e[30]=[n("取消")])),_:1,__:[30]}),t(d,{type:"danger",onClick:H},{default:l(()=>e[31]||(e[31]=[n("确认删除")])),_:1,__:[31]})]),default:l(()=>{var a,k;return[i("div",null,[e[28]||(e[28]=n("确定要删除地域 ")),i("b",null,V((a=h.value)==null?void 0:a.name),1),e[29]||(e[29]=n(" 吗？"))]),i("div",xe,"ID: "+V((k=h.value)==null?void 0:k.id),1)]}),_:1},8,["modelValue"])])}}},Te=de(Ce,[["__scopeId","data-v-f85d7368"]]);export{Te as default};
