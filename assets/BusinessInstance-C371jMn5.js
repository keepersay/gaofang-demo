import{_ as Ve,a as C,r as oe,c as ne,n as L,e as c,l as I,g as y,w as s,d as a,h as u,i as X,b as $,F as Y,p as Z,t as b,I as se,v as U,k as i,J as B,E as g,K as ke,C as we,q as Pe,o as De,f as he,u as Se,x as Ae}from"./index-MJ58kVUB.js";const Ue={style:{color:"#999"}},Be={style:{display:"flex","justify-content":"space-between","align-items":"center"}},$e={key:0,class:"form-tip"},ze={style:{"margin-top":"20px",display:"flex","justify-content":"space-between"}},Re={__name:"BusinessInstanceModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(N,{emit:O}){const V=N,S=O,D=C(!1),T=oe({customers:!1,orders:!1,regions:!1,clusterGroups:!1,resourceCheck:!1}),k=C({}),G=ne({get:()=>V.modelValue,set:n=>S("update:modelValue",n)}),w=ne(()=>V.isEdit),h=C(),m=C(0),e=oe({instanceName:"",customerId:"",customerName:"",orderId:"",packageId:"",packageName:"",packageType:1,clusterType:"standby",addressType:"IPv4",regionId:"",adsProtection:!0,ccProtection:!1,wafProtection:!1,bandwidth:100,businessBandwidth:50,qps:1e3,protectionIpCount:1,domainCount:10,portCount:10,status:"active",remark:"",clusterGroupId:"",previousClusterGroupId:""}),p={instanceName:[{required:!0,message:"请输入业务实例名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"change"}],orderId:[{required:!0,message:"请选择关联订单",trigger:"change"}],clusterType:[{required:!0,message:"请选择集群类型",trigger:"change"}],addressType:[{required:!0,message:"请选择地址类型",trigger:"change"}],regionId:[{required:()=>e.clusterType==="standby",message:"请选择地域",trigger:"change"}],clusterGroupId:[{required:!0,message:"请选择逻辑集群组",trigger:"change"}],status:[{required:!0,message:"请选择实例状态",trigger:"change"}]},F=C([]),z=C([]),j=C([]),q=C([]),M=()=>{e.instanceName="",e.customerId="",e.customerName="",e.orderId="",e.packageId="",e.packageName="",e.packageType=1,e.clusterType="standby",e.addressType="IPv4",e.regionId="",e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1,e.bandwidth=100,e.businessBandwidth=50,e.qps=1e3,e.protectionIpCount=1,e.domainCount=10,e.portCount=10,e.status="active",e.remark="",e.clusterGroupId="",e.previousClusterGroupId=""};L(()=>V.instanceData,n=>{n?(Object.keys(e).forEach(t=>{n[t]!==void 0&&(e[t]=n[t])}),n.packageName&&(n.packageName==="DDOS防护"?(e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1,e.packageType=1,n.clusterType||(e.clusterType="standby")):n.packageName==="WAF标准防护"?(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1,e.packageType=2,n.clusterType||(e.clusterType="distributed")):n.packageName==="WAF增强防护"&&(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0,e.packageType=3,n.clusterType||(e.clusterType="anycast"))),!n.clusterType&&n.isAnycast!==void 0&&(e.clusterType=n.isAnycast?"anycast":"standby"),n.clusterGroupId&&fe(n.clusterGroupId),E()):M()},{immediate:!0,deep:!0}),L(()=>G.value,n=>{n&&(m.value=0,ke(()=>{ee(),R(),me()}))});const ee=async()=>{try{F.value=[{customerId:"CUST1001",customerName:"北京科技有限公司"},{customerId:"CUST1002",customerName:"上海网络科技有限公司"},{customerId:"CUST1003",customerName:"广州信息技术有限公司"},{customerId:"CUST1004",customerName:"深圳互联网有限公司"},{customerId:"CUST1005",customerName:"杭州数字科技有限公司"}]}catch(n){console.error("获取客户列表失败:",n)}},E=async()=>{try{const n=new URLSearchParams;e.customerId&&n.append("customerId",e.customerId);const t=await B.getAvailableOrders({customerId:e.customerId});t.code===200&&(z.value=t.data)}catch(n){console.error("获取订单列表失败:",n)}},R=async()=>{try{j.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(n){console.error("获取地域列表失败:",n)}},te=n=>{e.orderId="";const t=F.value.find(x=>x.customerId===n);t&&(e.customerName=t.customerName),E()},Q=n=>{const t=z.value.find(x=>x.orderId===n);t&&(e.packageName=t.packageName,t.packageName==="DDOS防护"?(e.packageType=1,e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1):t.packageName==="WAF标准防护"?(e.packageType=2,e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1):t.packageName==="WAF增强防护"&&(e.packageType=3,e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0),t.clusterType&&(e.clusterType=t.clusterType),e.clusterType==="anycast"&&(e.regionId=""),e.clusterGroupId="",e.previousClusterGroupId="")},re=()=>{m.value>0&&m.value--},ue=async()=>{if(m.value===0)try{await h.value.validateField(["instanceName","customerId","orderId"]),m.value++}catch(n){console.error(n)}else if(m.value===1)try{await h.value.validateField(["addressType"]),e.clusterType==="standby"&&await h.value.validateField(["regionId"]),await h.value.validateField(["clusterGroupId"]),m.value++}catch(n){console.error(n)}else m.value<4&&m.value++},de=()=>{G.value=!1,M()},ie=async()=>{try{await h.value.validate(),D.value=!0;let n;if(V.isEdit){const t={...e},x=t.clusterGroupId!==V.instanceData.clusterGroupId;n=await B.updateBusinessInstance(V.instanceData.instanceId,t),n.code===200?(g.success("更新成功"),x&&((await B.autoAllocateIpGroups(n.data.instanceId)).code===200?g.success("已自动重新分配防护IP组"):g.warning("自动分配防护IP组失败，可能需要手动分配")),G.value=!1,S("success")):g.error(n.message||"更新失败")}else n=await B.createBusinessInstance(e),n.code===200?(g.success("创建成功"),(await B.autoAllocateIpGroups(n.data.instanceId)).code===200?g.success("已自动分配防护IP组"):g.warning("自动分配防护IP组失败，可能需要手动分配"),G.value=!1,S("success")):g.error(n.message||"创建失败")}catch(n){console.error("表单提交失败:",n)}finally{D.value=!1}},ce=n=>{n===1?(e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1):n===2?(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1):n===3&&(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0)},pe=()=>{e.clusterType!=="anycast"&&e.regionId};L(()=>e.clusterType,n=>{(n==="anycast"||n==="distributed")&&(e.regionId="")}),L([()=>e.clusterType,()=>e.addressType],([n])=>{(n==="anycast"||n==="distributed")&&(e.regionId=""),e.clusterGroupId&&ae(e.clusterGroupId)}),L(()=>e.protectionIpCount,(n,t)=>{n!==t&&e.clusterGroupId&&ae(e.clusterGroupId)});const me=async()=>{try{T.clusterGroups=!0;const n=await we.getClusterGroups();q.value=n}catch(n){console.error("获取逻辑集群组列表失败:",n),g.error("获取逻辑集群组列表失败")}finally{T.clusterGroups=!1}},fe=async n=>{try{const t=await we.getClusterGroupById(n);t&&(e.clusterGroupId=t.id)}catch(t){console.error("获取逻辑集群组详情失败:",t)}},ye=ne(()=>q.value.length?q.value.filter(n=>n.status!=="active"?!1:e.clusterType==="standby"?n.type==="standby"||!n.type&&!n.distributed:e.clusterType==="distributed"?n.type==="distributed"||!n.type&&n.distributed:e.clusterType==="anycast"?n.type==="anycast":!0):[]),ge=n=>n.type==="anycast"?"warning":n.type==="distributed"||n.distributed?"success":"info",ve=n=>n.type==="anycast"?"Anycast":n.type==="distributed"||n.distributed?"分布式":"主备",be=async()=>{e.clusterGroupId!==e.previousClusterGroupId&&(await ae(e.clusterGroupId),e.previousClusterGroupId=e.clusterGroupId)},ae=async n=>{if(n){T.resourceCheck=!0;try{const t=await B.checkClusterGroupIpResource(n,e.addressType,e.protectionIpCount);t.code===200?(k.value={...k.value,[n]:t.data.sufficient?"sufficient":"insufficient"},t.data.sufficient||g.warning(`所选逻辑集群组的IP资源不足，无法满足${e.protectionIpCount}组IP的分配需求`)):g.error(t.message||"检查资源充足性失败")}catch(t){console.error("检查资源充足性失败:",t),g.error("检查资源充足性失败")}finally{T.resourceCheck=!1}}},Ie=()=>{(e.clusterType==="anycast"||e.clusterType==="distributed")&&(e.regionId=""),e.clusterGroupId="",e.previousClusterGroupId=""};return(n,t)=>{const x=c("el-step"),o=c("el-steps"),l=c("el-input"),f=c("el-form-item"),_=c("el-option"),J=c("el-select"),P=c("el-radio"),K=c("el-radio-group"),W=c("el-tag"),_e=c("el-alert"),v=c("el-input-number"),le=c("el-form"),H=c("el-button"),Ce=c("el-dialog");return y(),I(Ce,{modelValue:G.value,"onUpdate:modelValue":t[16]||(t[16]=r=>G.value=r),title:w.value?"修改业务实例":"新增业务实例",width:"60%","destroy-on-close":""},{default:s(()=>[a(o,{active:m.value,"finish-status":"success",simple:"",style:{"margin-bottom":"20px"}},{default:s(()=>[a(x,{title:"基本信息"}),a(x,{title:"部署配置"}),a(x,{title:"防护选项"}),a(x,{title:"资源配置"}),a(x,{title:"状态与备注"})]),_:1},8,["active"]),a(le,{ref_key:"formRef",ref:h,model:e,rules:p,"label-width":"120px",style:{"max-height":"500px","overflow-y":"auto"}},{default:s(()=>[X(u("div",null,[a(f,{label:"业务实例名称",prop:"instanceName"},{default:s(()=>[a(l,{modelValue:e.instanceName,"onUpdate:modelValue":t[0]||(t[0]=r=>e.instanceName=r),placeholder:"请输入业务实例名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"客户",prop:"customerId"},{default:s(()=>[a(J,{modelValue:e.customerId,"onUpdate:modelValue":t[1]||(t[1]=r=>e.customerId=r),placeholder:"请选择客户",filterable:"",style:{width:"100%"},onChange:te},{default:s(()=>[(y(!0),$(Y,null,Z(F.value,r=>(y(),I(_,{key:r.customerId,label:r.customerName,value:r.customerId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"关联订单",prop:"orderId"},{default:s(()=>[a(J,{modelValue:e.orderId,"onUpdate:modelValue":t[2]||(t[2]=r=>e.orderId=r),placeholder:"请选择关联订单",filterable:"",style:{width:"100%"},disabled:!e.customerId,onChange:Q},{default:s(()=>[(y(!0),$(Y,null,Z(z.value,r=>(y(),I(_,{key:r.orderId,label:r.orderId,value:r.orderId},{default:s(()=>[u("div",null,[u("div",null,b(r.orderId),1),u("small",Ue,b(r.packageName),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})],512),[[se,m.value===0]]),X(u("div",null,[a(f,{label:"集群类型",prop:"clusterType"},{default:s(()=>[a(K,{modelValue:e.clusterType,"onUpdate:modelValue":t[3]||(t[3]=r=>e.clusterType=r),onChange:Ie},{default:s(()=>[a(P,{label:"standby"},{default:s(()=>t[17]||(t[17]=[i("主备")])),_:1,__:[17]}),a(P,{label:"distributed"},{default:s(()=>t[18]||(t[18]=[i("分布式")])),_:1,__:[18]}),a(P,{label:"anycast"},{default:s(()=>t[19]||(t[19]=[i("Anycast")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"地址类型",prop:"addressType"},{default:s(()=>[a(K,{modelValue:e.addressType,"onUpdate:modelValue":t[4]||(t[4]=r=>e.addressType=r)},{default:s(()=>[a(P,{label:"IPv4"},{default:s(()=>t[20]||(t[20]=[i("IPv4")])),_:1,__:[20]}),a(P,{label:"IPv6"},{default:s(()=>t[21]||(t[21]=[i("IPv6")])),_:1,__:[21]}),a(P,{label:"dual"},{default:s(()=>t[22]||(t[22]=[i("双栈")])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),e.clusterType==="standby"?(y(),I(f,{key:0,label:"地域",prop:"regionId"},{default:s(()=>[a(J,{modelValue:e.regionId,"onUpdate:modelValue":t[5]||(t[5]=r=>e.regionId=r),placeholder:"请选择地域",style:{width:"100%"},onChange:pe},{default:s(()=>[(y(!0),$(Y,null,Z(j.value,r=>(y(),I(_,{key:r.regionId,label:r.regionName,value:r.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):U("",!0),a(f,{label:"逻辑集群组",prop:"clusterGroupId"},{default:s(()=>[a(J,{modelValue:e.clusterGroupId,"onUpdate:modelValue":t[6]||(t[6]=r=>e.clusterGroupId=r),placeholder:"请选择逻辑集群组",filterable:"",style:{width:"100%"},loading:T.clusterGroups,onChange:be},{default:s(()=>[(y(!0),$(Y,null,Z(ye.value,r=>(y(),I(_,{key:r.id,label:r.name,value:r.id,disabled:k.value[r.id]==="insufficient"},{default:s(()=>[u("div",Be,[u("span",null,b(r.name),1),u("div",null,[a(W,{size:"small",type:ge(r),style:{"margin-right":"5px"}},{default:s(()=>[i(b(ve(r)),1)]),_:2},1032,["type"]),k.value[r.id]?(y(),I(W,{key:0,size:"small",type:k.value[r.id]==="sufficient"?"success":"danger"},{default:s(()=>[i(b(k.value[r.id]==="sufficient"?"资源充足":"资源不足"),1)]),_:2},1032,["type"])):U("",!0)])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"]),t[23]||(t[23]=u("div",{class:"form-tip"},"请选择与订单集群类型相匹配的逻辑集群组",-1)),T.resourceCheck?(y(),$("div",$e,"正在检查网池资源充足性...")):U("",!0)]),_:1,__:[23]})],512),[[se,m.value===1]]),X(u("div",null,[a(_e,{title:"防护配置与套餐对应关系",type:"info",description:"ADS防护 -> DDOS防护；ADS防护+CC防护 -> WAF标准防护；ADS防护+CC防护+WAF防护 -> WAF增强防护",closable:!1,style:{"margin-bottom":"20px"}}),a(f,{label:"套餐选择",prop:"packageType"},{default:s(()=>[a(K,{modelValue:e.packageType,"onUpdate:modelValue":t[7]||(t[7]=r=>e.packageType=r),onChange:ce},{default:s(()=>[a(P,{label:1},{default:s(()=>t[24]||(t[24]=[i("DDOS防护（仅ADS防护）")])),_:1,__:[24]}),a(P,{label:2},{default:s(()=>t[25]||(t[25]=[i("WAF标准防护（ADS+CC防护）")])),_:1,__:[25]}),a(P,{label:3},{default:s(()=>t[26]||(t[26]=[i("WAF增强防护（ADS+CC+WAF防护）")])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"防护内容"},{default:s(()=>[e.adsProtection?(y(),I(W,{key:0,type:"success",style:{"margin-right":"5px"}},{default:s(()=>t[27]||(t[27]=[i("ADS防护")])),_:1,__:[27]})):U("",!0),e.ccProtection?(y(),I(W,{key:1,type:"warning",style:{"margin-right":"5px"}},{default:s(()=>t[28]||(t[28]=[i("CC防护")])),_:1,__:[28]})):U("",!0),e.wafProtection?(y(),I(W,{key:2,type:"danger"},{default:s(()=>t[29]||(t[29]=[i("WAF防护")])),_:1,__:[29]})):U("",!0)]),_:1})],512),[[se,m.value===2]]),X(u("div",null,[a(f,{label:"防护带宽(Mbps)",prop:"bandwidth"},{default:s(()=>[a(v,{modelValue:e.bandwidth,"onUpdate:modelValue":t[8]||(t[8]=r=>e.bandwidth=r),min:1,max:1e4},null,8,["modelValue"])]),_:1}),a(f,{label:"业务带宽(Mbps)",prop:"businessBandwidth"},{default:s(()=>[a(v,{modelValue:e.businessBandwidth,"onUpdate:modelValue":t[9]||(t[9]=r=>e.businessBandwidth=r),min:1,max:5e3},null,8,["modelValue"])]),_:1}),a(f,{label:"业务QPS",prop:"qps"},{default:s(()=>[a(v,{modelValue:e.qps,"onUpdate:modelValue":t[10]||(t[10]=r=>e.qps=r),min:1,max:1e5},null,8,["modelValue"])]),_:1}),a(f,{label:"防护IP数",prop:"protectionIpCount"},{default:s(()=>[a(v,{modelValue:e.protectionIpCount,"onUpdate:modelValue":t[11]||(t[11]=r=>e.protectionIpCount=r),min:1,max:100},null,8,["modelValue"])]),_:1}),a(f,{label:"防护域名数",prop:"domainCount"},{default:s(()=>[a(v,{modelValue:e.domainCount,"onUpdate:modelValue":t[12]||(t[12]=r=>e.domainCount=r),min:1,max:1e3},null,8,["modelValue"])]),_:1}),a(f,{label:"端口数量",prop:"portCount"},{default:s(()=>[a(v,{modelValue:e.portCount,"onUpdate:modelValue":t[13]||(t[13]=r=>e.portCount=r),min:1,max:100},null,8,["modelValue"])]),_:1})],512),[[se,m.value===3]]),X(u("div",null,[a(f,{label:"实例状态",prop:"status"},{default:s(()=>[a(K,{modelValue:e.status,"onUpdate:modelValue":t[14]||(t[14]=r=>e.status=r)},{default:s(()=>[a(P,{label:"active"},{default:s(()=>t[30]||(t[30]=[i("启用")])),_:1,__:[30]}),a(P,{label:"inactive"},{default:s(()=>t[31]||(t[31]=[i("禁用")])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"备注",prop:"remark"},{default:s(()=>[a(l,{modelValue:e.remark,"onUpdate:modelValue":t[15]||(t[15]=r=>e.remark=r),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})],512),[[se,m.value===4]])]),_:1},8,["model"]),u("div",ze,[u("div",null,[m.value>0?(y(),I(H,{key:0,onClick:re},{default:s(()=>t[32]||(t[32]=[i("上一步")])),_:1,__:[32]})):U("",!0)]),u("div",null,[a(H,{onClick:de},{default:s(()=>t[33]||(t[33]=[i("取消")])),_:1,__:[33]}),m.value<4?(y(),I(H,{key:0,type:"primary",onClick:ue},{default:s(()=>t[34]||(t[34]=[i("下一步")])),_:1,__:[34]})):(y(),I(H,{key:1,type:"primary",onClick:ie},{default:s(()=>t[35]||(t[35]=[i("提交")])),_:1,__:[35]}))])])]),_:1},8,["modelValue","title"])}}},Oe=Ve(Re,[["__scopeId","data-v-6fda1d28"]]),Fe={key:0},qe={class:"info-section"},Me={class:"info-item"},Ee={class:"info-item"},We={class:"info-item"},Le={class:"info-item"},je={class:"info-item"},Qe={class:"info-item"},Je={key:0},Ke={class:"group-header"},He={class:"dialog-footer"},Xe={__name:"IpAllocationModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isAdmin:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(N,{emit:O}){const V=N,S=O,D=ne({get:()=>V.modelValue,set:e=>S("update:modelValue",e)}),T=C(!1),k=C([]),G=()=>{var e;k.value=Array.isArray((e=V.instanceData)==null?void 0:e.protectionIpGroups)?[...V.instanceData.protectionIpGroups]:[]};L(()=>V.instanceData,e=>{e&&ke(()=>{G()})},{immediate:!0}),L(()=>D.value,e=>{e&&ke(()=>{G()})});const w=()=>{D.value=!1},h=async()=>{if(V.instanceData)try{await Pe.confirm("重新生成IP组将删除当前所有IP组并重新分配，确定要继续吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),T.value=!0;const e=await B.autoAllocateIpGroups(V.instanceData.instanceId);e.code===200?(g.success("重新生成IP组成功"),k.value=e.data.protectionIpGroups,S("success")):g.error(e.message||"重新生成IP组失败")}catch(e){e!=="cancel"&&(console.error("重新生成IP组失败:",e),g.error("重新生成IP组失败"))}finally{T.value=!1}},m=e=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[e]||e;return(e,p)=>{var E;const F=c("el-divider"),z=c("el-table-column"),j=c("el-table"),q=c("el-empty"),M=c("el-button"),ee=c("el-dialog");return y(),I(ee,{modelValue:D.value,"onUpdate:modelValue":p[0]||(p[0]=R=>D.value=R),title:`防护IP组 - ${((E=N.instanceData)==null?void 0:E.instanceName)||""}`,width:"80%","destroy-on-close":""},{default:s(()=>[N.instanceData?(y(),$("div",Fe,[u("div",qe,[u("div",Me,[p[1]||(p[1]=u("span",{class:"label"},"业务实例ID:",-1)),u("span",null,b(N.instanceData.instanceId),1)]),u("div",Ee,[p[2]||(p[2]=u("span",{class:"label"},"客户名称:",-1)),u("span",null,b(N.instanceData.customerName),1)]),u("div",We,[p[3]||(p[3]=u("span",{class:"label"},"地址类型:",-1)),u("span",null,b(m(N.instanceData.addressType)),1)]),u("div",Le,[p[4]||(p[4]=u("span",{class:"label"},"IP组数量配额:",-1)),u("span",null,b(N.instanceData.protectionIpCount),1)]),u("div",je,[p[5]||(p[5]=u("span",{class:"label"},"已分配组数量:",-1)),u("span",null,b(k.value.length),1)]),u("div",Qe,[p[6]||(p[6]=u("span",{class:"label"},"关联逻辑集群组:",-1)),u("span",null,b(N.instanceData.clusterGroupName||N.instanceData.clusterGroupId),1)])]),a(F,{"content-position":"left"},{default:s(()=>p[7]||(p[7]=[i("IP组列表")])),_:1,__:[7]}),k.value.length>0?(y(),$("div",Je,[(y(!0),$(Y,null,Z(k.value,(R,te)=>(y(),$("div",{key:R.groupId,class:"ip-group"},[u("div",Ke,[u("h3",null,"IP组 #"+b(te+1)+" (ID: "+b(R.groupId)+")",1)]),a(j,{data:R.addresses,style:{width:"100%"},border:"",size:"small"},{default:s(()=>[a(z,{label:"IP地址",prop:"ip","min-width":"180"}),a(z,{label:"类型",prop:"type",width:"100"}),a(z,{label:"逻辑集群","min-width":"180"},{default:s(Q=>[i(b(Q.row.logicClusterName||Q.row.clusterId),1)]),_:1})]),_:2},1032,["data"])]))),128))])):(y(),I(q,{key:1,description:"暂无已分配IP组"})),u("div",He,[a(M,{onClick:w},{default:s(()=>p[8]||(p[8]=[i("关闭")])),_:1,__:[8]}),N.isAdmin?(y(),I(M,{key:0,type:"primary",onClick:h},{default:s(()=>p[9]||(p[9]=[i("重新生成IP组")])),_:1,__:[9]})):U("",!0)])])):U("",!0)]),_:1},8,["modelValue","title"])}}},Ye=Ve(Xe,[["__scopeId","data-v-5c57cb96"]]),Ze={class:"business-instance-container resource-page"},et={class:"card-header"},tt={class:"search-area"},at={class:"pagination-container"},lt={class:"text-xs text-gray-500 mt-2"},st={class:"text-xs text-gray-500 mt-2"},nt={__name:"BusinessInstance",setup(N){const O=C(!1),V=C([]),S=C(!1),D=C(!1),T=C(!1),k=C(!1),G=C(!1),w=C(null),h=C([]),m=oe({keyword:"",dateRange:[]}),e=oe({pageNum:1,pageSize:10,total:0});De(()=>{p(),F()});const p=async()=>{try{O.value=!0;const o={keyword:m.keyword,status:m.status,pageNum:e.pageNum,pageSize:e.pageSize};m.dateRange&&m.dateRange.length===2&&(o.dateRange=m.dateRange);const l=await B.getBusinessInstances(o);l.code===200?(V.value=l.data.list.map(f=>(!f.clusterType&&f.isAnycast!==void 0&&(f.clusterType=f.isAnycast?"anycast":"standby"),f)),e.total=l.data.total,e.pageNum=l.data.pageNum,e.pageSize=l.data.pageSize):g.error(l.message||"获取业务实例列表失败")}catch(o){console.error("获取业务实例列表失败:",o),g.error("获取业务实例列表失败")}finally{O.value=!1}},F=async()=>{try{h.value=await we.getClusterGroups()}catch(o){console.error("获取逻辑集群组列表失败:",o)}},z=o=>{if(o.clusterGroupName)return o.clusterGroupName;const l=h.value.find(f=>f.id===o.clusterGroupId);return l?l.name:o.clusterGroupId},j=o=>{const l=h.value.find(_=>_.id===o.clusterGroupId);if(!l)return`集群组ID: ${o.clusterGroupId}`;let f="主备";return l.type==="anycast"?f="Anycast":(l.type==="distributed"||l.distributed)&&(f="分布式"),`${l.name} (${f}类型)
${l.remark||""}`},q=o=>{o.clusterGroupId&&g({message:`查看集群组: ${z(o)}`,type:"info"})},M=()=>{e.pageNum=1,p()},ee=()=>{m.keyword="",m.dateRange=[],e.pageNum=1,p()},E=o=>{e.pageSize=o,p()},R=o=>{e.pageNum=o,p()},te=()=>{w.value=null,G.value=!1,S.value=!0},Q=o=>{w.value={...o},G.value=!0,S.value=!0},re=o=>{w.value={...o},T.value=!0},ue=async()=>{try{const o=await B.enableBusinessInstance(w.value.instanceId);o.code===200?(g.success("启用成功"),T.value=!1,p()):g.error(o.message||"启用失败")}catch(o){console.error("启用业务实例失败:",o),g.error("启用业务实例失败")}},de=o=>{w.value={...o},k.value=!0},ie=async()=>{try{const o=await B.disableBusinessInstance(w.value.instanceId);o.code===200?(g.success("禁用成功"),k.value=!1,p()):g.error(o.message||"禁用失败")}catch(o){console.error("禁用业务实例失败:",o),g.error("禁用业务实例失败")}},ce=o=>{w.value=o,D.value=!0},pe=o=>{Pe.confirm("确定要删除该业务实例吗？删除后无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await B.deleteBusinessInstance(o.instanceId);l.code===200?(g.success("删除成功"),p()):g.error(l.message||"删除失败")}catch(l){console.error("删除业务实例失败:",l),g.error("删除业务实例失败")}}).catch(()=>{})},me=()=>{p()},fe=()=>{p(),w.value=null,D.value=!1},ye=(o,l)=>l.status===o,ge=(o,l)=>l.clusterType===o,ve=(o,l)=>l.addressType===o,be=o=>({active:"success",inactive:"info"})[o]||"info",ae=o=>({active:"已启用",inactive:"已禁用"})[o]||o,Ie=o=>({standby:"primary",distributed:"success",anycast:"warning"})[o]||"info",n=o=>({standby:"主备",distributed:"分布式",anycast:"Anycast"})[o]||o,t=o=>({IPv4:"primary",IPv6:"success",dual:"warning"})[o]||"info",x=o=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[o]||o;return(o,l)=>{const f=c("el-icon"),_=c("el-button"),J=c("el-input"),P=c("el-form-item"),K=c("el-option"),W=c("el-select"),_e=c("el-form"),v=c("el-table-column"),le=c("el-tag"),H=c("el-link"),Ce=c("el-tooltip"),r=c("el-table"),Ne=c("el-pagination"),Ge=c("el-card"),Te=c("el-dialog"),xe=he("loading");return y(),$("div",Ze,[a(Ge,{class:"box-card"},{header:s(()=>[u("div",et,[l[11]||(l[11]=u("span",null,"业务实例",-1)),u("div",null,[a(_,{type:"primary",onClick:te},{default:s(()=>[a(f,null,{default:s(()=>[a(Se(Ae))]),_:1}),l[10]||(l[10]=i(" 新增实例 "))]),_:1,__:[10]})])])]),default:s(()=>[u("div",tt,[a(_e,{inline:!0,model:m,class:"search-form"},{default:s(()=>[a(P,{label:"实例名称"},{default:s(()=>[a(J,{modelValue:m.instanceName,"onUpdate:modelValue":l[0]||(l[0]=d=>m.instanceName=d),placeholder:"请输入实例名称",clearable:""},null,8,["modelValue"])]),_:1}),a(P,{label:"客户"},{default:s(()=>[a(W,{modelValue:m.customerId,"onUpdate:modelValue":l[1]||(l[1]=d=>m.customerId=d),placeholder:"请选择客户",clearable:"",style:{width:"200px"}},{default:s(()=>[(y(!0),$(Y,null,Z(o.customerOptions,d=>(y(),I(K,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(P,null,{default:s(()=>[a(_,{type:"primary",onClick:M},{default:s(()=>l[12]||(l[12]=[i("搜索")])),_:1,__:[12]}),a(_,{onClick:ee},{default:s(()=>l[13]||(l[13]=[i("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),X((y(),I(r,{data:V.value,style:{width:"100%"},border:"",stripe:"",height:"calc(100vh - 200px)","row-class-name":"dense-row"},{empty:s(()=>l[19]||(l[19]=[u("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:s(()=>[a(v,{prop:"instanceId",label:"业务实例ID",width:"150",fixed:"left"}),a(v,{prop:"instanceName",label:"业务实例名称","min-width":"150"}),a(v,{prop:"customerName",label:"客户名称","min-width":"180"}),a(v,{prop:"orderId",label:"订单ID",width:"150"}),a(v,{prop:"packageName",label:"套餐名称",width:"120"}),a(v,{label:"集群类型",width:"120",filters:[{text:"主备",value:"standby"},{text:"分布式",value:"distributed"},{text:"Anycast",value:"anycast"}],"filter-method":ge,"filter-placement":"bottom-end"},{default:s(({row:d})=>[a(le,{type:Ie(d.clusterType)},{default:s(()=>[i(b(n(d.clusterType)),1)]),_:2},1032,["type"])]),_:1}),a(v,{prop:"addressType",label:"地址类型",width:"100",filters:[{text:"IPv4",value:"IPv4"},{text:"IPv6",value:"IPv6"},{text:"双栈",value:"dual"}],"filter-method":ve,"filter-placement":"bottom-end"},{default:s(({row:d})=>[a(le,{type:t(d.addressType)},{default:s(()=>[i(b(x(d.addressType)),1)]),_:2},1032,["type"])]),_:1}),a(v,{label:"逻辑集群组","min-width":"180"},{default:s(({row:d})=>[a(Ce,{effect:"light",content:j(d),placement:"top","show-after":500},{default:s(()=>[a(H,{type:"primary",onClick:A=>q(d)},{default:s(()=>[i(b(z(d)),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1}),a(v,{prop:"bandwidth",label:"防护带宽(Mbps)",width:"140",sortable:""}),a(v,{prop:"businessBandwidth",label:"业务带宽(Mbps)",width:"140",sortable:""}),a(v,{prop:"qps",label:"业务QPS",width:"120",sortable:""}),a(v,{prop:"protectionIpCount",label:"防护IP数",width:"120",sortable:""}),a(v,{prop:"domainCount",label:"防护域名数",width:"120",sortable:""}),a(v,{prop:"portCount",label:"端口数量",width:"120",sortable:""}),a(v,{prop:"status",label:"状态",width:"100",filters:[{text:"已启用",value:"active"},{text:"已禁用",value:"inactive"}],"filter-method":ye,"filter-placement":"bottom-end"},{default:s(({row:d})=>[a(le,{type:be(d.status)},{default:s(()=>[i(b(ae(d.status)),1)]),_:2},1032,["type"])]),_:1}),a(v,{prop:"createTime",label:"创建时间",width:"180",sortable:""}),a(v,{label:"操作",width:"320",fixed:"right"},{default:s(({row:d})=>[d.status==="inactive"?(y(),I(_,{key:0,type:"success",link:"",onClick:A=>re(d)},{default:s(()=>l[14]||(l[14]=[i(" 启用 ")])),_:2,__:[14]},1032,["onClick"])):U("",!0),d.status==="active"?(y(),I(_,{key:1,type:"warning",link:"",onClick:A=>de(d)},{default:s(()=>l[15]||(l[15]=[i(" 禁用 ")])),_:2,__:[15]},1032,["onClick"])):U("",!0),a(_,{type:"primary",link:"",onClick:A=>Q(d)},{default:s(()=>l[16]||(l[16]=[i(" 修改配置 ")])),_:2,__:[16]},1032,["onClick"]),a(_,{type:"primary",link:"",onClick:A=>ce(d)},{default:s(()=>l[17]||(l[17]=[i(" 分配防护IP ")])),_:2,__:[17]},1032,["onClick"]),a(_,{type:"danger",link:"",onClick:A=>pe(d)},{default:s(()=>l[18]||(l[18]=[i(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[xe,O.value]]),u("div",at,[a(Ne,{"current-page":e.pageNum,"onUpdate:currentPage":l[2]||(l[2]=d=>e.pageNum=d),"page-size":e.pageSize,"onUpdate:pageSize":l[3]||(l[3]=d=>e.pageSize=d),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.total,background:"",onSizeChange:E,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),a(Oe,{modelValue:S.value,"onUpdate:modelValue":l[4]||(l[4]=d=>S.value=d),"instance-data":w.value,"is-edit":G.value,onSuccess:me},null,8,["modelValue","instance-data","is-edit"]),a(Ye,{modelValue:D.value,"onUpdate:modelValue":l[5]||(l[5]=d=>D.value=d),"instance-data":w.value,onSuccess:fe},null,8,["modelValue","instance-data"]),a(Te,{modelValue:T.value,"onUpdate:modelValue":l[7]||(l[7]=d=>T.value=d),title:"确认启用",width:"400px"},{footer:s(()=>[a(_,{onClick:l[6]||(l[6]=d=>T.value=!1)},{default:s(()=>l[22]||(l[22]=[i("取消")])),_:1,__:[22]}),a(_,{type:"success",onClick:ue},{default:s(()=>l[23]||(l[23]=[i("确认启用")])),_:1,__:[23]})]),default:s(()=>{var d,A;return[u("div",null,[l[20]||(l[20]=i("确定要启用业务实例 ")),u("b",null,b((d=w.value)==null?void 0:d.instanceName),1),l[21]||(l[21]=i(" 吗？"))]),u("div",lt,"ID: "+b((A=w.value)==null?void 0:A.instanceId),1)]}),_:1},8,["modelValue"]),a(Te,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=d=>k.value=d),title:"确认禁用",width:"400px"},{footer:s(()=>[a(_,{onClick:l[8]||(l[8]=d=>k.value=!1)},{default:s(()=>l[26]||(l[26]=[i("取消")])),_:1,__:[26]}),a(_,{type:"warning",onClick:ie},{default:s(()=>l[27]||(l[27]=[i("确认禁用")])),_:1,__:[27]})]),default:s(()=>{var d,A;return[u("div",null,[l[24]||(l[24]=i("确定要禁用业务实例 ")),u("b",null,b((d=w.value)==null?void 0:d.instanceName),1),l[25]||(l[25]=i(" 吗？"))]),u("div",st,"ID: "+b((A=w.value)==null?void 0:A.instanceId),1)]}),_:1},8,["modelValue"])])}}},rt=Ve(nt,[["__scopeId","data-v-636e39ab"]]);export{rt as default};
