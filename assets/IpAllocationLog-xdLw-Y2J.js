import{_ as te,a as h,r as V,o as oe,b as ae,d as t,w as a,h as $,i as le,e as v,k as i,u as R,z as ne,A as re,B as ie,f as se,l as O,t as c,s as de,E as N,g as L}from"./index-BkzSK6KU.js";class pe{async queryIpAllocationLogs(l){return new Promise(I=>{setTimeout(()=>{const{pageNum:S=1,pageSize:_=10}=l,f=[];for(let p=0;p<_;p++){const u=(S-1)*_+p;if(u>=100)break;const g=u%3!==0?"allocate":"reclaim",w=new Date;w.setDate(w.getDate()-u),f.push({id:`IPAL${String(u+1).padStart(6,"0")}`,ipAddress:`192.168.${Math.floor(u/255)+1}.${u%255+1}`,instanceId:`INST${String(Math.floor(u/3)+1).padStart(6,"0")}`,instanceName:`业务实例-${Math.floor(u/3)+1}`,customerId:`CUST${String(Math.floor(u/10)+1).padStart(4,"0")}`,customerName:`客户-${Math.floor(u/10)+1}`,operationType:g,operationTime:w.toISOString(),operatorId:`USER${String(u%5+1).padStart(4,"0")}`,operatorName:`操作员-${u%5+1}`,ipPoolId:`POOL${String(u%3+1).padStart(4,"0")}`,ipPoolName:`IP池-${u%3+1}`,regionId:`region-${u%6+1}`,regionName:`地域-${u%6+1}`,remark:g==="allocate"?`分配IP用于${["Web服务","API服务","数据库服务","缓存服务","负载均衡"][u%5]}`:"回收闲置IP资源"})}let o=[...f];if(l.ipAddress&&(o=o.filter(p=>p.ipAddress.includes(l.ipAddress))),l.instanceId&&(o=o.filter(p=>p.instanceId.includes(l.instanceId)||p.instanceName.includes(l.instanceId))),l.customerId&&(o=o.filter(p=>p.customerId.includes(l.customerId)||p.customerName.includes(l.customerId))),l.operationType&&(o=o.filter(p=>p.operationType===l.operationType)),l.ipPoolId&&(o=o.filter(p=>p.ipPoolId===l.ipPoolId)),l.regionId&&(o=o.filter(p=>p.regionId===l.regionId)),l.dateRange&&l.dateRange.length===2){const p=new Date(l.dateRange[0]),u=new Date(l.dateRange[1]);o=o.filter(s=>{const g=new Date(s.operationTime);return g>=p&&g<=u})}I({records:o,total:Math.min(100,o.length),pageNum:S,pageSize:_})},500)})}async getIpAllocationLogDetail(l){return new Promise(I=>{setTimeout(()=>{const r=parseInt(l.replace("IPAL",""))-1,_=r%3!==0?"allocate":"reclaim",f=new Date;f.setDate(f.getDate()-r),I({id:l,ipAddress:`192.168.${Math.floor(r/255)+1}.${r%255+1}`,instanceId:`INST${String(Math.floor(r/3)+1).padStart(6,"0")}`,instanceName:`业务实例-${Math.floor(r/3)+1}`,customerId:`CUST${String(Math.floor(r/10)+1).padStart(4,"0")}`,customerName:`客户-${Math.floor(r/10)+1}`,operationType:_,operationTime:f.toISOString(),operatorId:`USER${String(r%5+1).padStart(4,"0")}`,operatorName:`操作员-${r%5+1}`,ipPoolId:`POOL${String(r%3+1).padStart(4,"0")}`,ipPoolName:`IP池-${r%3+1}`,regionId:`region-${r%6+1}`,regionName:`地域-${r%6+1}`,remark:_==="allocate"?`分配IP用于${["Web服务","API服务","数据库服务","缓存服务","负载均衡"][r%5]}`:"回收闲置IP资源",requestId:`REQ${String(r+1e3).padStart(8,"0")}`,approvalStatus:"approved",approvalTime:new Date(f.getTime()-36e5).toISOString(),approvalBy:`审批员-${r%3+1}`,networkType:["公网","内网","混合"][r%3],bandwidth:`${(r%10+1)*100}Mbps`,ipVersion:["IPv4","IPv6","Dual Stack"][r%3],createTime:new Date(f.getTime()-72e5).toISOString(),updateTime:f.toISOString()})},300)})}async exportIpAllocationLogs(l){return new Promise(I=>{setTimeout(()=>{I({success:!0,message:"导出成功",url:"#"})},1e3)})}async getIpPools(){return new Promise(l=>{setTimeout(()=>{l([{id:"POOL0001",name:"IP池-1"},{id:"POOL0002",name:"IP池-2"},{id:"POOL0003",name:"IP池-3"}])},200)})}async getRegions(){return new Promise(l=>{setTimeout(()=>{l([{id:"region-1",name:"地域-1"},{id:"region-2",name:"地域-2"},{id:"region-3",name:"地域-3"},{id:"region-4",name:"地域-4"},{id:"region-5",name:"地域-5"},{id:"region-6",name:"地域-6"}])},200)})}}const D=new pe,ue={class:"ip-allocation-log-page"},ce={class:"log-header"},me={class:"header-actions"},ge={class:"search-bar"},Ie={class:"pagination-container"},fe={__name:"IpAllocationLog",setup(z){const l=h(!1),I=h(1),r=h(10),S=h(0),_=h([]),f=h(!1),o=h(null),p=h([]),u=h([]),s=V({ipAddress:"",instanceId:"",customerId:"",dateRange:null}),g=V({operationType:null,ipPoolId:null,regionId:null}),w=V({prop:"operationTime",order:"descending"}),b=async()=>{l.value=!0;try{const n={ipAddress:s.ipAddress,instanceId:s.instanceId,customerId:s.customerId,dateRange:s.dateRange,operationType:g.operationType,ipPoolId:g.ipPoolId,regionId:g.regionId,pageNum:I.value,pageSize:r.value,sortField:w.prop,sortOrder:w.order},e=await D.queryIpAllocationLogs(n);_.value=e.records,S.value=e.total}catch(n){console.error("获取IP分配历史数据失败",n),N.error("获取数据失败，请稍后重试")}finally{l.value=!1}},M=async()=>{try{const n=await D.getIpPools();p.value=n.map(y=>({text:y.name,value:y.id}));const e=await D.getRegions();u.value=e.map(y=>({text:y.name,value:y.id}))}catch(n){console.error("获取过滤选项失败",n)}},U=()=>{I.value=1,b()},B=()=>{s.ipAddress="",s.instanceId="",s.customerId="",s.dateRange=null,g.operationType=null,g.ipPoolId=null,g.regionId=null,I.value=1,b()},x=n=>{s[n]=""},E=()=>{b()},F=async()=>{try{l.value=!0;const n={ipAddress:s.ipAddress,instanceId:s.instanceId,customerId:s.customerId,dateRange:s.dateRange,operationType:g.operationType,ipPoolId:g.ipPoolId,regionId:g.regionId},e=await D.exportIpAllocationLogs(n);e.success?N.success("导出成功"):N.error(e.message||"导出失败")}catch(n){console.error("导出数据失败",n),N.error("导出失败，请稍后重试")}finally{l.value=!1}},q=n=>{r.value=n,b()},W=n=>{I.value=n,b()},j=({prop:n,order:e})=>{n&&(w.prop=n,w.order=e,b())},Q=n=>{n.operationType?this.filters.operationType=n.operationType[0]:this.filters.operationType=null,n.ipPoolId?this.filters.ipPoolId=n.ipPoolId[0]:this.filters.ipPoolId=null,n.regionId?this.filters.regionId=n.regionId[0]:this.filters.regionId=null,I.value=1,b()},G=async n=>{l.value=!0;try{const e=await D.getIpAllocationLogDetail(n.id);o.value=e,f.value=!0}catch(e){console.error("获取详情失败",e),N.error("获取详情失败，请稍后重试")}finally{l.value=!1}},T=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-";return oe(()=>{M(),b()}),(n,e)=>{const y=v("el-icon"),A=v("el-button"),C=v("el-input"),H=v("el-date-picker"),P=v("el-table-column"),k=v("el-tag"),J=v("el-table"),K=v("el-pagination"),X=v("el-card"),m=v("el-descriptions-item"),Y=v("el-descriptions"),Z=v("el-drawer"),ee=se("loading");return L(),ae("div",ue,[t(X,{class:"log-card"},{default:a(()=>[$("div",ce,[e[12]||(e[12]=$("h3",null,"IP分配历史",-1)),$("div",me,[t(A,{type:"primary",onClick:E},{default:a(()=>[t(y,null,{default:a(()=>[t(R(ne))]),_:1}),e[10]||(e[10]=i(" 刷新 "))]),_:1,__:[10]}),t(A,{type:"success",onClick:F},{default:a(()=>[t(y,null,{default:a(()=>[t(R(re))]),_:1}),e[11]||(e[11]=i(" 导出 "))]),_:1,__:[11]})])]),$("div",ge,[t(C,{modelValue:s.ipAddress,"onUpdate:modelValue":e[0]||(e[0]=d=>s.ipAddress=d),placeholder:"IP地址",style:{width:"180px"},clearable:"",onClear:e[1]||(e[1]=d=>x("ipAddress"))},{prefix:a(()=>[t(y,null,{default:a(()=>[t(R(ie))]),_:1})]),_:1},8,["modelValue"]),t(C,{modelValue:s.instanceId,"onUpdate:modelValue":e[2]||(e[2]=d=>s.instanceId=d),placeholder:"业务实例ID/名称",style:{width:"180px","margin-left":"10px"},clearable:"",onClear:e[3]||(e[3]=d=>x("instanceId"))},null,8,["modelValue"]),t(C,{modelValue:s.customerId,"onUpdate:modelValue":e[4]||(e[4]=d=>s.customerId=d),placeholder:"客户ID/名称",style:{width:"180px","margin-left":"10px"},clearable:"",onClear:e[5]||(e[5]=d=>x("customerId"))},null,8,["modelValue"]),t(H,{modelValue:s.dateRange,"onUpdate:modelValue":e[6]||(e[6]=d=>s.dateRange=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-left":"10px",width:"320px"}},null,8,["modelValue"]),t(A,{type:"primary",onClick:U,style:{"margin-left":"10px"}},{default:a(()=>e[13]||(e[13]=[i("搜索")])),_:1,__:[13]}),t(A,{onClick:B},{default:a(()=>e[14]||(e[14]=[i("重置")])),_:1,__:[14]})]),le((L(),O(J,{data:_.value,style:{width:"100%","margin-top":"15px"},border:"",stripe:"",size:"small",onSortChange:j,onFilterChange:Q},{default:a(()=>[t(P,{prop:"ipAddress",label:"IP地址","min-width":"120",sortable:"custom"}),t(P,{prop:"instanceName",label:"业务实例","min-width":"120","show-overflow-tooltip":""}),t(P,{prop:"customerName",label:"客户","min-width":"120","show-overflow-tooltip":""}),t(P,{prop:"operationType",label:"操作类型",width:"100",filters:[{text:"分配",value:"allocate"},{text:"回收",value:"reclaim"}],"column-key":"operationType"},{default:a(d=>[t(k,{type:d.row.operationType==="allocate"?"success":"danger",size:"small"},{default:a(()=>[i(c(d.row.operationType==="allocate"?"分配":"回收"),1)]),_:2},1032,["type"])]),_:1}),t(P,{prop:"operationTime",label:"操作时间","min-width":"180",sortable:"custom"},{default:a(d=>[i(c(T(d.row.operationTime)),1)]),_:1}),t(P,{prop:"operatorName",label:"操作人",width:"100"}),t(P,{prop:"ipPoolName",label:"IP池",width:"100",filters:p.value,"column-key":"ipPoolId"},null,8,["filters"]),t(P,{prop:"regionName",label:"地域",width:"100",filters:u.value,"column-key":"regionId"},null,8,["filters"]),t(P,{label:"操作",fixed:"right",width:"80"},{default:a(d=>[t(A,{link:"",type:"primary",onClick:ve=>G(d.row),size:"small"},{default:a(()=>e[15]||(e[15]=[i(" 详情 ")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,l.value]]),$("div",Ie,[t(K,{"current-page":I.value,"onUpdate:currentPage":e[7]||(e[7]=d=>I.value=d),"page-size":r.value,"onUpdate:pageSize":e[8]||(e[8]=d=>r.value=d),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:q,onCurrentChange:W,small:""},null,8,["current-page","page-size","total"])])]),_:1}),t(Z,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=d=>f.value=d),title:"IP分配历史详情",direction:"rtl",size:"500px","destroy-on-close":!0},{default:a(()=>[o.value?(L(),O(Y,{key:0,column:1,border:"",style:{padding:"0 20px"}},{default:a(()=>[t(m,{label:"IP地址"},{default:a(()=>[i(c(o.value.ipAddress),1)]),_:1}),t(m,{label:"业务实例"},{default:a(()=>[i(c(o.value.instanceId)+" / "+c(o.value.instanceName),1)]),_:1}),t(m,{label:"客户"},{default:a(()=>[i(c(o.value.customerId)+" / "+c(o.value.customerName),1)]),_:1}),t(m,{label:"操作类型"},{default:a(()=>[t(k,{type:o.value.operationType==="allocate"?"success":"danger"},{default:a(()=>[i(c(o.value.operationType==="allocate"?"分配":"回收"),1)]),_:1},8,["type"])]),_:1}),t(m,{label:"操作时间"},{default:a(()=>[i(c(T(o.value.operationTime)),1)]),_:1}),t(m,{label:"操作人"},{default:a(()=>[i(c(o.value.operatorName),1)]),_:1}),t(m,{label:"IP池"},{default:a(()=>[i(c(o.value.ipPoolName),1)]),_:1}),t(m,{label:"地域"},{default:a(()=>[i(c(o.value.regionName),1)]),_:1}),t(m,{label:"请求ID"},{default:a(()=>[i(c(o.value.requestId),1)]),_:1}),t(m,{label:"审批状态"},{default:a(()=>[t(k,{type:"success"},{default:a(()=>e[16]||(e[16]=[i("已审批")])),_:1,__:[16]})]),_:1}),t(m,{label:"审批时间"},{default:a(()=>[i(c(T(o.value.approvalTime)),1)]),_:1}),t(m,{label:"审批人"},{default:a(()=>[i(c(o.value.approvalBy),1)]),_:1}),t(m,{label:"网络类型"},{default:a(()=>[i(c(o.value.networkType),1)]),_:1}),t(m,{label:"带宽"},{default:a(()=>[i(c(o.value.bandwidth),1)]),_:1}),t(m,{label:"IP版本"},{default:a(()=>[i(c(o.value.ipVersion),1)]),_:1}),t(m,{label:"创建时间"},{default:a(()=>[i(c(T(o.value.createTime)),1)]),_:1}),t(m,{label:"更新时间"},{default:a(()=>[i(c(T(o.value.updateTime)),1)]),_:1}),t(m,{label:"备注"},{default:a(()=>[i(c(o.value.remark),1)]),_:1})]),_:1})):de("",!0)]),_:1},8,["modelValue"])])}}},ye=te(fe,[["__scopeId","data-v-e45330e1"]]);export{ye as default};
