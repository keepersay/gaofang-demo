import{_ as Ve,a as I,r as re,c as ne,n as j,e as m,l as C,g as f,w as l,d as a,h as d,i as Z,b as R,F as se,p as oe,t as g,z as le,v as z,k as c,B as A,E as y,A as ke,C as we,o as Ge,j as xe,u as he,G as De,f as Se,q as Ae}from"./index-DSuGjjsZ.js";const Ue={style:{color:"#999"}},Be={style:{display:"flex","justify-content":"space-between","align-items":"center"}},$e={key:0,class:"form-tip"},ze={style:{"margin-top":"20px",display:"flex","justify-content":"space-between"}},Re={__name:"BusinessInstanceModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(U,{emit:M}){const k=U,B=M,x=I(!1),w=re({customers:!1,orders:!1,regions:!1,clusterGroups:!1,resourceCheck:!1}),v=I({}),P=ne({get:()=>k.modelValue,set:o=>B("update:modelValue",o)}),b=ne(()=>k.isEdit),h=I(),u=I(0),e=re({instanceName:"",customerId:"",customerName:"",orderId:"",packageId:"",packageName:"",packageType:1,clusterType:"standby",addressType:"IPv4",regionId:"",adsProtection:!0,ccProtection:!1,wafProtection:!1,bandwidth:100,businessBandwidth:50,qps:1e3,protectionIpCount:1,domainCount:10,portCount:10,status:"active",remark:"",clusterGroupId:"",previousClusterGroupId:""}),T={instanceName:[{required:!0,message:"请输入业务实例名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"change"}],orderId:[{required:!0,message:"请选择关联订单",trigger:"change"}],clusterType:[{required:!0,message:"请选择集群类型",trigger:"change"}],addressType:[{required:!0,message:"请选择地址类型",trigger:"change"}],regionId:[{required:()=>e.clusterType==="standby",message:"请选择地域",trigger:"change"}],clusterGroupId:[{required:!0,message:"请选择逻辑集群组",trigger:"change"}],status:[{required:!0,message:"请选择实例状态",trigger:"change"}]},F=I([]),D=I([]),L=I([]),q=I([]),E=()=>{e.instanceName="",e.customerId="",e.customerName="",e.orderId="",e.packageId="",e.packageName="",e.packageType=1,e.clusterType="standby",e.addressType="IPv4",e.regionId="",e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1,e.bandwidth=100,e.businessBandwidth=50,e.qps=1e3,e.protectionIpCount=1,e.domainCount=10,e.portCount=10,e.status="active",e.remark="",e.clusterGroupId="",e.previousClusterGroupId=""};j(()=>k.instanceData,o=>{o?(Object.keys(e).forEach(t=>{o[t]!==void 0&&(e[t]=o[t])}),o.packageName&&(o.packageName==="DDOS防护"?(e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1,e.packageType=1,o.clusterType||(e.clusterType="standby")):o.packageName==="WAF标准防护"?(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1,e.packageType=2,o.clusterType||(e.clusterType="distributed")):o.packageName==="WAF增强防护"&&(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0,e.packageType=3,o.clusterType||(e.clusterType="anycast"))),!o.clusterType&&o.isAnycast!==void 0&&(e.clusterType=o.isAnycast?"anycast":"standby"),o.clusterGroupId&&fe(o.clusterGroupId),Y()):E()},{immediate:!0,deep:!0}),j(()=>P.value,o=>{o&&(u.value=0,ke(()=>{ee(),K(),me()}))});const ee=async()=>{try{F.value=[{customerId:"CUST1001",customerName:"北京科技有限公司"},{customerId:"CUST1002",customerName:"上海网络科技有限公司"},{customerId:"CUST1003",customerName:"广州信息技术有限公司"},{customerId:"CUST1004",customerName:"深圳互联网有限公司"},{customerId:"CUST1005",customerName:"杭州数字科技有限公司"}]}catch(o){console.error("获取客户列表失败:",o)}},Y=async()=>{try{const o=new URLSearchParams;e.customerId&&o.append("customerId",e.customerId);const t=await A.getAvailableOrders({customerId:e.customerId});t.code===200&&(D.value=t.data)}catch(o){console.error("获取订单列表失败:",o)}},K=async()=>{try{L.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(o){console.error("获取地域列表失败:",o)}},N=o=>{e.orderId="";const t=F.value.find(G=>G.customerId===o);t&&(e.customerName=t.customerName),Y()},te=o=>{const t=D.value.find(G=>G.orderId===o);t&&(e.packageName=t.packageName,t.packageName==="DDOS防护"?(e.packageType=1,e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1):t.packageName==="WAF标准防护"?(e.packageType=2,e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1):t.packageName==="WAF增强防护"&&(e.packageType=3,e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0),t.clusterType&&(e.clusterType=t.clusterType),e.clusterType==="anycast"&&(e.regionId=""),e.clusterGroupId="",e.previousClusterGroupId="")},Q=()=>{u.value>0&&u.value--},ue=async()=>{if(u.value===0)try{await h.value.validateField(["instanceName","customerId","orderId"]),u.value++}catch(o){console.error(o)}else if(u.value===1)try{await h.value.validateField(["addressType"]),e.clusterType==="standby"&&await h.value.validateField(["regionId"]),await h.value.validateField(["clusterGroupId"]),u.value++}catch(o){console.error(o)}else u.value<4&&u.value++},de=()=>{P.value=!1,E()},ie=async()=>{try{await h.value.validate(),x.value=!0;let o;if(k.isEdit){const t={...e},G=t.clusterGroupId!==k.instanceData.clusterGroupId;o=await A.updateBusinessInstance(k.instanceData.instanceId,t),o.code===200?(y.success("更新成功"),G&&((await A.autoAllocateIpGroups(o.data.instanceId)).code===200?y.success("已自动重新分配防护IP组"):y.warning("自动分配防护IP组失败，可能需要手动分配")),P.value=!1,B("success")):y.error(o.message||"更新失败")}else o=await A.createBusinessInstance(e),o.code===200?(y.success("创建成功"),(await A.autoAllocateIpGroups(o.data.instanceId)).code===200?y.success("已自动分配防护IP组"):y.warning("自动分配防护IP组失败，可能需要手动分配"),P.value=!1,B("success")):y.error(o.message||"创建失败")}catch(o){console.error("表单提交失败:",o)}finally{x.value=!1}},ce=o=>{o===1?(e.adsProtection=!0,e.ccProtection=!1,e.wafProtection=!1):o===2?(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!1):o===3&&(e.adsProtection=!0,e.ccProtection=!0,e.wafProtection=!0)},pe=()=>{e.clusterType!=="anycast"&&e.regionId};j(()=>e.clusterType,o=>{(o==="anycast"||o==="distributed")&&(e.regionId="")}),j([()=>e.clusterType,()=>e.addressType],([o])=>{(o==="anycast"||o==="distributed")&&(e.regionId=""),e.clusterGroupId&&ae(e.clusterGroupId)}),j(()=>e.protectionIpCount,(o,t)=>{o!==t&&e.clusterGroupId&&ae(e.clusterGroupId)});const me=async()=>{try{w.clusterGroups=!0;const o=await we.getClusterGroups();q.value=o}catch(o){console.error("获取逻辑集群组列表失败:",o),y.error("获取逻辑集群组列表失败")}finally{w.clusterGroups=!1}},fe=async o=>{try{const t=await we.getClusterGroupById(o);t&&(e.clusterGroupId=t.id)}catch(t){console.error("获取逻辑集群组详情失败:",t)}},ye=ne(()=>q.value.length?q.value.filter(o=>o.status!=="active"?!1:e.clusterType==="standby"?o.type==="standby"||!o.type&&!o.distributed:e.clusterType==="distributed"?o.type==="distributed"||!o.type&&o.distributed:e.clusterType==="anycast"?o.type==="anycast":!0):[]),ge=o=>o.type==="anycast"?"warning":o.type==="distributed"||o.distributed?"success":"info",ve=o=>o.type==="anycast"?"Anycast":o.type==="distributed"||o.distributed?"分布式":"主备",_e=async()=>{e.clusterGroupId!==e.previousClusterGroupId&&(await ae(e.clusterGroupId),e.previousClusterGroupId=e.clusterGroupId)},ae=async o=>{if(o){w.resourceCheck=!0;try{const t=await A.checkClusterGroupIpResource(o,e.addressType,e.protectionIpCount);t.code===200?(v.value={...v.value,[o]:t.data.sufficient?"sufficient":"insufficient"},t.data.sufficient||y.warning(`所选逻辑集群组的IP资源不足，无法满足${e.protectionIpCount}组IP的分配需求`)):y.error(t.message||"检查资源充足性失败")}catch(t){console.error("检查资源充足性失败:",t),y.error("检查资源充足性失败")}finally{w.resourceCheck=!1}}},Ie=()=>{(e.clusterType==="anycast"||e.clusterType==="distributed")&&(e.regionId=""),e.clusterGroupId="",e.previousClusterGroupId=""};return(o,t)=>{const G=m("el-step"),n=m("el-steps"),s=m("el-input"),p=m("el-form-item"),O=m("el-option"),H=m("el-select"),V=m("el-radio"),J=m("el-radio-group"),W=m("el-tag"),_=m("el-alert"),$=m("el-input-number"),be=m("el-form"),X=m("el-button"),Ce=m("el-dialog");return f(),C(Ce,{modelValue:P.value,"onUpdate:modelValue":t[16]||(t[16]=r=>P.value=r),title:b.value?"修改业务实例":"新增业务实例",width:"60%","destroy-on-close":""},{default:l(()=>[a(n,{active:u.value,"finish-status":"success",simple:"",style:{"margin-bottom":"20px"}},{default:l(()=>[a(G,{title:"基本信息"}),a(G,{title:"部署配置"}),a(G,{title:"防护选项"}),a(G,{title:"资源配置"}),a(G,{title:"状态与备注"})]),_:1},8,["active"]),a(be,{ref_key:"formRef",ref:h,model:e,rules:T,"label-width":"120px",style:{"max-height":"500px","overflow-y":"auto"}},{default:l(()=>[Z(d("div",null,[a(p,{label:"业务实例名称",prop:"instanceName"},{default:l(()=>[a(s,{modelValue:e.instanceName,"onUpdate:modelValue":t[0]||(t[0]=r=>e.instanceName=r),placeholder:"请输入业务实例名称"},null,8,["modelValue"])]),_:1}),a(p,{label:"客户",prop:"customerId"},{default:l(()=>[a(H,{modelValue:e.customerId,"onUpdate:modelValue":t[1]||(t[1]=r=>e.customerId=r),placeholder:"请选择客户",filterable:"",style:{width:"100%"},onChange:N},{default:l(()=>[(f(!0),R(se,null,oe(F.value,r=>(f(),C(O,{key:r.customerId,label:r.customerName,value:r.customerId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"关联订单",prop:"orderId"},{default:l(()=>[a(H,{modelValue:e.orderId,"onUpdate:modelValue":t[2]||(t[2]=r=>e.orderId=r),placeholder:"请选择关联订单",filterable:"",style:{width:"100%"},disabled:!e.customerId,onChange:te},{default:l(()=>[(f(!0),R(se,null,oe(D.value,r=>(f(),C(O,{key:r.orderId,label:r.orderId,value:r.orderId},{default:l(()=>[d("div",null,[d("div",null,g(r.orderId),1),d("small",Ue,g(r.packageName),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})],512),[[le,u.value===0]]),Z(d("div",null,[a(p,{label:"集群类型",prop:"clusterType"},{default:l(()=>[a(J,{modelValue:e.clusterType,"onUpdate:modelValue":t[3]||(t[3]=r=>e.clusterType=r),onChange:Ie},{default:l(()=>[a(V,{value:"standby"},{default:l(()=>t[17]||(t[17]=[c("主备")])),_:1,__:[17]}),a(V,{value:"distributed"},{default:l(()=>t[18]||(t[18]=[c("分布式")])),_:1,__:[18]}),a(V,{value:"anycast"},{default:l(()=>t[19]||(t[19]=[c("Anycast")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"地址类型",prop:"addressType"},{default:l(()=>[a(J,{modelValue:e.addressType,"onUpdate:modelValue":t[4]||(t[4]=r=>e.addressType=r)},{default:l(()=>[a(V,{value:"IPv4"},{default:l(()=>t[20]||(t[20]=[c("IPv4")])),_:1,__:[20]}),a(V,{value:"IPv6"},{default:l(()=>t[21]||(t[21]=[c("IPv6")])),_:1,__:[21]}),a(V,{value:"dual"},{default:l(()=>t[22]||(t[22]=[c("双栈")])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),e.clusterType==="standby"?(f(),C(p,{key:0,label:"地域",prop:"regionId"},{default:l(()=>[a(H,{modelValue:e.regionId,"onUpdate:modelValue":t[5]||(t[5]=r=>e.regionId=r),placeholder:"请选择地域",style:{width:"100%"},onChange:pe},{default:l(()=>[(f(!0),R(se,null,oe(L.value,r=>(f(),C(O,{key:r.regionId,label:r.regionName,value:r.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):z("",!0),a(p,{label:"逻辑集群组",prop:"clusterGroupId"},{default:l(()=>[a(H,{modelValue:e.clusterGroupId,"onUpdate:modelValue":t[6]||(t[6]=r=>e.clusterGroupId=r),placeholder:"请选择逻辑集群组",filterable:"",style:{width:"100%"},loading:w.clusterGroups,onChange:_e},{default:l(()=>[(f(!0),R(se,null,oe(ye.value,r=>(f(),C(O,{key:r.id,label:r.name,value:r.id,disabled:v.value[r.id]==="insufficient"},{default:l(()=>[d("div",Be,[d("span",null,g(r.name),1),d("div",null,[a(W,{size:"small",type:ge(r),style:{"margin-right":"5px"}},{default:l(()=>[c(g(ve(r)),1)]),_:2},1032,["type"]),v.value[r.id]?(f(),C(W,{key:0,size:"small",type:v.value[r.id]==="sufficient"?"success":"danger"},{default:l(()=>[c(g(v.value[r.id]==="sufficient"?"资源充足":"资源不足"),1)]),_:2},1032,["type"])):z("",!0)])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"]),t[23]||(t[23]=d("div",{class:"form-tip"},"请选择与订单集群类型相匹配的逻辑集群组",-1)),w.resourceCheck?(f(),R("div",$e,"正在检查网池资源充足性...")):z("",!0)]),_:1,__:[23]})],512),[[le,u.value===1]]),Z(d("div",null,[a(_,{title:"防护配置与套餐对应关系",type:"info",description:"ADS防护 -> DDOS防护；ADS防护+CC防护 -> WAF标准防护；ADS防护+CC防护+WAF防护 -> WAF增强防护",closable:!1,style:{"margin-bottom":"20px"}}),a(p,{label:"套餐选择",prop:"packageType"},{default:l(()=>[a(J,{modelValue:e.packageType,"onUpdate:modelValue":t[7]||(t[7]=r=>e.packageType=r),onChange:ce},{default:l(()=>[a(V,{label:1},{default:l(()=>t[24]||(t[24]=[c("DDOS防护（仅ADS防护）")])),_:1,__:[24]}),a(V,{label:2},{default:l(()=>t[25]||(t[25]=[c("WAF标准防护（ADS+CC防护）")])),_:1,__:[25]}),a(V,{label:3},{default:l(()=>t[26]||(t[26]=[c("WAF增强防护（ADS+CC+WAF防护）")])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"防护内容"},{default:l(()=>[e.adsProtection?(f(),C(W,{key:0,type:"success",style:{"margin-right":"5px"}},{default:l(()=>t[27]||(t[27]=[c("ADS防护")])),_:1,__:[27]})):z("",!0),e.ccProtection?(f(),C(W,{key:1,type:"warning",style:{"margin-right":"5px"}},{default:l(()=>t[28]||(t[28]=[c("CC防护")])),_:1,__:[28]})):z("",!0),e.wafProtection?(f(),C(W,{key:2,type:"danger"},{default:l(()=>t[29]||(t[29]=[c("WAF防护")])),_:1,__:[29]})):z("",!0)]),_:1})],512),[[le,u.value===2]]),Z(d("div",null,[a(p,{label:"防护带宽(Mbps)",prop:"bandwidth"},{default:l(()=>[a($,{modelValue:e.bandwidth,"onUpdate:modelValue":t[8]||(t[8]=r=>e.bandwidth=r),min:1,max:1e4},null,8,["modelValue"])]),_:1}),a(p,{label:"业务带宽(Mbps)",prop:"businessBandwidth"},{default:l(()=>[a($,{modelValue:e.businessBandwidth,"onUpdate:modelValue":t[9]||(t[9]=r=>e.businessBandwidth=r),min:1,max:5e3},null,8,["modelValue"])]),_:1}),a(p,{label:"业务QPS",prop:"qps"},{default:l(()=>[a($,{modelValue:e.qps,"onUpdate:modelValue":t[10]||(t[10]=r=>e.qps=r),min:1,max:1e5},null,8,["modelValue"])]),_:1}),a(p,{label:"防护IP数",prop:"protectionIpCount"},{default:l(()=>[a($,{modelValue:e.protectionIpCount,"onUpdate:modelValue":t[11]||(t[11]=r=>e.protectionIpCount=r),min:1,max:100},null,8,["modelValue"])]),_:1}),a(p,{label:"防护域名数",prop:"domainCount"},{default:l(()=>[a($,{modelValue:e.domainCount,"onUpdate:modelValue":t[12]||(t[12]=r=>e.domainCount=r),min:1,max:1e3},null,8,["modelValue"])]),_:1}),a(p,{label:"端口数量",prop:"portCount"},{default:l(()=>[a($,{modelValue:e.portCount,"onUpdate:modelValue":t[13]||(t[13]=r=>e.portCount=r),min:1,max:100},null,8,["modelValue"])]),_:1})],512),[[le,u.value===3]]),Z(d("div",null,[a(p,{label:"实例状态",prop:"status"},{default:l(()=>[a(J,{modelValue:e.status,"onUpdate:modelValue":t[14]||(t[14]=r=>e.status=r)},{default:l(()=>[a(V,{label:"active"},{default:l(()=>t[30]||(t[30]=[c("启用")])),_:1,__:[30]}),a(V,{label:"inactive"},{default:l(()=>t[31]||(t[31]=[c("禁用")])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"备注",prop:"remark"},{default:l(()=>[a(s,{modelValue:e.remark,"onUpdate:modelValue":t[15]||(t[15]=r=>e.remark=r),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})],512),[[le,u.value===4]])]),_:1},8,["model"]),d("div",ze,[d("div",null,[u.value>0?(f(),C(X,{key:0,onClick:Q},{default:l(()=>t[32]||(t[32]=[c("上一步")])),_:1,__:[32]})):z("",!0)]),d("div",null,[a(X,{onClick:de},{default:l(()=>t[33]||(t[33]=[c("取消")])),_:1,__:[33]}),u.value<4?(f(),C(X,{key:0,type:"primary",onClick:ue},{default:l(()=>t[34]||(t[34]=[c("下一步")])),_:1,__:[34]})):(f(),C(X,{key:1,type:"primary",onClick:ie},{default:l(()=>t[35]||(t[35]=[c("提交")])),_:1,__:[35]}))])])]),_:1},8,["modelValue","title"])}}},Fe=Ve(Re,[["__scopeId","data-v-5ff56af9"]]),Oe={key:0},Me={class:"info-section"},qe={class:"info-item"},Ee={class:"info-item"},We={class:"info-item"},je={class:"info-item"},Le={class:"info-item"},Ye={key:0},Ke={class:"card-header"},Qe={class:"group-title"},He={class:"group-id"},Je={class:"ip-count"},Xe={class:"dialog-footer"},Ze={__name:"IpAllocationModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null}},emits:["update:modelValue","success"],setup(U,{emit:M}){const k=U,B=M,x=ne({get:()=>k.modelValue,set:u=>B("update:modelValue",u)}),w=I(!1),v=I([]),P=async()=>{if(k.instanceData){w.value=!0;try{const u=await A.allocateProtectionIps(k.instanceData.instanceId);u.code===200&&u.data?v.value=u.data.protectionIpGroups||[]:(v.value=[],y.error(u.message||"获取防护IP组失败"))}catch(u){console.error("获取防护IP组失败:",u),y.error("获取防护IP组失败"),v.value=[]}finally{w.value=!1}}};j(()=>k.instanceData,u=>{u&&ke(()=>{P()})},{immediate:!0}),j(()=>x.value,u=>{u&&k.instanceData&&ke(()=>{P()})});const b=()=>{x.value=!1},h=u=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[u]||u;return(u,e)=>{var K;const T=m("el-divider"),F=m("el-tag"),D=m("el-table-column"),L=m("el-table"),q=m("el-card"),E=m("el-empty"),ee=m("el-button"),Y=m("el-dialog");return f(),C(Y,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=N=>x.value=N),title:`分配防护IP - ${((K=U.instanceData)==null?void 0:K.instanceName)||""}`,width:"70%","destroy-on-close":""},{footer:l(()=>[d("div",Xe,[a(ee,{onClick:b},{default:l(()=>e[7]||(e[7]=[c("关闭")])),_:1,__:[7]})])]),default:l(()=>[U.instanceData?(f(),R("div",Oe,[d("div",Me,[d("div",qe,[e[1]||(e[1]=d("span",{class:"label"},"业务实例ID:",-1)),d("span",null,g(U.instanceData.instanceId),1)]),d("div",Ee,[e[2]||(e[2]=d("span",{class:"label"},"客户名称:",-1)),d("span",null,g(U.instanceData.customerName),1)]),d("div",We,[e[3]||(e[3]=d("span",{class:"label"},"地址类型:",-1)),d("span",null,g(h(U.instanceData.addressType)),1)]),d("div",je,[e[4]||(e[4]=d("span",{class:"label"},"IP数量配额:",-1)),d("span",null,g(U.instanceData.protectionIpCount),1)]),d("div",Le,[e[5]||(e[5]=d("span",{class:"label"},"已分配IP组数量:",-1)),d("span",null,g(v.value.length),1)])]),a(T,{"content-position":"left"},{default:l(()=>e[6]||(e[6]=[c("防护IP组列表")])),_:1,__:[6]}),v.value.length>0?(f(),R("div",Ye,[(f(!0),R(se,null,oe(v.value,(N,te)=>(f(),R("div",{key:N.groupId,class:"ip-group"},[a(q,{class:"ip-group-card"},{header:l(()=>[d("div",Ke,[d("span",Qe,g(N.displayName||`IP组 ${te+1}`),1),a(F,{type:N.addressType==="IPv4"?"success":"warning",class:"address-type-tag"},{default:l(()=>[c(g(N.addressType),1)]),_:2},1032,["type"]),d("span",He,"ID: "+g(N.groupId),1),d("span",Je,g(N.ips.length)+" 个IP",1)])]),default:l(()=>[a(L,{data:N.ips,style:{width:"100%"},border:""},{default:l(()=>[a(D,{label:"IP地址",prop:"ip"}),a(D,{label:"类型",prop:"type",width:"100"}),a(D,{label:"所属逻辑集群",prop:"logicClusterName"}),a(D,{label:"状态",width:"100"},{default:l(Q=>[a(F,{type:Q.row.status==="active"?"success":"info"},{default:l(()=>[c(g(Q.row.status==="active"?"已启用":"未启用"),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"])]),_:2},1024)]))),128))])):(f(),C(E,{key:1,description:"暂无已分配IP组"}))])):z("",!0)]),_:1},8,["modelValue","title"])}}},et=Ve(Ze,[["__scopeId","data-v-56273c40"]]),tt={class:"business-instance-container"},at={class:"card-header"},lt={class:"search-area"},st={class:"pagination-container"},ot={class:"text-xs text-gray-500 mt-2"},nt={class:"text-xs text-gray-500 mt-2"},rt={__name:"BusinessInstance",setup(U){const M=I(!1),k=I([]),B=I(!1),x=I(!1),w=I(!1),v=I(!1),P=I(!1),b=I(null),h=I([]),u=re({keyword:"",dateRange:[]}),e=re({pageNum:1,pageSize:10,total:0});Ge(()=>{T(),F()});const T=async()=>{try{M.value=!0;const n={keyword:u.keyword,status:u.status,pageNum:e.pageNum,pageSize:e.pageSize};u.dateRange&&u.dateRange.length===2&&(n.dateRange=u.dateRange);const s=await A.getBusinessInstances(n);s.code===200?(k.value=s.data.list.map(p=>(!p.clusterType&&p.isAnycast!==void 0&&(p.clusterType=p.isAnycast?"anycast":"standby"),p)),e.total=s.data.total,e.pageNum=s.data.pageNum,e.pageSize=s.data.pageSize):y.error(s.message||"获取业务实例列表失败")}catch(n){console.error("获取业务实例列表失败:",n),y.error("获取业务实例列表失败")}finally{M.value=!1}},F=async()=>{try{h.value=await we.getClusterGroups()}catch(n){console.error("获取逻辑集群组列表失败:",n)}},D=n=>{if(n.clusterGroupName)return n.clusterGroupName;const s=h.value.find(p=>p.id===n.clusterGroupId);return s?s.name:n.clusterGroupId},L=n=>{const s=h.value.find(O=>O.id===n.clusterGroupId);if(!s)return`集群组ID: ${n.clusterGroupId}`;let p="主备";return s.type==="anycast"?p="Anycast":(s.type==="distributed"||s.distributed)&&(p="分布式"),`${s.name} (${p}类型)
${s.remark||""}`},q=n=>{n.clusterGroupId&&y({message:`查看集群组: ${D(n)}`,type:"info"})},E=()=>{e.pageNum=1,T()},ee=()=>{u.keyword="",u.dateRange=[],e.pageNum=1,T()},Y=n=>{e.pageSize=n,T()},K=n=>{e.pageNum=n,T()},N=()=>{b.value=null,P.value=!1,B.value=!0},te=n=>{b.value={...n},P.value=!0,B.value=!0},Q=n=>{b.value={...n},w.value=!0},ue=async()=>{try{const n=await A.enableBusinessInstance(b.value.instanceId);n.code===200?(y.success("启用成功"),w.value=!1,T()):y.error(n.message||"启用失败")}catch(n){console.error("启用业务实例失败:",n),y.error("启用业务实例失败")}},de=n=>{b.value={...n},v.value=!0},ie=async()=>{try{const n=await A.disableBusinessInstance(b.value.instanceId);n.code===200?(y.success("禁用成功"),v.value=!1,T()):y.error(n.message||"禁用失败")}catch(n){console.error("禁用业务实例失败:",n),y.error("禁用业务实例失败")}},ce=n=>{b.value=n,x.value=!0},pe=n=>{Ae.confirm("确定要删除该业务实例吗？删除后无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const s=await A.deleteBusinessInstance(n.instanceId);s.code===200?(y.success("删除成功"),T()):y.error(s.message||"删除失败")}catch(s){console.error("删除业务实例失败:",s),y.error("删除业务实例失败")}}).catch(()=>{})},me=()=>{T()},fe=()=>{T(),b.value=null,x.value=!1},ye=(n,s)=>s.status===n,ge=(n,s)=>s.clusterType===n,ve=(n,s)=>s.addressType===n,_e=n=>({active:"success",inactive:"info"})[n]||"info",ae=n=>({active:"已启用",inactive:"已禁用"})[n]||n,Ie=n=>({standby:"primary",distributed:"success",anycast:"warning"})[n]||"info",o=n=>({standby:"主备",distributed:"分布式",anycast:"Anycast"})[n]||n,t=n=>({IPv4:"primary",IPv6:"success",dual:"warning"})[n]||"info",G=n=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[n]||n;return(n,s)=>{const p=m("el-button"),O=m("el-icon"),H=m("el-input"),V=m("el-form-item"),J=m("el-date-picker"),W=m("el-form"),_=m("el-table-column"),$=m("el-tag"),be=m("el-link"),X=m("el-tooltip"),Ce=m("el-table"),r=m("el-pagination"),Pe=m("el-card"),Te=m("el-dialog"),Ne=Se("loading");return f(),R("div",tt,[a(Pe,{class:"box-card"},{header:l(()=>[d("div",at,[s[11]||(s[11]=d("span",null,"业务实例管理",-1)),a(p,{type:"primary",onClick:N},{default:l(()=>s[10]||(s[10]=[c("新增业务实例")])),_:1,__:[10]})])]),default:l(()=>[d("div",lt,[a(W,{inline:!0,model:u,class:"search-form"},{default:l(()=>[a(V,null,{default:l(()=>[a(H,{modelValue:u.keyword,"onUpdate:modelValue":s[0]||(s[0]=i=>u.keyword=i),placeholder:"搜索业务实例名称/ID/客户名称/订单ID",clearable:"",onKeyup:xe(E,["enter"])},{prefix:l(()=>[a(O,null,{default:l(()=>[a(he(De))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(V,null,{default:l(()=>[a(J,{modelValue:u.dateRange,"onUpdate:modelValue":s[1]||(s[1]=i=>u.dateRange=i),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(V,null,{default:l(()=>[a(p,{type:"primary",onClick:E},{default:l(()=>s[12]||(s[12]=[c("搜索")])),_:1,__:[12]}),a(p,{onClick:ee},{default:l(()=>s[13]||(s[13]=[c("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),Z((f(),C(Ce,{data:k.value,border:"",stripe:"",style:{width:"100%","min-height":"320px"},"row-key":"instanceId","max-height":"500","row-class-name":"dense-row","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2}},{empty:l(()=>s[19]||(s[19]=[d("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:l(()=>[a(_,{prop:"instanceId",label:"业务实例ID",width:"150",fixed:"left"}),a(_,{prop:"instanceName",label:"业务实例名称","min-width":"150"}),a(_,{prop:"customerName",label:"客户名称","min-width":"180"}),a(_,{prop:"orderId",label:"订单ID",width:"150"}),a(_,{prop:"packageName",label:"套餐名称",width:"120"}),a(_,{label:"集群类型",width:"120",filters:[{text:"主备",value:"standby"},{text:"分布式",value:"distributed"},{text:"Anycast",value:"anycast"}],"filter-method":ge,"filter-placement":"bottom-end"},{default:l(({row:i})=>[a($,{type:Ie(i.clusterType)},{default:l(()=>[c(g(o(i.clusterType)),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"addressType",label:"地址类型",width:"100",filters:[{text:"IPv4",value:"IPv4"},{text:"IPv6",value:"IPv6"},{text:"双栈",value:"dual"}],"filter-method":ve,"filter-placement":"bottom-end"},{default:l(({row:i})=>[a($,{type:t(i.addressType)},{default:l(()=>[c(g(G(i.addressType)),1)]),_:2},1032,["type"])]),_:1}),a(_,{label:"逻辑集群组","min-width":"180"},{default:l(({row:i})=>[a(X,{effect:"light",content:L(i),placement:"top","show-after":500},{default:l(()=>[a(be,{type:"primary",onClick:S=>q(i)},{default:l(()=>[c(g(D(i)),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1}),a(_,{prop:"bandwidth",label:"防护带宽(Mbps)",width:"140",sortable:""}),a(_,{prop:"businessBandwidth",label:"业务带宽(Mbps)",width:"140",sortable:""}),a(_,{prop:"qps",label:"业务QPS",width:"120",sortable:""}),a(_,{prop:"protectionIpCount",label:"防护IP数",width:"120",sortable:""}),a(_,{prop:"domainCount",label:"防护域名数",width:"120",sortable:""}),a(_,{prop:"portCount",label:"端口数量",width:"120",sortable:""}),a(_,{prop:"status",label:"状态",width:"100",filters:[{text:"已启用",value:"active"},{text:"已禁用",value:"inactive"}],"filter-method":ye,"filter-placement":"bottom-end"},{default:l(({row:i})=>[a($,{type:_e(i.status)},{default:l(()=>[c(g(ae(i.status)),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"createTime",label:"创建时间",width:"180",sortable:""}),a(_,{label:"操作",width:"320",fixed:"right"},{default:l(({row:i})=>[i.status==="inactive"?(f(),C(p,{key:0,type:"success",link:"",onClick:S=>Q(i)},{default:l(()=>s[14]||(s[14]=[c(" 启用 ")])),_:2,__:[14]},1032,["onClick"])):z("",!0),i.status==="active"?(f(),C(p,{key:1,type:"warning",link:"",onClick:S=>de(i)},{default:l(()=>s[15]||(s[15]=[c(" 禁用 ")])),_:2,__:[15]},1032,["onClick"])):z("",!0),a(p,{type:"primary",link:"",onClick:S=>te(i)},{default:l(()=>s[16]||(s[16]=[c(" 修改配置 ")])),_:2,__:[16]},1032,["onClick"]),a(p,{type:"primary",link:"",onClick:S=>ce(i)},{default:l(()=>s[17]||(s[17]=[c(" 分配防护IP ")])),_:2,__:[17]},1032,["onClick"]),a(p,{type:"danger",link:"",onClick:S=>pe(i)},{default:l(()=>s[18]||(s[18]=[c(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ne,M.value]]),d("div",st,[a(r,{"current-page":e.pageNum,"onUpdate:currentPage":s[2]||(s[2]=i=>e.pageNum=i),"page-size":e.pageSize,"onUpdate:pageSize":s[3]||(s[3]=i=>e.pageSize=i),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.total,background:"",onSizeChange:Y,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),_:1}),a(Fe,{modelValue:B.value,"onUpdate:modelValue":s[4]||(s[4]=i=>B.value=i),"instance-data":b.value,"is-edit":P.value,onSuccess:me},null,8,["modelValue","instance-data","is-edit"]),a(et,{modelValue:x.value,"onUpdate:modelValue":s[5]||(s[5]=i=>x.value=i),"instance-data":b.value,onSuccess:fe},null,8,["modelValue","instance-data"]),a(Te,{modelValue:w.value,"onUpdate:modelValue":s[7]||(s[7]=i=>w.value=i),title:"确认启用",width:"400px"},{footer:l(()=>[a(p,{onClick:s[6]||(s[6]=i=>w.value=!1)},{default:l(()=>s[22]||(s[22]=[c("取消")])),_:1,__:[22]}),a(p,{type:"success",onClick:ue},{default:l(()=>s[23]||(s[23]=[c("确认启用")])),_:1,__:[23]})]),default:l(()=>{var i,S;return[d("div",null,[s[20]||(s[20]=c("确定要启用业务实例 ")),d("b",null,g((i=b.value)==null?void 0:i.instanceName),1),s[21]||(s[21]=c(" 吗？"))]),d("div",ot,"ID: "+g((S=b.value)==null?void 0:S.instanceId),1)]}),_:1},8,["modelValue"]),a(Te,{modelValue:v.value,"onUpdate:modelValue":s[9]||(s[9]=i=>v.value=i),title:"确认禁用",width:"400px"},{footer:l(()=>[a(p,{onClick:s[8]||(s[8]=i=>v.value=!1)},{default:l(()=>s[26]||(s[26]=[c("取消")])),_:1,__:[26]}),a(p,{type:"warning",onClick:ie},{default:l(()=>s[27]||(s[27]=[c("确认禁用")])),_:1,__:[27]})]),default:l(()=>{var i,S;return[d("div",null,[s[24]||(s[24]=c("确定要禁用业务实例 ")),d("b",null,g((i=b.value)==null?void 0:i.instanceName),1),s[25]||(s[25]=c(" 吗？"))]),d("div",nt,"ID: "+g((S=b.value)==null?void 0:S.instanceId),1)]}),_:1},8,["modelValue"])])}}},dt=Ve(rt,[["__scopeId","data-v-564e6ba4"]]);export{dt as default};
