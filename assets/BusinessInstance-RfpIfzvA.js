import{_ as Ie,c as ve,a as V,r as ge,n as me,e as c,l as N,g as f,w as a,d as e,h as m,i as J,b as B,F as pe,p as ce,t as h,z as de,v as z,k as i,B as W,E as g,A as ye,C as _e,f as Pe,o as Ne,j as De,u as he,G as xe,q as Te}from"./index-DEACEgZz.js";const Se={style:{color:"#999"}},Ge={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ue={key:0,class:"form-tip"},$e={key:1,class:"form-tip"},Be={style:{"margin-top":"20px",display:"flex","justify-content":"space-between"}},ze={__name:"BusinessInstanceModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(O,{emit:Q}){const _=O,R=Q,S=ve({get:()=>_.modelValue,set:r=>R("update:modelValue",r)}),x=V(null),y=V(0),t=ge({instanceName:"",customerId:"",customerName:"",orderId:"",packageId:"",packageName:"",packageType:1,isAnycast:!1,addressType:"IPv4",regionId:"",adsProtection:!0,ccProtection:!1,wafProtection:!1,bandwidth:100,businessBandwidth:50,qps:1e3,protectionIpCount:1,domainCount:10,portCount:10,status:"active",remark:"",clusterGroupId:"",clusterGroupName:"",clusterGroupType:"",clusterGroupTypeLabel:""}),C={instanceName:[{required:!0,message:"请输入业务实例名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"change"}],orderId:[{required:!0,message:"请选择关联订单",trigger:"change"}],addressType:[{required:!0,message:"请选择地址类型",trigger:"change"}],regionId:[{required:!0,message:"请选择地域",trigger:"change"}],clusterGroupId:[{required:!0,message:"请选择逻辑集群组",trigger:"change"}],status:[{required:!0,message:"请选择实例状态",trigger:"change"}]},q=V([]),v=V([]),w=V([]),k=V([]),G=V({clusterGroups:!1}),T=()=>{t.instanceName="",t.customerId="",t.customerName="",t.orderId="",t.packageId="",t.packageName="",t.packageType=1,t.isAnycast=!1,t.addressType="IPv4",t.regionId="",t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1,t.bandwidth=100,t.businessBandwidth=50,t.qps=1e3,t.protectionIpCount=1,t.domainCount=10,t.portCount=10,t.status="active",t.remark="",t.clusterGroupId=""};me(()=>_.instanceData,r=>{r?(Object.keys(t).forEach(l=>{r[l]!==void 0&&(t[l]=r[l])}),r.packageName&&(r.packageName==="DDOS防护"?(t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1,t.packageType=1):r.packageName==="WAF标准防护"?(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!1,t.packageType=2):r.packageName==="WAF增强防护"&&(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!0,t.packageType=3)),r.clusterGroupId&&s(r.clusterGroupId),H()):T()},{immediate:!0,deep:!0}),me(()=>S.value,r=>{r&&(y.value=0,ye(()=>{K(),X(),d()}))});const K=async()=>{try{q.value=[{customerId:"CUST1001",customerName:"北京科技有限公司"},{customerId:"CUST1002",customerName:"上海网络科技有限公司"},{customerId:"CUST1003",customerName:"广州信息技术有限公司"},{customerId:"CUST1004",customerName:"深圳互联网有限公司"},{customerId:"CUST1005",customerName:"杭州数字科技有限公司"}]}catch(r){console.error("获取客户列表失败:",r)}},H=async()=>{try{const r=new URLSearchParams;t.customerId&&r.append("customerId",t.customerId);const l=await W.getAvailableOrders({customerId:t.customerId});l.code===200&&(v.value=l.data)}catch(r){console.error("获取订单列表失败:",r)}},X=async()=>{try{w.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(r){console.error("获取地域列表失败:",r)}},ee=r=>{t.orderId="";const l=q.value.find($=>$.customerId===r);l&&(t.customerName=l.customerName),H()},te=r=>{const l=v.value.find($=>$.orderId===r);l&&(t.packageName=l.packageName,l.packageName==="DDOS防护"?(t.packageType=1,t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1):l.packageName==="WAF标准防护"?(t.packageType=2,t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!1):l.packageName==="WAF增强防护"&&(t.packageType=3,t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!0))},ae=()=>{y.value>0&&y.value--},le=async()=>{if(y.value===0)try{await x.value.validateField(["instanceName","customerId","orderId"]),y.value++}catch(r){console.error(r)}else if(y.value===1)try{await x.value.validateField(["addressType"]),t.isAnycast||await x.value.validateField(["regionId"]),await x.value.validateField(["clusterGroupId"]),y.value++}catch(r){console.error(r)}else y.value<4&&y.value++},ne=()=>{S.value=!1,T()},oe=async()=>{try{await x.value.validate();const r={...t};t.wafProtection&&t.ccProtection&&t.adsProtection?r.packageName="WAF增强防护":t.ccProtection&&t.adsProtection?r.packageName="WAF标准防护":r.packageName="DDOS防护",r.isAnycast&&(r.regionId="");let l;_.isEdit?l=await W.updateBusinessInstance(_.instanceData.instanceId,r):l=await W.createBusinessInstance(r),l.code===200?(g.success(_.isEdit?"修改成功":"创建成功"),S.value=!1,R("success")):g.error(l.message||(_.isEdit?"修改失败":"创建失败"))}catch(r){console.error("表单验证失败:",r)}},se=r=>{r===1?(t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1):r===2?(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!1):r===3&&(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!0)},re=()=>{!t.isAnycast&&t.regionId};me(()=>t.isAnycast,r=>{});const d=async()=>{try{G.value.clusterGroups=!0;const r=await _e.getClusterGroups();k.value=r}catch(r){console.error("获取逻辑集群组列表失败:",r),g.error("获取逻辑集群组列表失败")}finally{G.value.clusterGroups=!1}},s=async r=>{try{const l=await _e.getClusterGroupById(r);l&&(t.clusterGroupId=l.id)}catch(l){console.error("获取逻辑集群组详情失败:",l)}},U=ve(()=>k.value.length?k.value.filter(r=>r.status==="active"):[]),D=r=>r.type==="anycast"?"warning":r.type==="distributed"||r.distributed?"success":"info",F=r=>r.type==="anycast"?"Anycast":r.type==="distributed"||r.distributed?"分布式":"主备";return(r,l)=>{const $=c("el-step"),ue=c("el-steps"),Z=c("el-input"),P=c("el-form-item"),E=c("el-option"),o=c("el-select"),n=c("el-switch"),I=c("el-radio"),j=c("el-radio-group"),L=c("el-tag"),Y=c("el-alert"),b=c("el-input-number"),fe=c("el-form"),A=c("el-button"),ie=c("el-dialog");return f(),N(ie,{modelValue:S.value,"onUpdate:modelValue":l[16]||(l[16]=u=>S.value=u),title:O.isEdit?"修改业务实例":"新增业务实例",width:"60%","destroy-on-close":""},{default:a(()=>[e(ue,{active:y.value,"finish-status":"success",simple:"",style:{"margin-bottom":"20px"}},{default:a(()=>[e($,{title:"基本信息"}),e($,{title:"部署配置"}),e($,{title:"防护选项"}),e($,{title:"资源配置"}),e($,{title:"状态与备注"})]),_:1},8,["active"]),e(fe,{ref_key:"formRef",ref:x,model:t,rules:C,"label-width":"120px",style:{"max-height":"500px","overflow-y":"auto"}},{default:a(()=>[J(m("div",null,[e(P,{label:"业务实例名称",prop:"instanceName"},{default:a(()=>[e(Z,{modelValue:t.instanceName,"onUpdate:modelValue":l[0]||(l[0]=u=>t.instanceName=u),placeholder:"请输入业务实例名称"},null,8,["modelValue"])]),_:1}),e(P,{label:"客户",prop:"customerId"},{default:a(()=>[e(o,{modelValue:t.customerId,"onUpdate:modelValue":l[1]||(l[1]=u=>t.customerId=u),placeholder:"请选择客户",filterable:"",style:{width:"100%"},onChange:ee},{default:a(()=>[(f(!0),B(pe,null,ce(q.value,u=>(f(),N(E,{key:u.customerId,label:u.customerName,value:u.customerId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(P,{label:"关联订单",prop:"orderId"},{default:a(()=>[e(o,{modelValue:t.orderId,"onUpdate:modelValue":l[2]||(l[2]=u=>t.orderId=u),placeholder:"请选择关联订单",filterable:"",style:{width:"100%"},disabled:!t.customerId,onChange:te},{default:a(()=>[(f(!0),B(pe,null,ce(v.value,u=>(f(),N(E,{key:u.orderId,label:u.orderId,value:u.orderId},{default:a(()=>[m("div",null,[m("div",null,h(u.orderId),1),m("small",Se,h(u.packageName),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})],512),[[de,y.value===0]]),J(m("div",null,[e(P,{label:"Anycast",prop:"isAnycast"},{default:a(()=>[e(n,{modelValue:t.isAnycast,"onUpdate:modelValue":l[3]||(l[3]=u=>t.isAnycast=u)},null,8,["modelValue"])]),_:1}),e(P,{label:"地址类型",prop:"addressType"},{default:a(()=>[e(j,{modelValue:t.addressType,"onUpdate:modelValue":l[4]||(l[4]=u=>t.addressType=u)},{default:a(()=>[e(I,{label:"IPv4"},{default:a(()=>l[17]||(l[17]=[i("IPv4")])),_:1,__:[17]}),e(I,{label:"IPv6"},{default:a(()=>l[18]||(l[18]=[i("IPv6")])),_:1,__:[18]}),e(I,{label:"dual"},{default:a(()=>l[19]||(l[19]=[i("双栈")])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),t.isAnycast?z("",!0):(f(),N(P,{key:0,label:"地域",prop:"regionId"},{default:a(()=>[e(o,{modelValue:t.regionId,"onUpdate:modelValue":l[5]||(l[5]=u=>t.regionId=u),placeholder:"请选择地域",style:{width:"100%"},onChange:re},{default:a(()=>[(f(!0),B(pe,null,ce(w.value,u=>(f(),N(E,{key:u.regionId,label:u.regionName,value:u.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),e(P,{label:"逻辑集群组",prop:"clusterGroupId"},{default:a(()=>[e(o,{modelValue:t.clusterGroupId,"onUpdate:modelValue":l[6]||(l[6]=u=>t.clusterGroupId=u),placeholder:"请选择逻辑集群组",filterable:"",style:{width:"100%"},loading:G.value.clusterGroups},{default:a(()=>[(f(!0),B(pe,null,ce(U.value,u=>(f(),N(E,{key:u.id,label:u.name,value:u.id},{default:a(()=>[m("div",Ge,[m("span",null,h(u.name),1),e(L,{size:"small",type:D(u)},{default:a(()=>[i(h(F(u)),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),t.isAnycast?(f(),B("div",Ue,"Anycast实例建议选择Anycast或分布式类型的逻辑集群组")):(f(),B("div",$e,"非Anycast实例建议选择与实例所在地域匹配的逻辑集群组"))]),_:1})],512),[[de,y.value===1]]),J(m("div",null,[e(Y,{title:"防护配置与套餐对应关系",type:"info",description:"ADS防护 -> DDOS防护；ADS防护+CC防护 -> WAF标准防护；ADS防护+CC防护+WAF防护 -> WAF增强防护",closable:!1,style:{"margin-bottom":"20px"}}),e(P,{label:"套餐选择",prop:"packageType"},{default:a(()=>[e(j,{modelValue:t.packageType,"onUpdate:modelValue":l[7]||(l[7]=u=>t.packageType=u),onChange:se},{default:a(()=>[e(I,{label:1},{default:a(()=>l[20]||(l[20]=[i("DDOS防护（仅ADS防护）")])),_:1,__:[20]}),e(I,{label:2},{default:a(()=>l[21]||(l[21]=[i("WAF标准防护（ADS+CC防护）")])),_:1,__:[21]}),e(I,{label:3},{default:a(()=>l[22]||(l[22]=[i("WAF增强防护（ADS+CC+WAF防护）")])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),e(P,{label:"防护内容"},{default:a(()=>[t.adsProtection?(f(),N(L,{key:0,type:"success",style:{"margin-right":"5px"}},{default:a(()=>l[23]||(l[23]=[i("ADS防护")])),_:1,__:[23]})):z("",!0),t.ccProtection?(f(),N(L,{key:1,type:"warning",style:{"margin-right":"5px"}},{default:a(()=>l[24]||(l[24]=[i("CC防护")])),_:1,__:[24]})):z("",!0),t.wafProtection?(f(),N(L,{key:2,type:"danger"},{default:a(()=>l[25]||(l[25]=[i("WAF防护")])),_:1,__:[25]})):z("",!0)]),_:1})],512),[[de,y.value===2]]),J(m("div",null,[e(P,{label:"防护带宽(Mbps)",prop:"bandwidth"},{default:a(()=>[e(b,{modelValue:t.bandwidth,"onUpdate:modelValue":l[8]||(l[8]=u=>t.bandwidth=u),min:1,max:1e4},null,8,["modelValue"])]),_:1}),e(P,{label:"业务带宽(Mbps)",prop:"businessBandwidth"},{default:a(()=>[e(b,{modelValue:t.businessBandwidth,"onUpdate:modelValue":l[9]||(l[9]=u=>t.businessBandwidth=u),min:1,max:5e3},null,8,["modelValue"])]),_:1}),e(P,{label:"业务QPS",prop:"qps"},{default:a(()=>[e(b,{modelValue:t.qps,"onUpdate:modelValue":l[10]||(l[10]=u=>t.qps=u),min:1,max:1e5},null,8,["modelValue"])]),_:1}),e(P,{label:"防护IP数",prop:"protectionIpCount"},{default:a(()=>[e(b,{modelValue:t.protectionIpCount,"onUpdate:modelValue":l[11]||(l[11]=u=>t.protectionIpCount=u),min:1,max:100},null,8,["modelValue"])]),_:1}),e(P,{label:"防护域名数",prop:"domainCount"},{default:a(()=>[e(b,{modelValue:t.domainCount,"onUpdate:modelValue":l[12]||(l[12]=u=>t.domainCount=u),min:1,max:1e3},null,8,["modelValue"])]),_:1}),e(P,{label:"端口数量",prop:"portCount"},{default:a(()=>[e(b,{modelValue:t.portCount,"onUpdate:modelValue":l[13]||(l[13]=u=>t.portCount=u),min:1,max:100},null,8,["modelValue"])]),_:1})],512),[[de,y.value===3]]),J(m("div",null,[e(P,{label:"实例状态",prop:"status"},{default:a(()=>[e(j,{modelValue:t.status,"onUpdate:modelValue":l[14]||(l[14]=u=>t.status=u)},{default:a(()=>[e(I,{label:"active"},{default:a(()=>l[26]||(l[26]=[i("启用")])),_:1,__:[26]}),e(I,{label:"inactive"},{default:a(()=>l[27]||(l[27]=[i("禁用")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1}),e(P,{label:"备注",prop:"remark"},{default:a(()=>[e(Z,{modelValue:t.remark,"onUpdate:modelValue":l[15]||(l[15]=u=>t.remark=u),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})],512),[[de,y.value===4]])]),_:1},8,["model"]),m("div",Be,[m("div",null,[y.value>0?(f(),N(A,{key:0,onClick:ae},{default:a(()=>l[28]||(l[28]=[i("上一步")])),_:1,__:[28]})):z("",!0)]),m("div",null,[e(A,{onClick:ne},{default:a(()=>l[29]||(l[29]=[i("取消")])),_:1,__:[29]}),y.value<4?(f(),N(A,{key:0,type:"primary",onClick:le},{default:a(()=>l[30]||(l[30]=[i("下一步")])),_:1,__:[30]})):(f(),N(A,{key:1,type:"primary",onClick:oe},{default:a(()=>l[31]||(l[31]=[i("提交")])),_:1,__:[31]}))])])]),_:1},8,["modelValue","title"])}}},Fe=Ie(ze,[["__scopeId","data-v-41742427"]]),Oe={key:0},Me={class:"info-section"},Re={class:"info-item"},qe={class:"info-item"},Ee={class:"info-item"},We={class:"info-item"},je={class:"info-item"},Le={key:0},Ye={class:"allocation-options"},Qe={key:2,class:"allocation-form"},Je={key:3,class:"allocation-form"},Ke={key:0,class:"table-footer"},He={key:0,class:"error-tip"},Xe={key:4,class:"allocation-form"},Ze={class:"dialog-footer"},et={__name:"IpAllocationModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null}},emits:["update:modelValue","success"],setup(O,{emit:Q}){const _=O,R=Q,S=ve({get:()=>_.modelValue,set:d=>R("update:modelValue",d)}),x=V(!1),y=V("auto"),t=V([]),C=V([]),q=V([]),v=V([]),w=V({count:1}),k=V({ipType:"IPv4",regionId:""}),G=V({ip:""}),T=ve(()=>{if(!_.instanceData)return 0;const d=_.instanceData.protectionIpCount||0,s=v.value.length;return Math.max(0,d-s)}),K=()=>{_.instanceData&&_.instanceData.protectionIps?v.value=Array.isArray(_.instanceData.protectionIps)?_.instanceData.protectionIps.map(d=>typeof d=="object"&&d!==null?d:{ip:d}):[]:v.value=[],y.value="auto",t.value=[],C.value=[],w.value={count:1},k.value={ipType:"IPv4",regionId:""},G.value={ip:""}};me(()=>_.instanceData,d=>{d&&ye(()=>{K()})},{immediate:!0}),me(()=>S.value,d=>{d&&ye(()=>{K(),X()})});const H=()=>{S.value=!1,v.value=[]},X=async()=>{try{q.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(d){console.error("获取地域列表失败:",d)}},ee=async()=>{if(!k.value.ipType){g.warning("请选择IP类型");return}if(!_.instanceData.isAnycast&&!k.value.regionId){g.warning("请选择地域");return}x.value=!0;try{const d=await W.getAvailableProtectionIps();d.code===200?(C.value=d.data.filter(s=>!(s.type!==k.value.ipType||_.instanceData.isAnycast!==s.isAnycast||!_.instanceData.isAnycast&&k.value.regionId&&s.region!==k.value.regionId||v.value.some(U=>U.ip===s.ip))),t.value=[]):g.error(d.message||"获取可用IP失败")}catch(d){console.error("获取可用IP列表失败:",d),g.error("获取可用IP列表失败")}finally{x.value=!1}},te=d=>{t.value=d},ae=()=>{if(t.value.length===0){g.warning("请选择要添加的IP");return}if(t.value.length>T.value){g.warning(`最多还可添加${T.value}个IP`);return}const d=t.value.map(s=>({ip:s.ip}));v.value=[...v.value,...d],t.value=[],C.value=[]},le=async()=>{if(w.value.count<=0){g.warning("请输入有效的分配数量");return}if(w.value.count>T.value){g.warning(`最多还可分配${T.value}个IP`);return}x.value=!0;try{const d=await W.getAvailableProtectionIps();if(d.code===200){const U=d.data.filter(D=>!(_.instanceData.addressType==="IPv4"&&D.type!=="IPv4"||_.instanceData.addressType==="IPv6"&&D.type!=="IPv6"||_.instanceData.isAnycast!==D.isAnycast||!_.instanceData.isAnycast&&_.instanceData.regionId&&D.region!==_.instanceData.regionId||v.value.some(F=>F.ip===D.ip))).sort(()=>.5-Math.random()).slice(0,w.value.count).map(D=>({ip:D.ip}));U.length>0?(v.value=[...v.value,...U],g.success(`已自动分配${U.length}个IP`)):g.warning("没有可用的IP可分配")}else g.error(d.message||"自动分配IP失败")}catch(d){console.error("自动分配IP失败:",d),g.error("自动分配IP失败")}finally{x.value=!1}},ne=()=>{if(!G.value.ip){g.warning("请输入IP地址");return}if(T.value<=0){g.warning("IP配额已用完");return}if(v.value.some(s=>s.ip===G.value.ip)){g.warning("该IP已添加");return}v.value.push({ip:G.value.ip}),G.value.ip=""},oe=d=>{v.value.splice(d,1)},se=async()=>{if(_.instanceData)try{const d=v.value.map(U=>U.ip),s=await W.allocateProtectionIps(_.instanceData.instanceId,d);s.code===200?(g.success("分配成功"),S.value=!1,R("success")):g.error(s.message||"分配失败")}catch(d){console.error("分配防护IP失败:",d),g.error("分配防护IP失败")}},re=d=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[d]||d;return(d,s)=>{var Y;const U=c("el-divider"),D=c("el-table-column"),F=c("el-button"),r=c("el-table"),l=c("el-empty"),$=c("el-radio"),ue=c("el-radio-group"),Z=c("el-input-number"),P=c("el-form-item"),E=c("el-form"),o=c("el-option"),n=c("el-select"),I=c("el-input"),j=c("el-dialog"),L=Pe("loading");return f(),N(j,{modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=b=>S.value=b),title:`分配防护IP - ${((Y=O.instanceData)==null?void 0:Y.instanceName)||""}`,width:"60%","destroy-on-close":""},{footer:a(()=>[m("div",Ze,[e(F,{onClick:H},{default:a(()=>s[21]||(s[21]=[i("取消")])),_:1,__:[21]}),e(F,{type:"primary",onClick:se},{default:a(()=>s[22]||(s[22]=[i("确认")])),_:1,__:[22]})])]),default:a(()=>[O.instanceData?(f(),B("div",Oe,[m("div",Me,[m("div",Re,[s[6]||(s[6]=m("span",{class:"label"},"业务实例ID:",-1)),m("span",null,h(O.instanceData.instanceId),1)]),m("div",qe,[s[7]||(s[7]=m("span",{class:"label"},"客户名称:",-1)),m("span",null,h(O.instanceData.customerName),1)]),m("div",Ee,[s[8]||(s[8]=m("span",{class:"label"},"地址类型:",-1)),m("span",null,h(re(O.instanceData.addressType)),1)]),m("div",We,[s[9]||(s[9]=m("span",{class:"label"},"IP数量配额:",-1)),m("span",null,h(O.instanceData.protectionIpCount),1)]),m("div",je,[s[10]||(s[10]=m("span",{class:"label"},"已分配数量:",-1)),m("span",null,h(v.value.length),1)])]),e(U,{"content-position":"left"},{default:a(()=>s[11]||(s[11]=[i("当前已分配IP")])),_:1,__:[11]}),v.value.length>0?(f(),B("div",Le,[e(r,{data:v.value,style:{width:"100%"},border:""},{default:a(()=>[e(D,{label:"IP地址",prop:"ip"}),e(D,{label:"操作",width:"100"},{default:a(b=>[e(F,{type:"danger",size:"small",onClick:fe=>oe(b.$index)},{default:a(()=>s[12]||(s[12]=[i(" 移除 ")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),N(l,{key:1,description:"暂无已分配IP"})),e(U,{"content-position":"left"},{default:a(()=>s[13]||(s[13]=[i("分配新IP")])),_:1,__:[13]}),m("div",Ye,[e(ue,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=b=>y.value=b)},{default:a(()=>[e($,{label:"auto"},{default:a(()=>s[14]||(s[14]=[i("自动分配")])),_:1,__:[14]}),e($,{label:"pool"},{default:a(()=>s[15]||(s[15]=[i("从IP池选择")])),_:1,__:[15]}),e($,{label:"manual"},{default:a(()=>s[16]||(s[16]=[i("手动输入")])),_:1,__:[16]})]),_:1},8,["modelValue"])]),y.value==="auto"?(f(),B("div",Qe,[e(E,{model:w.value,"label-width":"120px"},{default:a(()=>[e(P,{label:"分配数量"},{default:a(()=>[e(Z,{modelValue:w.value.count,"onUpdate:modelValue":s[1]||(s[1]=b=>w.value.count=b),min:1,max:T.value,disabled:T.value<=0},null,8,["modelValue","max","disabled"])]),_:1}),e(P,null,{default:a(()=>[e(F,{type:"primary",onClick:le,disabled:T.value<=0},{default:a(()=>s[17]||(s[17]=[i(" 自动分配 ")])),_:1,__:[17]},8,["disabled"])]),_:1})]),_:1},8,["model"])])):z("",!0),y.value==="pool"?(f(),B("div",Je,[e(E,{model:k.value,"label-width":"120px"},{default:a(()=>[e(P,{label:"IP类型"},{default:a(()=>[e(n,{modelValue:k.value.ipType,"onUpdate:modelValue":s[2]||(s[2]=b=>k.value.ipType=b),placeholder:"请选择IP类型"},{default:a(()=>[e(o,{label:"IPv4",value:"IPv4"}),e(o,{label:"IPv6",value:"IPv6"})]),_:1},8,["modelValue"])]),_:1}),O.instanceData.isAnycast?z("",!0):(f(),N(P,{key:0,label:"地域"},{default:a(()=>[e(n,{modelValue:k.value.regionId,"onUpdate:modelValue":s[3]||(s[3]=b=>k.value.regionId=b),placeholder:"请选择地域"},{default:a(()=>[(f(!0),B(pe,null,ce(q.value,b=>(f(),N(o,{key:b.regionId,label:b.regionName,value:b.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),e(P,null,{default:a(()=>[e(F,{type:"primary",onClick:ee},{default:a(()=>s[18]||(s[18]=[i(" 查询可用IP ")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"]),e(U,{"content-position":"left"},{default:a(()=>s[19]||(s[19]=[i("可用IP列表")])),_:1,__:[19]}),J((f(),N(r,{data:C.value,style:{width:"100%"},border:"",onSelectionChange:te},{default:a(()=>[e(D,{type:"selection",width:"55"}),e(D,{label:"IP地址",prop:"ip"}),e(D,{label:"类型",prop:"type",width:"100"}),e(D,{label:"Anycast",width:"100"},{default:a(b=>[i(h(b.row.isAnycast?"是":"否"),1)]),_:1}),e(D,{label:"地域",prop:"region",width:"150"})]),_:1},8,["data"])),[[L,x.value]]),C.value.length>0?(f(),B("div",Ke,[e(F,{type:"primary",onClick:ae,disabled:t.value.length===0||t.value.length>T.value},{default:a(()=>[i(" 添加选中IP ("+h(t.value.length)+") ",1)]),_:1},8,["disabled"]),t.value.length>T.value?(f(),B("div",He," 选择的IP数量超过剩余配额 ")):z("",!0)])):z("",!0)])):z("",!0),y.value==="manual"?(f(),B("div",Xe,[e(E,{model:G.value,"label-width":"120px"},{default:a(()=>[e(P,{label:"IP地址"},{default:a(()=>[e(I,{modelValue:G.value.ip,"onUpdate:modelValue":s[4]||(s[4]=b=>G.value.ip=b),placeholder:"请输入IP地址",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),e(P,null,{default:a(()=>[e(F,{type:"primary",onClick:ne,disabled:!G.value.ip||T.value<=0},{default:a(()=>s[20]||(s[20]=[i(" 添加 ")])),_:1,__:[20]},8,["disabled"])]),_:1})]),_:1},8,["model"])])):z("",!0)])):z("",!0)]),_:1},8,["modelValue","title"])}}},tt=Ie(et,[["__scopeId","data-v-3428a2d0"]]),at={class:"business-instance-container"},lt={class:"card-header"},nt={class:"search-area"},ot={class:"pagination-container"},st={class:"text-xs text-gray-500 mt-2"},rt={class:"text-xs text-gray-500 mt-2"},ut={__name:"BusinessInstance",setup(O){const Q=V(!1),_=V([]),R=V(!1),S=V(!1),x=V(!1),y=V(!1),t=V(!1),C=V(null),q=V([]),v=ge({keyword:"",dateRange:[]}),w=ge({pageNum:1,pageSize:10,total:0});Ne(()=>{k(),G()});const k=async()=>{Q.value=!0;try{const o={keyword:v.keyword,pageNum:w.pageNum,pageSize:w.pageSize};v.dateRange&&v.dateRange.length===2&&(o.dateRange=v.dateRange);const n=await W.getBusinessInstances(o);n.code===200?(_.value=n.data.list,w.total=n.data.total,w.pageNum=n.data.pageNum,w.pageSize=n.data.pageSize):g.error(n.message||"获取业务实例列表失败")}catch(o){console.error("获取业务实例列表失败:",o),g.error("获取业务实例列表失败")}finally{Q.value=!1}},G=async()=>{try{q.value=await _e.getClusterGroups()}catch(o){console.error("获取逻辑集群组列表失败:",o)}},T=o=>{if(o.clusterGroupName)return o.clusterGroupName;const n=q.value.find(I=>I.id===o.clusterGroupId);return n?n.name:o.clusterGroupId},K=o=>{const n=q.value.find(j=>j.id===o.clusterGroupId);if(!n)return`集群组ID: ${o.clusterGroupId}`;let I="主备";return n.type==="anycast"?I="Anycast":(n.type==="distributed"||n.distributed)&&(I="分布式"),`${n.name} (${I}类型)
${n.remark||""}`},H=o=>{o.clusterGroupId&&g({message:`查看集群组: ${T(o)}`,type:"info"})},X=()=>{w.pageNum=1,k()},ee=()=>{v.keyword="",v.dateRange=[],w.pageNum=1,k()},te=o=>{w.pageSize=o,k()},ae=o=>{w.pageNum=o,k()},le=()=>{C.value=null,t.value=!1,R.value=!0},ne=o=>{C.value={...o},t.value=!0,R.value=!0},oe=o=>{C.value={...o},x.value=!0},se=async()=>{try{const o=await W.enableBusinessInstance(C.value.instanceId);o.code===200?(g.success("启用成功"),x.value=!1,k()):g.error(o.message||"启用失败")}catch(o){console.error("启用业务实例失败:",o),g.error("启用业务实例失败")}},re=o=>{C.value={...o},y.value=!0},d=async()=>{try{const o=await W.disableBusinessInstance(C.value.instanceId);o.code===200?(g.success("禁用成功"),y.value=!1,k()):g.error(o.message||"禁用失败")}catch(o){console.error("禁用业务实例失败:",o),g.error("禁用业务实例失败")}},s=o=>{C.value=JSON.parse(JSON.stringify(o)),S.value=!0},U=o=>{Te.confirm("确定要删除该业务实例吗？删除后无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const n=await W.deleteBusinessInstance(o.instanceId);n.code===200?(g.success("删除成功"),k()):g.error(n.message||"删除失败")}catch(n){console.error("删除业务实例失败:",n),g.error("删除业务实例失败")}}).catch(()=>{})},D=()=>{k()},F=()=>{k(),C.value=null,S.value=!1},r=(o,n)=>n.status===o,l=(o,n)=>n.isAnycast===o,$=(o,n)=>n.addressType===o,ue=o=>({active:"success",inactive:"info"})[o]||"info",Z=o=>({active:"已启用",inactive:"已禁用"})[o]||o,P=o=>({IPv4:"primary",IPv6:"success",dual:"warning"})[o]||"info",E=o=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[o]||o;return(o,n)=>{const I=c("el-button"),j=c("el-icon"),L=c("el-input"),Y=c("el-form-item"),b=c("el-date-picker"),fe=c("el-form"),A=c("el-table-column"),ie=c("el-tag"),u=c("el-link"),ke=c("el-tooltip"),we=c("el-table"),Ve=c("el-pagination"),Ce=c("el-card"),be=c("el-dialog"),Ae=Pe("loading");return f(),B("div",at,[e(Ce,{class:"box-card"},{header:a(()=>[m("div",lt,[n[11]||(n[11]=m("span",null,"业务实例管理",-1)),e(I,{type:"primary",onClick:le},{default:a(()=>n[10]||(n[10]=[i("新增业务实例")])),_:1,__:[10]})])]),default:a(()=>[m("div",nt,[e(fe,{inline:!0,model:v,class:"search-form"},{default:a(()=>[e(Y,null,{default:a(()=>[e(L,{modelValue:v.keyword,"onUpdate:modelValue":n[0]||(n[0]=p=>v.keyword=p),placeholder:"搜索业务实例名称/ID/客户名称/订单ID",clearable:"",onKeyup:De(X,["enter"])},{prefix:a(()=>[e(j,null,{default:a(()=>[e(he(xe))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Y,null,{default:a(()=>[e(b,{modelValue:v.dateRange,"onUpdate:modelValue":n[1]||(n[1]=p=>v.dateRange=p),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(Y,null,{default:a(()=>[e(I,{type:"primary",onClick:X},{default:a(()=>n[12]||(n[12]=[i("搜索")])),_:1,__:[12]}),e(I,{onClick:ee},{default:a(()=>n[13]||(n[13]=[i("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),J((f(),N(we,{data:_.value,border:"",stripe:"",style:{width:"100%","min-height":"320px"},"row-key":"instanceId","max-height":"500","row-class-name":"dense-row","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2}},{empty:a(()=>n[19]||(n[19]=[m("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:a(()=>[e(A,{prop:"instanceId",label:"业务实例ID",width:"150",fixed:"left"}),e(A,{prop:"instanceName",label:"业务实例名称","min-width":"150"}),e(A,{prop:"customerName",label:"客户名称","min-width":"180"}),e(A,{prop:"orderId",label:"订单ID",width:"150"}),e(A,{prop:"packageName",label:"套餐名称",width:"120"}),e(A,{label:"Anycast",width:"100",filters:[{text:"是",value:!0},{text:"否",value:!1}],"filter-method":l,"filter-placement":"bottom-end"},{default:a(({row:p})=>[e(ie,{type:p.isAnycast?"success":"info"},{default:a(()=>[i(h(p.isAnycast?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(A,{prop:"addressType",label:"地址类型",width:"100",filters:[{text:"IPv4",value:"IPv4"},{text:"IPv6",value:"IPv6"},{text:"双栈",value:"dual"}],"filter-method":$,"filter-placement":"bottom-end"},{default:a(({row:p})=>[e(ie,{type:P(p.addressType)},{default:a(()=>[i(h(E(p.addressType)),1)]),_:2},1032,["type"])]),_:1}),e(A,{label:"逻辑集群组","min-width":"180"},{default:a(({row:p})=>[e(ke,{effect:"light",content:K(p),placement:"top","show-after":500},{default:a(()=>[e(u,{type:"primary",onClick:M=>H(p)},{default:a(()=>[i(h(T(p)),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1}),e(A,{prop:"bandwidth",label:"防护带宽(Mbps)",width:"140",sortable:""}),e(A,{prop:"businessBandwidth",label:"业务带宽(Mbps)",width:"140",sortable:""}),e(A,{prop:"qps",label:"业务QPS",width:"120",sortable:""}),e(A,{prop:"protectionIpCount",label:"防护IP数",width:"120",sortable:""}),e(A,{prop:"domainCount",label:"防护域名数",width:"120",sortable:""}),e(A,{prop:"portCount",label:"端口数量",width:"120",sortable:""}),e(A,{prop:"status",label:"状态",width:"100",filters:[{text:"已启用",value:"active"},{text:"已禁用",value:"inactive"}],"filter-method":r,"filter-placement":"bottom-end"},{default:a(({row:p})=>[e(ie,{type:ue(p.status)},{default:a(()=>[i(h(Z(p.status)),1)]),_:2},1032,["type"])]),_:1}),e(A,{prop:"createTime",label:"创建时间",width:"180",sortable:""}),e(A,{label:"操作",width:"320",fixed:"right"},{default:a(({row:p})=>[p.status==="inactive"?(f(),N(I,{key:0,type:"success",link:"",onClick:M=>oe(p)},{default:a(()=>n[14]||(n[14]=[i(" 启用 ")])),_:2,__:[14]},1032,["onClick"])):z("",!0),p.status==="active"?(f(),N(I,{key:1,type:"warning",link:"",onClick:M=>re(p)},{default:a(()=>n[15]||(n[15]=[i(" 禁用 ")])),_:2,__:[15]},1032,["onClick"])):z("",!0),e(I,{type:"primary",link:"",onClick:M=>ne(p)},{default:a(()=>n[16]||(n[16]=[i(" 修改配置 ")])),_:2,__:[16]},1032,["onClick"]),e(I,{type:"primary",link:"",onClick:M=>s(p)},{default:a(()=>n[17]||(n[17]=[i(" 分配防护IP ")])),_:2,__:[17]},1032,["onClick"]),e(I,{type:"danger",link:"",onClick:M=>U(p)},{default:a(()=>n[18]||(n[18]=[i(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ae,Q.value]]),m("div",ot,[e(Ve,{"current-page":w.pageNum,"onUpdate:currentPage":n[2]||(n[2]=p=>w.pageNum=p),"page-size":w.pageSize,"onUpdate:pageSize":n[3]||(n[3]=p=>w.pageSize=p),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:w.total,background:"",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),e(Fe,{modelValue:R.value,"onUpdate:modelValue":n[4]||(n[4]=p=>R.value=p),"instance-data":C.value,"is-edit":t.value,onSuccess:D},null,8,["modelValue","instance-data","is-edit"]),e(tt,{modelValue:S.value,"onUpdate:modelValue":n[5]||(n[5]=p=>S.value=p),"instance-data":C.value,onSuccess:F},null,8,["modelValue","instance-data"]),e(be,{modelValue:x.value,"onUpdate:modelValue":n[7]||(n[7]=p=>x.value=p),title:"确认启用",width:"400px"},{footer:a(()=>[e(I,{onClick:n[6]||(n[6]=p=>x.value=!1)},{default:a(()=>n[22]||(n[22]=[i("取消")])),_:1,__:[22]}),e(I,{type:"success",onClick:se},{default:a(()=>n[23]||(n[23]=[i("确认启用")])),_:1,__:[23]})]),default:a(()=>{var p,M;return[m("div",null,[n[20]||(n[20]=i("确定要启用业务实例 ")),m("b",null,h((p=C.value)==null?void 0:p.instanceName),1),n[21]||(n[21]=i(" 吗？"))]),m("div",st,"ID: "+h((M=C.value)==null?void 0:M.instanceId),1)]}),_:1},8,["modelValue"]),e(be,{modelValue:y.value,"onUpdate:modelValue":n[9]||(n[9]=p=>y.value=p),title:"确认禁用",width:"400px"},{footer:a(()=>[e(I,{onClick:n[8]||(n[8]=p=>y.value=!1)},{default:a(()=>n[26]||(n[26]=[i("取消")])),_:1,__:[26]}),e(I,{type:"warning",onClick:d},{default:a(()=>n[27]||(n[27]=[i("确认禁用")])),_:1,__:[27]})]),default:a(()=>{var p,M;return[m("div",null,[n[24]||(n[24]=i("确定要禁用业务实例 ")),m("b",null,h((p=C.value)==null?void 0:p.instanceName),1),n[25]||(n[25]=i(" 吗？"))]),m("div",rt,"ID: "+h((M=C.value)==null?void 0:M.instanceId),1)]}),_:1},8,["modelValue"])])}}},dt=Ie(ut,[["__scopeId","data-v-05259fb9"]]);export{dt as default};
