import{_ as le,a as C,c as ce,n as ae,f,g as ne,l as M,d as h,w as l,i as oe,e as t,h as D,b as q,F as Q,p as X,t as U,k as w,v as pe,u as Y,E as S,A as fe,D as se,R as ve,o as ge,j as we,q as Ce}from"./index-BVji5qTU.js";function ye(){const k=Date.now()%1e12,n=Math.floor(Math.random()*1024),o=Math.floor(Math.random()*4096);return`CLU${k}${n.toString().padStart(3,"0")}${o.toString().padStart(4,"0")}`}const Z={slb4:"四层负载",wafcc:"七层负载/CC",waf:"WAF",blackhole:"黑洞",dns:"域名解析",ads:"ADS",firewall:"防火墙",flowanalysis:"流量分析"},_e={slb4:"/slb",wafcc:"/waf-cc",waf:"/waf",blackhole:"/blackhole",dns:"/dns",ads:"/ads",firewall:"/firewall",flowanalysis:"/traffic"},c=[{id:"CLU202412070001",name:"首尔机房WAF集群01",dataCenterId:"DC202407200001",networkElementType:"waf",status:"active",createTime:"2024-05-16 14:20:00",createAccount:"admin",updateTime:"2024-05-16 14:20:00",updateAccount:"admin",remark:"首尔地区WAF防护集群"},{id:"CLU202412070002",name:"北京机房SLB集群01",dataCenterId:"DC202401010001",networkElementType:"slb4",status:"active",createTime:"2024-01-01 10:00:00",createAccount:"admin",updateTime:"2024-01-01 10:00:00",updateAccount:"admin",remark:"北京地区四层负载均衡集群"},{id:"CLU202412070003",name:"上海机房WAF-CC集群01",dataCenterId:"DC202401010002",networkElementType:"wafcc",status:"active",createTime:"2024-02-15 09:30:00",createAccount:"admin",updateTime:"2024-02-15 09:30:00",updateAccount:"admin",remark:"上海地区七层负载和CC防护集群"},{id:"CLU202412070004",name:"广州机房ADS集群01",dataCenterId:"DC202401010003",networkElementType:"ads",status:"disabled",createTime:"2024-03-05 11:15:00",createAccount:"admin",updateTime:"2024-03-20 14:30:00",updateAccount:"admin",remark:"广州地区ADS防护集群，当前停用维护中"},{id:"CLU202412070005",name:"法兰克福机房黑洞集群01",dataCenterId:"DC202407200002",networkElementType:"blackhole",status:"active",createTime:"2024-04-18 14:20:00",createAccount:"admin",updateTime:"2024-04-18 14:20:00",updateAccount:"admin",remark:"德国法兰克福黑洞引流集群"},{id:"CLU202412070006",name:"迪拜机房DNS集群01",dataCenterId:"DC202407200003",networkElementType:"dns",status:"active",createTime:"2024-03-22 12:30:00",createAccount:"admin",updateTime:"2024-03-22 12:30:00",updateAccount:"admin",remark:"迪拜地区域名解析集群"},{id:"CLU202412070007",name:"洛杉矶机房防火墙集群01",dataCenterId:"DC202407200004",networkElementType:"firewall",status:"active",createTime:"2024-02-28 15:45:00",createAccount:"admin",updateTime:"2024-02-28 15:45:00",updateAccount:"admin",remark:"美国洛杉矶防火墙防护集群"},{id:"CLU202412070008",name:"无锡机房流量分析集群01",dataCenterId:"DC202401010004",networkElementType:"flowanalysis",status:"disabled",createTime:"2024-05-12 08:45:00",createAccount:"admin",updateTime:"2024-05-12 08:45:00",updateAccount:"admin",remark:"无锡地区流量分析集群"}];class ${static async getClustersByPage(n={}){return new Promise(o=>{setTimeout(()=>{let s=[...c];n.name&&(s=s.filter(_=>_.name.toLowerCase().includes(n.name.toLowerCase()))),n.networkElementType&&(s=s.filter(_=>_.networkElementType===n.networkElementType)),n.status&&(s=s.filter(_=>_.status===n.status));const a=parseInt(n.page)||1,u=parseInt(n.pageSize)||10,p=(a-1)*u,E=p+u,A=s.slice(p,E);o({data:A,total:s.length,page:a,pageSize:u})},300)})}static async getAllClusters(n={}){return new Promise(o=>{setTimeout(()=>{let s=[...c];n.name&&(s=s.filter(a=>a.name.toLowerCase().includes(n.name.toLowerCase()))),o({data:s,total:s.length})},200)})}static async addCluster(n){return new Promise((o,s)=>{setTimeout(()=>{if(c.some(p=>p.name===n.name)){s(new Error("集群名称已存在"));return}const u={...n,id:ye(),createTime:new Date().toLocaleString(),createAccount:"current_user",updateTime:new Date().toLocaleString(),updateAccount:"current_user"};c.push(u),o(u)},300)})}static async updateCluster(n){return new Promise((o,s)=>{setTimeout(()=>{const a=c.findIndex(p=>p.id===n.id);if(a===-1){s(new Error("集群不存在"));return}if(c.some(p=>p.name===n.name&&p.id!==n.id)){s(new Error("集群名称已存在"));return}c[a]={...c[a],...n,updateTime:new Date().toLocaleString(),updateAccount:"current_user"},o(c[a])},300)})}static async removeCluster(n){return new Promise((o,s)=>{setTimeout(()=>{const a=c.findIndex(E=>E.id===n);if(a===-1){s(new Error("集群不存在"));return}const u=Math.random()>.8,p=Math.random()>.8;if(u){s(new Error("集群中还有实例，无法删除"));return}if(p){s(new Error("集群中还有主机，无法删除"));return}c.splice(a,1),o({success:!0})},300)})}static async enableCluster(n){return new Promise((o,s)=>{setTimeout(()=>{const a=c.findIndex(u=>u.id===n);if(a===-1){s(new Error("集群不存在"));return}c[a].status="active",c[a].updateTime=new Date().toLocaleString(),c[a].updateAccount="current_user",o(c[a])},200)})}static async disableCluster(n){return new Promise((o,s)=>{setTimeout(()=>{const a=c.findIndex(u=>u.id===n);if(a===-1){s(new Error("集群不存在"));return}c[a].status="disabled",c[a].updateTime=new Date().toLocaleString(),c[a].updateAccount="current_user",o(c[a])},200)})}static async checkClusterNameUnique(n,o=""){return new Promise(s=>{setTimeout(()=>{const a=c.some(u=>u.name===n&&u.id!==o);s({unique:!a})},100)})}static async getClusterById(n){return new Promise((o,s)=>{setTimeout(()=>{const a=c.find(u=>u.id===n);a?o(a):s(new Error("集群不存在"))},100)})}}const be=k=>{const n=_e[k.networkElementType];if(!n)return console.error("未知的网元类型:",k.networkElementType),"";const o=new URLSearchParams({clusterId:k.id,clusterName:k.name,from:"cluster-management"});return`${n}?${o.toString()}`},ke={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Te={key:0,class:"form-tip"},Ee={class:"dialog-footer"},he={__name:"ClusterModal",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},editData:{type:Object,default:()=>({})}},emits:["update:visible","submit"],setup(k,{emit:n}){const o=k,s=n,a=C(!1),u=C(),p=C({dataCenters:!1}),E=C(!1),A=C([]),_=C([]),g=C({name:"",dataCenterId:"",networkElementType:"",status:"active",remark:""}),P=ce(()=>A.value.filter(m=>m.status==="active")),j=m=>{const r=_.value.find(T=>T.id===m);return r?r.name:m},x={name:[{required:!0,message:"请输入集群名称",trigger:"blur"},{validator:async(m,r,T)=>{if(!r){T(new Error("请输入集群名称"));return}if(r.length>16){T(new Error("集群名称最多16个字符"));return}try{const V=o.isEdit?o.editData.id:"";if(!(await $.checkClusterNameUnique(r,V)).unique){T(new Error("集群名称已存在"));return}T()}catch{T(new Error("名称验证失败"))}},trigger:"blur"}],dataCenterId:[{required:!0,message:"请选择所属机房",trigger:"change"}],networkElementType:[{required:!0,message:"请选择网元类型",trigger:"change"}],status:[{required:!0,message:"请选择集群状态",trigger:"change"}],remark:[{max:256,message:"备注信息最多256个字符",trigger:"blur"}]},H=async()=>{p.value.dataCenters=!0;try{const m=await se.getDataCenters();A.value=m}catch(m){S.error("加载机房数据失败："+m.message)}finally{p.value.dataCenters=!1}},z=async()=>{try{const m=await ve.getRegions();_.value=m}catch(m){console.error("加载地域数据失败：",m)}},R=()=>{g.value={name:"",dataCenterId:"",networkElementType:"",status:"active",remark:""},fe(()=>{var m;(m=u.value)==null||m.clearValidate()})},O=()=>{o.isEdit&&o.editData?g.value={id:o.editData.id,name:o.editData.name,dataCenterId:o.editData.dataCenterId,networkElementType:o.editData.networkElementType,status:o.editData.status,remark:o.editData.remark||""}:R()},G=async()=>{try{if(!await u.value.validate())return;E.value=!0;const r={...g.value};o.isEdit?(await $.updateCluster(r),S.success("编辑成功")):(await $.addCluster(r),S.success("创建成功")),s("submit"),B()}catch(m){S.error(`${o.isEdit?"编辑":"创建"}失败：`+m.message)}finally{E.value=!1}},B=()=>{s("update:visible",!1),R()};return ae(()=>o.visible,m=>{a.value=m,m&&(H(),z(),O())}),ae(a,m=>{m||s("update:visible",!1)}),(m,r)=>{const T=f("el-input"),V=f("el-form-item"),F=f("el-tag"),W=f("el-option"),d=f("el-select"),e=f("el-radio"),y=f("el-radio-group"),J=f("el-form"),L=f("el-button"),N=f("el-dialog"),K=ne("loading");return h(),M(N,{modelValue:a.value,"onUpdate:modelValue":r[5]||(r[5]=v=>a.value=v),title:k.isEdit?"编辑集群":"新建集群",width:"600px","close-on-click-modal":!1,onClose:B},{footer:l(()=>[D("div",Ee,[t(L,{onClick:B},{default:l(()=>[...r[9]||(r[9]=[w("取消",-1)])]),_:1}),t(L,{type:"primary",onClick:G,loading:E.value},{default:l(()=>[...r[10]||(r[10]=[w(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[oe((h(),M(J,{model:g.value,rules:x,ref_key:"formRef",ref:u,"label-width":"100px"},{default:l(()=>[t(V,{label:"集群名称",prop:"name"},{default:l(()=>[t(T,{modelValue:g.value.name,"onUpdate:modelValue":r[0]||(r[0]=v=>g.value.name=v),placeholder:"请输入集群名称（最多16个字符）",maxlength:"16","show-word-limit":"",clearable:""},null,8,["modelValue"]),r[6]||(r[6]=D("div",{class:"form-tip"}," 集群名称在所有网元类型中全局唯一 ",-1))]),_:1}),t(V,{label:"所属机房",prop:"dataCenterId"},{default:l(()=>[t(d,{modelValue:g.value.dataCenterId,"onUpdate:modelValue":r[1]||(r[1]=v=>g.value.dataCenterId=v),placeholder:"请选择机房",clearable:"",style:{width:"100%"},loading:p.value.dataCenters,filterable:""},{default:l(()=>[(h(!0),q(Q,null,X(P.value,v=>(h(),M(W,{key:v.id,label:v.name,value:v.id},{default:l(()=>[D("div",ke,[D("span",null,U(v.name),1),t(F,{size:"small",effect:"plain"},{default:l(()=>[w(U(j(v.regionId)),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(V,{label:"网元类型",prop:"networkElementType"},{default:l(()=>[t(d,{modelValue:g.value.networkElementType,"onUpdate:modelValue":r[2]||(r[2]=v=>g.value.networkElementType=v),placeholder:"请选择网元类型",style:{width:"100%"},disabled:k.isEdit},{default:l(()=>[(h(!0),q(Q,null,X(Y(Z),(v,b)=>(h(),M(W,{key:b,label:v,value:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),k.isEdit?(h(),q("div",Te," 网元类型创建后不可修改 ")):pe("",!0)]),_:1}),t(V,{label:"集群状态",prop:"status"},{default:l(()=>[t(y,{modelValue:g.value.status,"onUpdate:modelValue":r[3]||(r[3]=v=>g.value.status=v)},{default:l(()=>[t(e,{value:"active"},{default:l(()=>[...r[7]||(r[7]=[w("启用",-1)])]),_:1}),t(e,{value:"disabled"},{default:l(()=>[...r[8]||(r[8]=[w("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"备注",prop:"remark"},{default:l(()=>[t(T,{modelValue:g.value.remark,"onUpdate:modelValue":r[4]||(r[4]=v=>g.value.remark=v),type:"textarea",rows:3,placeholder:"请输入备注信息（最多256个字符）",maxlength:"256","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[K,p.value.dataCenters]])]),_:1},8,["modelValue","title"])}}},De=le(he,[["__scopeId","data-v-0f0d1dee"]]),xe={class:"cluster-management"},Ve={class:"card-header"},Se={class:"search-area"},Ie={class:"pagination-container"},Ae={class:"text-sm text-gray-500 mt-2"},Ue={__name:"ClusterManagement",setup(k){const n=C(!1),o=C([]),s=C([]),a=C({page:1,pageSize:10,total:0}),u=C({name:"",networkElementType:"",status:""}),p=C(!1),E=C(!1),A=C(null),_=C(!1),g=C(null),P=C(!1),j=d=>{const e=s.value.find(y=>y.id===d);return e?e.name:d},ee=d=>({slb4:"primary",wafcc:"success",waf:"warning",blackhole:"danger",dns:"info",ads:"",firewall:"primary",flowanalysis:"success"})[d]||"",x=async()=>{n.value=!0;try{const d={...u.value,page:a.value.page,pageSize:a.value.pageSize},e=await $.getClustersByPage(d);o.value=e.data,a.value.total=e.total}catch(d){S.error("加载数据失败："+d.message)}finally{n.value=!1}},H=async()=>{try{const d=await se.getDataCenters();s.value=d}catch(d){console.error("加载机房数据失败：",d)}},z=()=>{a.value.page=1,x()},R=()=>{u.value={name:"",networkElementType:"",status:""},a.value.page=1,x()},O=()=>{E.value=!1,A.value=null,p.value=!0},G=d=>{E.value=!0,A.value={...d},p.value=!0},B=d=>{const e=be(d);e?window.open(e,"_blank"):S.warning("无法跳转到该网元类型的管理页面")},m=async d=>{const e=d.status==="active"?"停用":"启用";try{await Ce.confirm(`确定要${e}集群 "${d.name}" 吗？`,`${e}集群`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(d.status==="active"?$.disableCluster:$.enableCluster)(d.id),S.success(`${e}成功`),x()}catch(y){y!=="cancel"&&S.error(`${e}失败：`+y.message)}},r=d=>{g.value=d,_.value=!0},T=async()=>{P.value=!0;try{await $.removeCluster(g.value.id),S.success("删除成功"),_.value=!1,x()}catch(d){S.error("删除失败："+d.message)}finally{P.value=!1}},V=()=>{p.value=!1,x()},F=d=>{a.value.pageSize=d,a.value.page=1,x()},W=d=>{a.value.page=d,x()};return ge(()=>{x(),H()}),(d,e)=>{const y=f("el-button"),J=f("el-input"),L=f("el-form-item"),N=f("el-option"),K=f("el-select"),v=f("el-form"),b=f("el-table-column"),te=f("el-tag"),re=f("el-table"),ie=f("el-pagination"),de=f("el-card"),ue=f("el-dialog"),me=ne("loading");return h(),q("div",xe,[t(de,{class:"box-card"},{header:l(()=>[D("div",Ve,[e[9]||(e[9]=D("span",null,"集群管理",-1)),t(y,{type:"primary",onClick:O},{default:l(()=>[...e[8]||(e[8]=[w("新建集群",-1)])]),_:1})])]),default:l(()=>[D("div",Se,[t(v,{inline:!0,model:u.value},{default:l(()=>[t(L,{label:"名称"},{default:l(()=>[t(J,{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value.name=i),placeholder:"请输入集群名称",clearable:"",style:{width:"260px"},onKeyup:we(z,["enter"]),onClear:z},null,8,["modelValue"])]),_:1}),t(L,{label:"网元类型"},{default:l(()=>[t(K,{modelValue:u.value.networkElementType,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value.networkElementType=i),placeholder:"请选择网元类型",clearable:"",style:{width:"180px"},onChange:z},{default:l(()=>[(h(!0),q(Q,null,X(Y(Z),(i,I)=>(h(),M(N,{key:I,label:i,value:I},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(L,{label:"状态"},{default:l(()=>[t(K,{modelValue:u.value.status,"onUpdate:modelValue":e[2]||(e[2]=i=>u.value.status=i),placeholder:"请选择状态",clearable:"",style:{width:"120px"},onChange:z},{default:l(()=>[t(N,{label:"启用",value:"active"}),t(N,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),t(L,null,{default:l(()=>[t(y,{type:"primary",onClick:z},{default:l(()=>[...e[10]||(e[10]=[w("搜索",-1)])]),_:1}),t(y,{onClick:R},{default:l(()=>[...e[11]||(e[11]=[w("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),oe((h(),M(re,{data:o.value,border:"",stripe:"",style:{width:"100%","margin-top":"20px"},"header-cell-style":{background:"#f5f7fa",color:"#606266"},"row-class-name":"dense-row","cell-style":{padding:"8px 0"}},{default:l(()=>[t(b,{prop:"id",label:"ID",width:"200","show-overflow-tooltip":""}),t(b,{prop:"name",label:"名称","min-width":"180","show-overflow-tooltip":""}),t(b,{prop:"networkElementType",label:"类型",width:"120",align:"center"},{default:l(({row:i})=>[t(te,{type:ee(i.networkElementType),size:"small"},{default:l(()=>[w(U(Y(Z)[i.networkElementType]),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"dataCenterId",label:"机房",width:"150","show-overflow-tooltip":""},{default:l(({row:i})=>[w(U(j(i.dataCenterId)),1)]),_:1}),t(b,{prop:"status",label:"状态",width:"80",align:"center"},{default:l(({row:i})=>[t(te,{type:i.status==="active"?"success":"info",size:"small"},{default:l(()=>[w(U(i.status==="active"?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"createTime",label:"创建时间",width:"160"}),t(b,{prop:"createAccount",label:"创建人",width:"100"}),t(b,{prop:"updateTime",label:"修改时间",width:"160"}),t(b,{prop:"updateAccount",label:"修改人",width:"100"}),t(b,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),t(b,{label:"操作",width:"200",fixed:"right"},{default:l(({row:i})=>[t(y,{type:"primary",size:"small",link:"",onClick:I=>G(i)},{default:l(()=>[...e[12]||(e[12]=[w(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(y,{type:"success",size:"small",link:"",onClick:I=>B(i)},{default:l(()=>[...e[13]||(e[13]=[w(" 详情 ",-1)])]),_:1},8,["onClick"]),t(y,{type:i.status==="active"?"warning":"success",size:"small",link:"",onClick:I=>m(i)},{default:l(()=>[w(U(i.status==="active"?"停用":"启用"),1)]),_:2},1032,["type","onClick"]),t(y,{type:"danger",size:"small",link:"",onClick:I=>r(i)},{default:l(()=>[...e[14]||(e[14]=[w(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,n.value]]),D("div",Ie,[t(ie,{"current-page":a.value.page,"onUpdate:currentPage":e[3]||(e[3]=i=>a.value.page=i),"page-size":a.value.pageSize,"onUpdate:pageSize":e[4]||(e[4]=i=>a.value.pageSize=i),total:a.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),_:1}),t(De,{visible:p.value,"onUpdate:visible":e[5]||(e[5]=i=>p.value=i),"is-edit":E.value,"edit-data":A.value,onSubmit:V},null,8,["visible","is-edit","edit-data"]),t(ue,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=i=>_.value=i),title:"确认删除",width:"400px"},{footer:l(()=>[t(y,{onClick:e[6]||(e[6]=i=>_.value=!1)},{default:l(()=>[...e[17]||(e[17]=[w("取消",-1)])]),_:1}),t(y,{type:"danger",onClick:T,loading:P.value},{default:l(()=>[...e[18]||(e[18]=[w(" 确认删除 ",-1)])]),_:1},8,["loading"])]),default:l(()=>{var i,I;return[D("div",null,[e[15]||(e[15]=w("确定要删除集群 ",-1)),D("b",null,U((i=g.value)==null?void 0:i.name),1),e[16]||(e[16]=w(" 吗？",-1))]),D("div",Ae,"ID: "+U((I=g.value)==null?void 0:I.id),1)]}),_:1},8,["modelValue"])])}}},Le=le(Ue,[["__scopeId","data-v-17f0c318"]]);export{Le as default};
