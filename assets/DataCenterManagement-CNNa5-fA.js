import{_ as Pe,r as O,a as m,c as T,o as Se,b as De,d as t,w as o,e as i,R as H,D as V,f as ze,g as U,h as g,i as G,j as Ie,k as s,l as Y,t as C,u as Ee,m as Te,C as Z,E as f,n as J}from"./index-Cw2xnON0.js";const Ue={class:"datacenter-management"},$e={class:"card-header"},Re={class:"search-area"},Ae={class:"ellipsis-cell"},Be={class:"ellipsis-cell"},Fe={class:"mt-2 flex justify-end"},Ne={class:"pagination-container"},je={class:"dialog-footer"},qe={class:"text-xs text-gray-500 mt-2"},Q="datacenter-page-size",Me={__name:"DataCenterManagement",setup(Le){const _=O({name:""}),$=m([]),h=m(!1),S=m(null),x=m(!1),R=m([]),A=m([]),y=m(!1),D=m(),k=m(!1),P=m(null),r=O({id:"",name:"",regionId:"",status:"active",contactPerson:"",contactPhone:"",contactEmail:"",remark:"",createTime:"",createAccount:"",updateTime:"",updateAccount:""}),W={name:[{required:!0,message:"请输入机房名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],regionId:[{required:!0,message:"请选择地域",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],contactPerson:[{required:!1,message:"请输入联系人",trigger:"blur"}],contactPhone:[{required:!1,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],contactEmail:[{required:!1,message:"请输入联系邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},z=m(!1),b=m([]),v=m({prop:"",order:""});function X(){b.value=[],u.value.currentPage=1}function ee(){z.value=!1,u.value.currentPage=1}function te({prop:a,order:e}){v.value={prop:a,order:e}}const ae=T(()=>A.value),le=async()=>{try{A.value=await H.getRegionTree(),R.value=await H.getRegions()}catch(a){console.error("获取地域数据失败:",a)}},B=a=>{const e=R.value.find(n=>n.id===a);return e?e.name:a},I=async()=>{h.value=!0;try{$.value=await V.getDataCenters(),h.value=!1}catch(a){console.error("获取机房数据失败:",a),h.value=!1}},oe=Number(localStorage.getItem(Q))||10,u=m({currentPage:1,pageSize:oe,total:0}),F=T(()=>{let a=$.value;if(_.name){const e=_.name.toLowerCase();a=a.filter(n=>n.name.toLowerCase().includes(e))}return b.value.length&&(a=a.filter(e=>b.value.includes(e.status))),v.value.prop&&v.value.order&&(a=[...a].sort((e,n)=>{let d=e[v.value.prop],c=n[v.value.prop];return(v.value.prop==="createTime"||v.value.prop==="updateTime")&&(d=new Date(d).getTime(),c=new Date(c).getTime()),v.value.order==="ascending"?d>c?1:-1:d<c?1:-1})),u.value.total=a.length,a}),ne=T(()=>{const a=(u.value.currentPage-1)*u.value.pageSize,e=a+u.value.pageSize;return F.value.slice(a,e)}),E=()=>{console.log("搜索:",_),u.value.currentPage=1},re=()=>{_.name="",b.value=[],u.value.currentPage=1,E()},se=async()=>{x.value=!1,Object.assign(r,{id:"",name:"",regionId:"",status:"active",contactPerson:"",contactPhone:"",contactEmail:"",remark:"",createTime:"",createAccount:"",updateTime:"",updateAccount:""}),y.value=!0},ie=a=>{x.value=!0,Object.assign(r,{id:a.id,name:a.name,regionId:a.regionId,status:a.status,contactPerson:a.contactPerson,contactPhone:a.contactPhone,contactEmail:a.contactEmail,remark:a.remark}),y.value=!0},ue=async a=>{try{const e=await Z.getClustersByDataCenterId(a.id);if(e.length>0){J.alert(`该机房已被${e.length}个集群关联使用，无法删除。请先移除关联集群再进行删除操作。`,"无法删除",{type:"warning"});return}P.value=a,k.value=!0}catch(e){console.error("检查关联集群失败:",e),f.error("操作失败")}},de=async()=>{try{await V.deleteDataCenter(P.value.id),f.success("删除成功"),I()}catch(a){console.error("删除机房失败:",a),f.error("删除机房失败")}k.value=!1},ce=async a=>{const e=a.status==="active"?"disabled":"active";try{await V.updateDataCenter(a.id,{status:e}),a.status=e,f.success(`机房已${e==="active"?"启用":"禁用"}`)}catch(n){console.error("更新机房状态失败:",n),f.error("更新机房状态失败")}},pe=async()=>{D.value.validate(async a=>{if(a)try{x.value?(await V.updateDataCenter(r.id,r),f.success("编辑成功")):(await V.addDataCenter(r),f.success("新增成功")),y.value=!1,I()}catch(e){console.error("提交表单失败:",e),f.error("提交表单失败")}})},me=()=>{var a;(a=D.value)==null||a.resetFields()},ge=async a=>{S.value=a.id;try{const e=await Z.getClustersByDataCenterId(a.id);if(e.length===0){f.info("当前机房暂无关联集群");return}const n=e.map(d=>`<li>${d.displayName} (${d.name})</li>`).join("");J.alert(`<div>
        <p>机房 <b>${a.name}</b> 关联的集群列表:</p>
        <ul>${n}</ul>
      </div>`,"关联集群",{dangerouslyUseHTMLString:!0})}catch(e){console.error("获取关联集群失败:",e),f.error("获取关联集群失败")}finally{S.value=null}},fe=a=>{u.value.pageSize=a,localStorage.setItem(Q,a)},ve=a=>{u.value.currentPage=a};return Se(async()=>{await le(),await I()}),(a,e)=>{const n=i("el-button"),d=i("el-input"),c=i("el-form-item"),N=i("el-form"),p=i("el-table-column"),j=i("el-tooltip"),q=i("el-checkbox"),_e=i("el-checkbox-group"),be=i("el-icon"),ye=i("el-popover"),we=i("el-tag"),Ce=i("el-table"),ke=i("el-pagination"),Ve=i("el-card"),he=i("el-cascader"),M=i("el-radio"),xe=i("el-radio-group"),L=i("el-dialog"),K=ze("loading");return U(),De("div",Ue,[t(Ve,{class:"box-card"},{header:o(()=>[g("div",$e,[e[17]||(e[17]=g("span",null,"机房管理",-1)),t(n,{type:"primary",onClick:se},{default:o(()=>e[16]||(e[16]=[s("新建机房")])),_:1,__:[16]})])]),default:o(()=>[g("div",Re,[t(N,{inline:!0,model:_},{default:o(()=>[t(c,{label:"名称"},{default:o(()=>[t(d,{modelValue:_.name,"onUpdate:modelValue":e[0]||(e[0]=l=>_.name=l),placeholder:"请输入机房名称",clearable:"",style:{"max-width":"260px"},onKeyup:Ie(E,["enter"])},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(n,{type:"primary",onClick:E},{default:o(()=>e[18]||(e[18]=[s("搜索")])),_:1,__:[18]}),t(n,{onClick:re},{default:o(()=>e[19]||(e[19]=[s("重置")])),_:1,__:[19]})]),_:1})]),_:1},8,["model"])]),G((U(),Y(Ce,{data:ne.value,style:{width:"100%","min-height":"500px","margin-top":"20px"},border:"",stripe:"","max-height":"700","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2},"row-class-name":"dense-row",onSortChange:te},{empty:o(()=>e[28]||(e[28]=[g("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:o(()=>[t(p,{prop:"id",label:"ID",width:"180",fixed:"left"}),t(p,{prop:"name",label:"名称",width:"150"},{default:o(l=>[t(j,{effect:"dark",content:l.row.name,placement:"top"},{default:o(()=>[g("span",Ae,C(l.row.name),1)]),_:2},1032,["content"])]),_:1}),t(p,{prop:"regionId",label:"地域",width:"120"},{default:o(l=>[t(j,{effect:"dark",content:B(l.row.regionId),placement:"top"},{default:o(()=>[g("span",Be,C(B(l.row.regionId)),1)]),_:2},1032,["content"])]),_:1}),t(p,{prop:"status",label:"状态",width:"100"},{header:o(()=>[e[24]||(e[24]=g("span",null,"状态",-1)),t(ye,{placement:"bottom",width:"160",trigger:"click",visible:z.value,"onUpdate:visible":e[2]||(e[2]=l=>z.value=l)},{reference:o(()=>[t(be,{color:b.value.length?"#409EFF":"#909399",class:"ml-1 cursor-pointer"},{default:o(()=>[t(Ee(Te))]),_:1},8,["color"])]),default:o(()=>[g("div",null,[t(_e,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l)},{default:o(()=>[t(q,{label:"active"},{default:o(()=>e[20]||(e[20]=[s("启用")])),_:1,__:[20]}),t(q,{label:"disabled"},{default:o(()=>e[21]||(e[21]=[s("禁用")])),_:1,__:[21]})]),_:1},8,["modelValue"]),g("div",Fe,[t(n,{size:"small",onClick:X},{default:o(()=>e[22]||(e[22]=[s("重置")])),_:1,__:[22]}),t(n,{size:"small",type:"primary",onClick:ee},{default:o(()=>e[23]||(e[23]=[s("确定")])),_:1,__:[23]})])])]),_:1},8,["visible"])]),default:o(l=>[t(we,{type:l.row.status==="active"?"success":"danger"},{default:o(()=>[s(C(l.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"contactPerson",label:"联系人",width:"120"}),t(p,{prop:"contactPhone",label:"联系电话",width:"140"}),t(p,{prop:"contactEmail",label:"联系邮箱",width:"180"}),t(p,{label:"关联集群",width:"100"},{default:o(l=>[G((U(),Y(n,{type:"info",link:"",size:"small",onClick:w=>ge(l.row)},{default:o(()=>e[25]||(e[25]=[s(" 查看关联 ")])),_:2,__:[25]},1032,["onClick"])),[[K,S.value===l.row.id,void 0,{inline:!0}]])]),_:1}),t(p,{prop:"remark",label:"备注","min-width":"200","show-overflow-tooltip":""}),t(p,{prop:"createTime",label:"创建时间",width:"160",sortable:""}),t(p,{prop:"createAccount",label:"创建人",width:"120"}),t(p,{prop:"updateTime",label:"修改时间",width:"160",sortable:""}),t(p,{prop:"updateAccount",label:"修改人",width:"120"}),t(p,{label:"操作",width:"180",fixed:"right"},{default:o(l=>[t(n,{type:"primary",link:"",size:"small",onClick:w=>ie(l.row)},{default:o(()=>e[26]||(e[26]=[s("编辑")])),_:2,__:[26]},1032,["onClick"]),t(n,{type:l.row.status==="active"?"danger":"success",link:"",size:"small",onClick:w=>ce(l.row)},{default:o(()=>[s(C(l.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(n,{type:"danger",link:"",size:"small",onClick:w=>ue(l.row)},{default:o(()=>e[27]||(e[27]=[s("删除")])),_:2,__:[27]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,h.value]]),g("div",Ne,[t(ke,{"current-page":u.value.currentPage,"onUpdate:currentPage":e[3]||(e[3]=l=>u.value.currentPage=l),"page-size":u.value.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>u.value.pageSize=l),"page-sizes":[10,20,50,100],total:F.value.length,layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:fe,onCurrentChange:ve},null,8,["current-page","page-size","total"])])]),_:1}),t(L,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=l=>y.value=l),title:x.value?"编辑机房":"新建机房",width:"600px","close-on-click-modal":!1,onClose:me},{footer:o(()=>[g("span",je,[t(n,{onClick:e[12]||(e[12]=l=>y.value=!1)},{default:o(()=>e[31]||(e[31]=[s("取消")])),_:1,__:[31]}),t(n,{type:"primary",onClick:pe},{default:o(()=>e[32]||(e[32]=[s("确定")])),_:1,__:[32]})])]),default:o(()=>[t(N,{model:r,rules:W,ref_key:"formRef",ref:D,"label-width":"100px"},{default:o(()=>[t(c,{label:"名称",prop:"name"},{default:o(()=>[t(d,{modelValue:r.name,"onUpdate:modelValue":e[5]||(e[5]=l=>r.name=l),placeholder:"请输入机房名称"},null,8,["modelValue"])]),_:1}),t(c,{label:"地域",prop:"regionId"},{default:o(()=>[t(he,{modelValue:r.regionId,"onUpdate:modelValue":e[6]||(e[6]=l=>r.regionId=l),options:ae.value,props:{checkStrictly:!0,value:"id",label:"name",emitPath:!1,expandTrigger:"hover"},placeholder:"请选择地域",clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(c,{label:"状态",prop:"status"},{default:o(()=>[t(xe,{modelValue:r.status,"onUpdate:modelValue":e[7]||(e[7]=l=>r.status=l)},{default:o(()=>[t(M,{label:"active"},{default:o(()=>e[29]||(e[29]=[s("启用")])),_:1,__:[29]}),t(M,{label:"disabled"},{default:o(()=>e[30]||(e[30]=[s("禁用")])),_:1,__:[30]})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"联系人",prop:"contactPerson"},{default:o(()=>[t(d,{modelValue:r.contactPerson,"onUpdate:modelValue":e[8]||(e[8]=l=>r.contactPerson=l),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),t(c,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[t(d,{modelValue:r.contactPhone,"onUpdate:modelValue":e[9]||(e[9]=l=>r.contactPhone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),t(c,{label:"联系邮箱",prop:"contactEmail"},{default:o(()=>[t(d,{modelValue:r.contactEmail,"onUpdate:modelValue":e[10]||(e[10]=l=>r.contactEmail=l),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),t(c,{label:"备注",prop:"remark"},{default:o(()=>[t(d,{modelValue:r.remark,"onUpdate:modelValue":e[11]||(e[11]=l=>r.remark=l),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(L,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=l=>k.value=l),title:"确认删除",width:"400px"},{footer:o(()=>[t(n,{onClick:e[14]||(e[14]=l=>k.value=!1)},{default:o(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]}),t(n,{type:"danger",onClick:de},{default:o(()=>e[36]||(e[36]=[s("确认删除")])),_:1,__:[36]})]),default:o(()=>{var l,w;return[g("div",null,[e[33]||(e[33]=s("确定要删除机房 ")),g("b",null,C((l=P.value)==null?void 0:l.name),1),e[34]||(e[34]=s(" 吗？"))]),g("div",qe,"ID: "+C((w=P.value)==null?void 0:w.id),1)]}),_:1},8,["modelValue"])])}}},Oe=Pe(Me,[["__scopeId","data-v-ee30b1e6"]]);export{Oe as default};
