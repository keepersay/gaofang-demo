import{_ as ee,a as w,r as G,o as te,b as ae,d as t,w as a,h as x,i as oe,e as T,k as r,u as E,z as le,A as ne,B as ie,f as se,l as W,t as u,s as re,E as U,g as F}from"./index-Bo66fHpz.js";class de{async queryIpAllocationLogs(o){return new Promise(g=>{setTimeout(()=>{const d=[{id:"CUST0001",name:"阿里云科技有限公司"},{id:"CUST0002",name:"腾讯科技(深圳)有限公司"},{id:"CUST0003",name:"百度在线网络技术(北京)有限公司"},{id:"CUST0004",name:"京东科技控股股份有限公司"},{id:"CUST0005",name:"字节跳动有限公司"},{id:"CUST0006",name:"网易(杭州)网络有限公司"},{id:"CUST0007",name:"华为技术有限公司"},{id:"CUST0008",name:"小米科技有限责任公司"}],O=[{id:"INST000001",name:"电商平台-主站"},{id:"INST000002",name:"视频服务-CDN"},{id:"INST000003",name:"支付系统-核心"},{id:"INST000004",name:"游戏平台-国际版"},{id:"INST000005",name:"企业邮箱-集群1"},{id:"INST000006",name:"云存储-北区"},{id:"INST000007",name:"数据库服务-主节点"},{id:"INST000008",name:"人工智能-推理集群"},{id:"INST000009",name:"直播平台-边缘节点"},{id:"INST000010",name:"物联网-数据中心"}],S=[{id:"POOL0001",name:"电信骨干网-BGP"},{id:"POOL0002",name:"联通骨干网-BGP"},{id:"POOL0003",name:"移动骨干网-BGP"},{id:"POOL0004",name:"国际线路-香港"},{id:"POOL0005",name:"国际线路-新加坡"},{id:"POOL0006",name:"Anycast全球加速"}],f=["103.24.178.0/24","103.24.179.0/24","103.215.32.0/22","116.128.128.0/17","118.26.96.0/21","118.26.104.0/21","118.26.112.0/21","118.26.120.0/21","118.26.128.0/21","119.28.0.0/16","119.29.0.0/16","120.88.56.0/23","121.51.0.0/16","122.152.192.0/18","123.206.0.0/16","129.204.0.0/16","129.211.0.0/16","129.226.0.0/16","2402:4e00::/32","2407:c080::/32"],i=100,{pageNum:y=1,pageSize:s=10}=o,P=[];for(let n=0;n<s;n++){const m=(y-1)*s+n;if(m>=i)break;const h=m%3!==0?"allocate":"reclaim",v=new Date;v.setDate(v.getDate()-m);const C=d[m%d.length],A=O[m%O.length],k=S[m%S.length],D=f[m%f.length].split("/")[0].split("."),R=(parseInt(D[3])+m)%255,N=`${D[0]}.${D[1]}.${D[2]}.${R}`;P.push({id:`IPAL${String(m+1).padStart(6,"0")}`,ipAddress:N,instanceId:A.id,instanceName:A.name,customerId:C.id,customerName:C.name,operationType:h,operationTime:v.toISOString(),operatorId:`USER${String(m%5+1).padStart(4,"0")}`,operatorName:`操作员-${m%5+1}`,ipPoolId:k.id,ipPoolName:k.name,remark:h==="allocate"?`分配IP用于${["Web服务","API服务","数据库服务","缓存服务","负载均衡"][m%5]}`:"回收闲置IP资源"})}let c=[...P];if(o.ipAddress&&(c=c.filter(n=>n.ipAddress.includes(o.ipAddress))),o.instanceId&&(c=c.filter(n=>n.instanceId.includes(o.instanceId)||n.instanceName.includes(o.instanceId))),o.customerId&&(c=c.filter(n=>n.customerId.includes(o.customerId)||n.customerName.includes(o.customerId))),o.operationType&&(c=c.filter(n=>n.operationType===o.operationType)),o.ipPoolId&&(c=c.filter(n=>n.ipPoolId===o.ipPoolId)),o.dateRange&&o.dateRange.length===2){const n=new Date(o.dateRange[0]),m=new Date(o.dateRange[1]);c=c.filter(b=>{const h=new Date(b.operationTime);return h>=n&&h<=m})}g({records:c,total:Math.min(i,c.length),pageNum:y,pageSize:s})},500)})}async getIpAllocationLogDetail(o){return new Promise(g=>{setTimeout(()=>{const d=parseInt(o.replace("IPAL",""))-1,S=d%3!==0?"allocate":"reclaim",f=new Date;f.setDate(f.getDate()-d);const i=[{id:"CUST0001",name:"阿里云科技有限公司"},{id:"CUST0002",name:"腾讯科技(深圳)有限公司"},{id:"CUST0003",name:"百度在线网络技术(北京)有限公司"},{id:"CUST0004",name:"京东科技控股股份有限公司"},{id:"CUST0005",name:"字节跳动有限公司"},{id:"CUST0006",name:"网易(杭州)网络有限公司"},{id:"CUST0007",name:"华为技术有限公司"},{id:"CUST0008",name:"小米科技有限责任公司"}],y=[{id:"INST000001",name:"电商平台-主站"},{id:"INST000002",name:"视频服务-CDN"},{id:"INST000003",name:"支付系统-核心"},{id:"INST000004",name:"游戏平台-国际版"},{id:"INST000005",name:"企业邮箱-集群1"},{id:"INST000006",name:"云存储-北区"},{id:"INST000007",name:"数据库服务-主节点"},{id:"INST000008",name:"人工智能-推理集群"},{id:"INST000009",name:"直播平台-边缘节点"},{id:"INST000010",name:"物联网-数据中心"}],s=[{id:"POOL0001",name:"电信骨干网-BGP"},{id:"POOL0002",name:"联通骨干网-BGP"},{id:"POOL0003",name:"移动骨干网-BGP"},{id:"POOL0004",name:"国际线路-香港"},{id:"POOL0005",name:"国际线路-新加坡"},{id:"POOL0006",name:"Anycast全球加速"}],P=["103.24.178.0/24","103.24.179.0/24","103.215.32.0/22","116.128.128.0/17","118.26.96.0/21","118.26.104.0/21"],c=i[d%i.length],n=y[d%y.length],m=s[d%s.length],b=P[d%P.length],v=b.split("/")[0].split("."),C=(parseInt(v[3])+d)%255,A=`${v[0]}.${v[1]}.${v[2]}.${C}`;g({id:o,ipAddress:A,instanceId:n.id,instanceName:n.name,customerId:c.id,customerName:c.name,operationType:S,operationTime:f.toISOString(),operatorId:`USER${String(d%5+1).padStart(4,"0")}`,operatorName:`操作员-${d%5+1}`,ipPoolId:m.id,ipPoolName:m.name,remark:S==="allocate"?`分配IP用于${["Web服务","API服务","数据库服务","缓存服务","负载均衡"][d%5]}`:"回收闲置IP资源",requestId:`REQ${String(d+1e3).padStart(8,"0")}`,approvalStatus:"approved",approvalTime:new Date(f.getTime()-36e5).toISOString(),approvalBy:`审批员-${d%3+1}`,networkType:["公网","内网","混合"][d%3],bandwidth:`${(d%10+1)*100}Mbps`,ipVersion:["IPv4","IPv6","Dual Stack"][d%3],ipSegment:b,createTime:new Date(f.getTime()-72e5).toISOString(),updateTime:f.toISOString()})},300)})}async exportIpAllocationLogs(o){return new Promise(g=>{setTimeout(()=>{g({success:!0,message:"导出成功",url:"#"})},1e3)})}async getIpPools(){return new Promise(o=>{setTimeout(()=>{o([{id:"POOL0001",name:"电信骨干网-BGP"},{id:"POOL0002",name:"联通骨干网-BGP"},{id:"POOL0003",name:"移动骨干网-BGP"},{id:"POOL0004",name:"国际线路-香港"},{id:"POOL0005",name:"国际线路-新加坡"},{id:"POOL0006",name:"Anycast全球加速"}])},200)})}}const $=new de,pe={class:"ip-allocation-log-page"},ce={class:"log-header"},ue={class:"header-actions"},me={class:"search-bar"},Ie={class:"pagination-container"},ge={__name:"IpAllocationLog",setup(j){const o=w(!1),g=w(1),d=w(10),O=w(0),S=w([]),f=w(!1),i=w(null),y=w([]),s=G({ipAddress:"",instanceId:"",customerId:"",dateRange:null}),P=G({operationType:null,ipPoolId:null}),c=G({prop:"operationTime",order:"descending"}),n=async()=>{o.value=!0;try{const l={ipAddress:s.ipAddress,instanceId:s.instanceId,customerId:s.customerId,dateRange:s.dateRange,operationType:P.operationType,ipPoolId:P.ipPoolId,pageNum:g.value,pageSize:d.value,sortField:c.prop,sortOrder:c.order},e=await $.queryIpAllocationLogs(l);S.value=e.records,O.value=e.total}catch(l){console.error("获取IP分配历史数据失败",l),U.error("获取数据失败，请稍后重试")}finally{o.value=!1}},m=async()=>{try{const l=await $.getIpPools();y.value=l.map(e=>({text:e.name,value:e.id}))}catch(l){console.error("获取过滤选项失败",l)}},b=()=>{g.value=1,n()},h=()=>{s.ipAddress="",s.instanceId="",s.customerId="",s.dateRange=null,P.operationType=null,P.ipPoolId=null,g.value=1,n()},v=l=>{s[l]=""},C=()=>{n()},A=async()=>{try{o.value=!0;const l={ipAddress:s.ipAddress,instanceId:s.instanceId,customerId:s.customerId,dateRange:s.dateRange,operationType:P.operationType,ipPoolId:P.ipPoolId},e=await $.exportIpAllocationLogs(l);e.success?U.success("导出成功"):U.error(e.message||"导出失败")}catch(l){console.error("导出数据失败",l),U.error("导出失败，请稍后重试")}finally{o.value=!1}},k=l=>{d.value=l,n()},q=l=>{g.value=l,n()},M=({prop:l,order:e})=>{l&&(c.prop=l,c.order=e,n())},D=l=>{l.operationType?this.filters.operationType=l.operationType[0]:this.filters.operationType=null,l.ipPoolId?this.filters.ipPoolId=l.ipPoolId[0]:this.filters.ipPoolId=null,g.value=1,n()},R=async l=>{o.value=!0;try{const e=await $.getIpAllocationLogDetail(l.id);i.value=e,f.value=!0}catch(e){console.error("获取详情失败",e),U.error("获取详情失败，请稍后重试")}finally{o.value=!1}},N=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-";return te(()=>{m(),n()}),(l,e)=>{const V=T("el-icon"),L=T("el-button"),B=T("el-input"),Q=T("el-date-picker"),_=T("el-table-column"),z=T("el-tag"),H=T("el-table"),J=T("el-pagination"),K=T("el-card"),I=T("el-descriptions-item"),X=T("el-descriptions"),Y=T("el-drawer"),Z=se("loading");return F(),ae("div",pe,[t(K,{class:"log-card"},{default:a(()=>[x("div",ce,[e[12]||(e[12]=x("h3",null,"IP分配历史",-1)),x("div",ue,[t(L,{type:"primary",onClick:C},{default:a(()=>[t(V,null,{default:a(()=>[t(E(le))]),_:1}),e[10]||(e[10]=r(" 刷新 "))]),_:1,__:[10]}),t(L,{type:"success",onClick:A},{default:a(()=>[t(V,null,{default:a(()=>[t(E(ne))]),_:1}),e[11]||(e[11]=r(" 导出 "))]),_:1,__:[11]})])]),x("div",me,[t(B,{modelValue:s.ipAddress,"onUpdate:modelValue":e[0]||(e[0]=p=>s.ipAddress=p),placeholder:"IP地址",style:{width:"180px"},clearable:"",onClear:e[1]||(e[1]=p=>v("ipAddress"))},{prefix:a(()=>[t(V,null,{default:a(()=>[t(E(ie))]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:s.instanceId,"onUpdate:modelValue":e[2]||(e[2]=p=>s.instanceId=p),placeholder:"业务实例ID/名称",style:{width:"180px","margin-left":"10px"},clearable:"",onClear:e[3]||(e[3]=p=>v("instanceId"))},null,8,["modelValue"]),t(B,{modelValue:s.customerId,"onUpdate:modelValue":e[4]||(e[4]=p=>s.customerId=p),placeholder:"客户ID/名称",style:{width:"180px","margin-left":"10px"},clearable:"",onClear:e[5]||(e[5]=p=>v("customerId"))},null,8,["modelValue"]),t(Q,{modelValue:s.dateRange,"onUpdate:modelValue":e[6]||(e[6]=p=>s.dateRange=p),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-left":"10px",width:"320px"}},null,8,["modelValue"]),t(L,{type:"primary",onClick:b,style:{"margin-left":"10px"}},{default:a(()=>e[13]||(e[13]=[r("搜索")])),_:1,__:[13]}),t(L,{onClick:h},{default:a(()=>e[14]||(e[14]=[r("重置")])),_:1,__:[14]})]),oe((F(),W(H,{data:S.value,style:{width:"100%","margin-top":"15px"},border:"",stripe:"",size:"small",onSortChange:M,onFilterChange:D},{default:a(()=>[t(_,{prop:"ipAddress",label:"IP地址","min-width":"120",sortable:"custom"}),t(_,{prop:"instanceName",label:"业务实例","min-width":"120","show-overflow-tooltip":""}),t(_,{prop:"customerName",label:"客户","min-width":"120","show-overflow-tooltip":""}),t(_,{prop:"operationType",label:"操作类型",width:"100",filters:[{text:"分配",value:"allocate"},{text:"回收",value:"reclaim"}],"column-key":"operationType"},{default:a(p=>[t(z,{type:p.row.operationType==="allocate"?"success":"danger",size:"small"},{default:a(()=>[r(u(p.row.operationType==="allocate"?"分配":"回收"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"operationTime",label:"操作时间","min-width":"180",sortable:"custom"},{default:a(p=>[r(u(N(p.row.operationTime)),1)]),_:1}),t(_,{prop:"operatorName",label:"操作人",width:"100"}),t(_,{prop:"ipPoolName",label:"IP池",width:"120",filters:y.value,"column-key":"ipPoolId"},null,8,["filters"]),t(_,{prop:"ipSegment",label:"IP段","min-width":"120","show-overflow-tooltip":""}),t(_,{label:"操作",fixed:"right",width:"80"},{default:a(p=>[t(L,{link:"",type:"primary",onClick:fe=>R(p.row),size:"small"},{default:a(()=>e[15]||(e[15]=[r(" 详情 ")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,o.value]]),x("div",Ie,[t(J,{"current-page":g.value,"onUpdate:currentPage":e[7]||(e[7]=p=>g.value=p),"page-size":d.value,"onUpdate:pageSize":e[8]||(e[8]=p=>d.value=p),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:O.value,onSizeChange:k,onCurrentChange:q,small:""},null,8,["current-page","page-size","total"])])]),_:1}),t(Y,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=p=>f.value=p),title:"IP分配历史详情",direction:"rtl",size:"500px","destroy-on-close":!0},{default:a(()=>[i.value?(F(),W(X,{key:0,column:1,border:"",style:{padding:"0 20px"}},{default:a(()=>[t(I,{label:"IP地址"},{default:a(()=>[r(u(i.value.ipAddress),1)]),_:1}),t(I,{label:"IP段"},{default:a(()=>[r(u(i.value.ipSegment),1)]),_:1}),t(I,{label:"业务实例"},{default:a(()=>[r(u(i.value.instanceId)+" / "+u(i.value.instanceName),1)]),_:1}),t(I,{label:"客户"},{default:a(()=>[r(u(i.value.customerId)+" / "+u(i.value.customerName),1)]),_:1}),t(I,{label:"操作类型"},{default:a(()=>[t(z,{type:i.value.operationType==="allocate"?"success":"danger"},{default:a(()=>[r(u(i.value.operationType==="allocate"?"分配":"回收"),1)]),_:1},8,["type"])]),_:1}),t(I,{label:"操作时间"},{default:a(()=>[r(u(N(i.value.operationTime)),1)]),_:1}),t(I,{label:"操作人"},{default:a(()=>[r(u(i.value.operatorName),1)]),_:1}),t(I,{label:"IP池"},{default:a(()=>[r(u(i.value.ipPoolName),1)]),_:1}),t(I,{label:"请求ID"},{default:a(()=>[r(u(i.value.requestId),1)]),_:1}),t(I,{label:"审批状态"},{default:a(()=>[t(z,{type:"success"},{default:a(()=>e[16]||(e[16]=[r("已审批")])),_:1,__:[16]})]),_:1}),t(I,{label:"审批时间"},{default:a(()=>[r(u(N(i.value.approvalTime)),1)]),_:1}),t(I,{label:"审批人"},{default:a(()=>[r(u(i.value.approvalBy),1)]),_:1}),t(I,{label:"网络类型"},{default:a(()=>[r(u(i.value.networkType),1)]),_:1}),t(I,{label:"带宽"},{default:a(()=>[r(u(i.value.bandwidth),1)]),_:1}),t(I,{label:"IP版本"},{default:a(()=>[r(u(i.value.ipVersion),1)]),_:1}),t(I,{label:"创建时间"},{default:a(()=>[r(u(N(i.value.createTime)),1)]),_:1}),t(I,{label:"更新时间"},{default:a(()=>[r(u(N(i.value.updateTime)),1)]),_:1}),t(I,{label:"备注"},{default:a(()=>[r(u(i.value.remark),1)]),_:1})]),_:1})):re("",!0)]),_:1},8,["modelValue"])])}}},ve=ee(ge,[["__scopeId","data-v-e492556c"]]);export{ve as default};
