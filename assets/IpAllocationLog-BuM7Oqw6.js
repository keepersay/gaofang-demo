import{_ as ee,a as w,r as z,o as te,b as ae,d as t,w as a,h as x,i as oe,e as v,k as c,u as G,H as ne,I as le,G as ie,f as se,l as W,t as m,v as re,E as U,g as E}from"./index-BnFkVgmM.js";class de{async queryIpAllocationLogs(o){return new Promise(g=>{setTimeout(()=>{const r=[{id:"CUST0001",name:"阿里云科技有限公司"},{id:"CUST0002",name:"腾讯科技(深圳)有限公司"},{id:"CUST0003",name:"百度在线网络技术(北京)有限公司"},{id:"CUST0004",name:"京东科技控股股份有限公司"},{id:"CUST0005",name:"字节跳动有限公司"},{id:"CUST0006",name:"网易(杭州)网络有限公司"},{id:"CUST0007",name:"华为技术有限公司"},{id:"CUST0008",name:"小米科技有限责任公司"}],O=[{id:"INST000001",name:"电商平台-主站"},{id:"INST000002",name:"视频服务-CDN"},{id:"INST000003",name:"支付系统-核心"},{id:"INST000004",name:"游戏平台-国际版"},{id:"INST000005",name:"企业邮箱-集群1"},{id:"INST000006",name:"云存储-北区"},{id:"INST000007",name:"数据库服务-主节点"},{id:"INST000008",name:"人工智能-推理集群"},{id:"INST000009",name:"直播平台-边缘节点"},{id:"INST000010",name:"物联网-数据中心"}],S=[{id:"POOL0001",name:"电信骨干网-BGP"},{id:"POOL0002",name:"联通骨干网-BGP"},{id:"POOL0003",name:"移动骨干网-BGP"},{id:"POOL0004",name:"国际线路-香港"},{id:"POOL0005",name:"国际线路-新加坡"},{id:"POOL0006",name:"Anycast全球加速"}],f=["103.24.178.0/24","103.24.179.0/24","103.215.32.0/22","116.128.128.0/17","118.26.96.0/21","118.26.104.0/21","118.26.112.0/21","118.26.120.0/21","118.26.128.0/21","119.28.0.0/16","119.29.0.0/16","120.88.56.0/23","121.51.0.0/16","122.152.192.0/18","123.206.0.0/16","129.204.0.0/16","129.211.0.0/16","129.226.0.0/16","2402:4e00::/32","2407:c080::/32"],s=100,{pageNum:y=1,pageSize:i=10}=o,P=[];for(let l=0;l<i;l++){const u=(y-1)*i+l;if(u>=s)break;const h=u%3!==0?"allocate":"reclaim",T=new Date;T.setDate(T.getDate()-u);const C=r[u%r.length],A=O[u%O.length],k=S[u%S.length],D=f[u%f.length].split("/")[0].split("."),R=(parseInt(D[3])+u)%255,N=`${D[0]}.${D[1]}.${D[2]}.${R}`;P.push({id:`IPAL${String(u+1).padStart(6,"0")}`,ipAddress:N,instanceId:A.id,instanceName:A.name,customerId:C.id,customerName:C.name,operationType:h,operationTime:T.toISOString(),operatorId:`USER${String(u%5+1).padStart(4,"0")}`,operatorName:`操作员-${u%5+1}`,ipPoolId:k.id,ipPoolName:k.name,remark:h==="allocate"?`分配IP用于${["Web服务","API服务","数据库服务","缓存服务","负载均衡"][u%5]}`:"回收闲置IP资源"})}let p=[...P];if(o.ipAddress&&(p=p.filter(l=>l.ipAddress.includes(o.ipAddress))),o.instanceId&&(p=p.filter(l=>l.instanceId.includes(o.instanceId)||l.instanceName.includes(o.instanceId))),o.customerId&&(p=p.filter(l=>l.customerId.includes(o.customerId)||l.customerName.includes(o.customerId))),o.operationType&&(p=p.filter(l=>l.operationType===o.operationType)),o.ipPoolId&&(p=p.filter(l=>l.ipPoolId===o.ipPoolId)),o.dateRange&&o.dateRange.length===2){const l=new Date(o.dateRange[0]),u=new Date(o.dateRange[1]);p=p.filter(b=>{const h=new Date(b.operationTime);return h>=l&&h<=u})}g({records:p,total:Math.min(s,p.length),pageNum:y,pageSize:i})},500)})}async getIpAllocationLogDetail(o){return new Promise(g=>{setTimeout(()=>{const r=parseInt(o.replace("IPAL",""))-1,S=r%3!==0?"allocate":"reclaim",f=new Date;f.setDate(f.getDate()-r);const s=[{id:"CUST0001",name:"阿里云科技有限公司"},{id:"CUST0002",name:"腾讯科技(深圳)有限公司"},{id:"CUST0003",name:"百度在线网络技术(北京)有限公司"},{id:"CUST0004",name:"京东科技控股股份有限公司"},{id:"CUST0005",name:"字节跳动有限公司"},{id:"CUST0006",name:"网易(杭州)网络有限公司"},{id:"CUST0007",name:"华为技术有限公司"},{id:"CUST0008",name:"小米科技有限责任公司"}],y=[{id:"INST000001",name:"电商平台-主站"},{id:"INST000002",name:"视频服务-CDN"},{id:"INST000003",name:"支付系统-核心"},{id:"INST000004",name:"游戏平台-国际版"},{id:"INST000005",name:"企业邮箱-集群1"},{id:"INST000006",name:"云存储-北区"},{id:"INST000007",name:"数据库服务-主节点"},{id:"INST000008",name:"人工智能-推理集群"},{id:"INST000009",name:"直播平台-边缘节点"},{id:"INST000010",name:"物联网-数据中心"}],i=[{id:"POOL0001",name:"电信骨干网-BGP"},{id:"POOL0002",name:"联通骨干网-BGP"},{id:"POOL0003",name:"移动骨干网-BGP"},{id:"POOL0004",name:"国际线路-香港"},{id:"POOL0005",name:"国际线路-新加坡"},{id:"POOL0006",name:"Anycast全球加速"}],P=["103.24.178.0/24","103.24.179.0/24","103.215.32.0/22","116.128.128.0/17","118.26.96.0/21","118.26.104.0/21"],p=s[r%s.length],l=y[r%y.length],u=i[r%i.length],b=P[r%P.length],T=b.split("/")[0].split("."),C=(parseInt(T[3])+r)%255,A=`${T[0]}.${T[1]}.${T[2]}.${C}`;g({id:o,ipAddress:A,instanceId:l.id,instanceName:l.name,customerId:p.id,customerName:p.name,operationType:S,operationTime:f.toISOString(),operatorId:`USER${String(r%5+1).padStart(4,"0")}`,operatorName:`操作员-${r%5+1}`,ipPoolId:u.id,ipPoolName:u.name,remark:S==="allocate"?`分配IP用于${["Web服务","API服务","数据库服务","缓存服务","负载均衡"][r%5]}`:"回收闲置IP资源",requestId:`REQ${String(r+1e3).padStart(8,"0")}`,approvalStatus:"approved",approvalTime:new Date(f.getTime()-36e5).toISOString(),approvalBy:`审批员-${r%3+1}`,networkType:["公网","内网","混合"][r%3],bandwidth:`${(r%10+1)*100}Mbps`,ipVersion:["IPv4","IPv6","Dual Stack"][r%3],ipSegment:b,createTime:new Date(f.getTime()-72e5).toISOString(),updateTime:f.toISOString()})},300)})}async exportIpAllocationLogs(o){return new Promise(g=>{setTimeout(()=>{g({success:!0,message:"导出成功",url:"#"})},1e3)})}async getIpPools(){return new Promise(o=>{setTimeout(()=>{o([{id:"POOL0001",name:"电信骨干网-BGP"},{id:"POOL0002",name:"联通骨干网-BGP"},{id:"POOL0003",name:"移动骨干网-BGP"},{id:"POOL0004",name:"国际线路-香港"},{id:"POOL0005",name:"国际线路-新加坡"},{id:"POOL0006",name:"Anycast全球加速"}])},200)})}}const $=new de,pe={class:"ip-allocation-log-page"},ce={class:"log-header"},ue={class:"header-actions"},me={class:"search-bar"},Ie={class:"pagination-container"},ge={__name:"IpAllocationLog",setup(j){const o=w(!1),g=w(1),r=w(10),O=w(0),S=w([]),f=w(!1),s=w(null),y=w([]),i=z({ipAddress:"",instanceId:"",customerId:"",dateRange:null}),P=z({operationType:null,ipPoolId:null}),p=z({prop:"operationTime",order:"descending"}),l=async()=>{o.value=!0;try{const n={ipAddress:i.ipAddress,instanceId:i.instanceId,customerId:i.customerId,dateRange:i.dateRange,operationType:P.operationType,ipPoolId:P.ipPoolId,pageNum:g.value,pageSize:r.value,sortField:p.prop,sortOrder:p.order},e=await $.queryIpAllocationLogs(n);S.value=e.records,O.value=e.total}catch(n){console.error("获取IP分配历史数据失败",n),U.error("获取数据失败，请稍后重试")}finally{o.value=!1}},u=async()=>{try{const n=await $.getIpPools();y.value=n.map(e=>({text:e.name,value:e.id}))}catch(n){console.error("获取过滤选项失败",n)}},b=()=>{g.value=1,l()},h=()=>{i.ipAddress="",i.instanceId="",i.customerId="",i.dateRange=null,P.operationType=null,P.ipPoolId=null,g.value=1,l()},T=n=>{i[n]=""},C=()=>{l()},A=async()=>{try{o.value=!0;const n={ipAddress:i.ipAddress,instanceId:i.instanceId,customerId:i.customerId,dateRange:i.dateRange,operationType:P.operationType,ipPoolId:P.ipPoolId},e=await $.exportIpAllocationLogs(n);e.success?U.success("导出成功"):U.error(e.message||"导出失败")}catch(n){console.error("导出数据失败",n),U.error("导出失败，请稍后重试")}finally{o.value=!1}},k=n=>{r.value=n,l()},F=n=>{g.value=n,l()},q=({prop:n,order:e})=>{n&&(p.prop=n,p.order=e,l())},D=n=>{n.operationType?this.filters.operationType=n.operationType[0]:this.filters.operationType=null,n.ipPoolId?this.filters.ipPoolId=n.ipPoolId[0]:this.filters.ipPoolId=null,g.value=1,l()},R=async n=>{o.value=!0;try{const e=await $.getIpAllocationLogDetail(n.id);s.value=e,f.value=!0}catch(e){console.error("获取详情失败",e),U.error("获取详情失败，请稍后重试")}finally{o.value=!1}},N=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-";return te(()=>{u(),l()}),(n,e)=>{const V=v("el-icon"),L=v("el-button"),B=v("el-input"),H=v("el-date-picker"),_=v("el-table-column"),M=v("el-tag"),Q=v("el-table"),J=v("el-pagination"),K=v("el-card"),I=v("el-descriptions-item"),X=v("el-descriptions"),Y=v("el-drawer"),Z=se("loading");return E(),ae("div",pe,[t(K,{class:"log-card"},{default:a(()=>[x("div",ce,[e[12]||(e[12]=x("h3",null,"IP分配历史",-1)),x("div",ue,[t(L,{type:"primary",onClick:C},{default:a(()=>[t(V,null,{default:a(()=>[t(G(ne))]),_:1}),e[10]||(e[10]=c(" 刷新 "))]),_:1,__:[10]}),t(L,{type:"success",onClick:A},{default:a(()=>[t(V,null,{default:a(()=>[t(G(le))]),_:1}),e[11]||(e[11]=c(" 导出 "))]),_:1,__:[11]})])]),x("div",me,[t(B,{modelValue:i.ipAddress,"onUpdate:modelValue":e[0]||(e[0]=d=>i.ipAddress=d),placeholder:"IP地址",style:{width:"180px"},clearable:"",onClear:e[1]||(e[1]=d=>T("ipAddress"))},{prefix:a(()=>[t(V,null,{default:a(()=>[t(G(ie))]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:i.instanceId,"onUpdate:modelValue":e[2]||(e[2]=d=>i.instanceId=d),placeholder:"业务实例ID/名称",style:{width:"180px","margin-left":"10px"},clearable:"",onClear:e[3]||(e[3]=d=>T("instanceId"))},null,8,["modelValue"]),t(B,{modelValue:i.customerId,"onUpdate:modelValue":e[4]||(e[4]=d=>i.customerId=d),placeholder:"客户ID/名称",style:{width:"180px","margin-left":"10px"},clearable:"",onClear:e[5]||(e[5]=d=>T("customerId"))},null,8,["modelValue"]),t(H,{modelValue:i.dateRange,"onUpdate:modelValue":e[6]||(e[6]=d=>i.dateRange=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-left":"10px",width:"320px"}},null,8,["modelValue"]),t(L,{type:"primary",onClick:b,style:{"margin-left":"10px"}},{default:a(()=>e[13]||(e[13]=[c("搜索")])),_:1,__:[13]}),t(L,{onClick:h},{default:a(()=>e[14]||(e[14]=[c("重置")])),_:1,__:[14]})]),oe((E(),W(Q,{data:S.value,style:{width:"100%","margin-top":"15px"},border:"",stripe:"",size:"small",onSortChange:q,onFilterChange:D},{default:a(()=>[t(_,{prop:"ipAddress",label:"IP地址","min-width":"120",sortable:"custom"}),t(_,{prop:"instanceName",label:"业务实例","min-width":"120","show-overflow-tooltip":""}),t(_,{prop:"customerName",label:"客户","min-width":"120","show-overflow-tooltip":""}),t(_,{prop:"operationType",label:"操作类型",width:"100",filters:[{text:"分配",value:"allocate"},{text:"回收",value:"reclaim"}],"column-key":"operationType"},{default:a(d=>[t(M,{type:d.row.operationType==="allocate"?"success":"danger",size:"small"},{default:a(()=>[c(m(d.row.operationType==="allocate"?"分配":"回收"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"operationTime",label:"操作时间","min-width":"180",sortable:"custom"},{default:a(d=>[c(m(N(d.row.operationTime)),1)]),_:1}),t(_,{prop:"operatorName",label:"操作人",width:"100"}),t(_,{prop:"ipPoolName",label:"IP池",width:"120",filters:y.value,"column-key":"ipPoolId"},null,8,["filters"]),t(_,{prop:"ipSegment",label:"IP段","min-width":"120","show-overflow-tooltip":""}),t(_,{label:"操作",fixed:"right",width:"80"},{default:a(d=>[t(L,{link:"",type:"primary",onClick:fe=>R(d.row),size:"small"},{default:a(()=>e[15]||(e[15]=[c(" 详情 ")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,o.value]]),x("div",Ie,[t(J,{"current-page":g.value,"onUpdate:currentPage":e[7]||(e[7]=d=>g.value=d),"page-size":r.value,"onUpdate:pageSize":e[8]||(e[8]=d=>r.value=d),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:O.value,onSizeChange:k,onCurrentChange:F,small:""},null,8,["current-page","page-size","total"])])]),_:1}),t(Y,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=d=>f.value=d),title:"IP分配历史详情",direction:"rtl",size:"500px","destroy-on-close":!0},{default:a(()=>[s.value?(E(),W(X,{key:0,column:1,border:"",style:{padding:"0 20px"}},{default:a(()=>[t(I,{label:"IP地址"},{default:a(()=>[c(m(s.value.ipAddress),1)]),_:1}),t(I,{label:"IP段"},{default:a(()=>[c(m(s.value.ipSegment),1)]),_:1}),t(I,{label:"业务实例"},{default:a(()=>[c(m(s.value.instanceId)+" / "+m(s.value.instanceName),1)]),_:1}),t(I,{label:"客户"},{default:a(()=>[c(m(s.value.customerId)+" / "+m(s.value.customerName),1)]),_:1}),t(I,{label:"操作类型"},{default:a(()=>[t(M,{type:s.value.operationType==="allocate"?"success":"danger"},{default:a(()=>[c(m(s.value.operationType==="allocate"?"分配":"回收"),1)]),_:1},8,["type"])]),_:1}),t(I,{label:"操作时间"},{default:a(()=>[c(m(N(s.value.operationTime)),1)]),_:1}),t(I,{label:"操作人"},{default:a(()=>[c(m(s.value.operatorName),1)]),_:1}),t(I,{label:"IP池"},{default:a(()=>[c(m(s.value.ipPoolName),1)]),_:1}),t(I,{label:"请求ID"},{default:a(()=>[c(m(s.value.requestId),1)]),_:1}),t(I,{label:"审批时间"},{default:a(()=>[c(m(N(s.value.approvalTime)),1)]),_:1}),t(I,{label:"审批人"},{default:a(()=>[c(m(s.value.approvalBy),1)]),_:1}),t(I,{label:"网络类型"},{default:a(()=>[c(m(s.value.networkType),1)]),_:1}),t(I,{label:"创建时间"},{default:a(()=>[c(m(N(s.value.createTime)),1)]),_:1}),t(I,{label:"更新时间"},{default:a(()=>[c(m(N(s.value.updateTime)),1)]),_:1}),t(I,{label:"备注"},{default:a(()=>[c(m(s.value.remark),1)]),_:1})]),_:1})):re("",!0)]),_:1},8,["modelValue"])])}}},Te=ee(ge,[["__scopeId","data-v-eb8290da"]]);export{Te as default};
