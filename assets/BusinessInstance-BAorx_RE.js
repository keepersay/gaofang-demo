import{_ as fe,c as pe,a as P,r as ce,n as de,e as p,l as C,g,w as a,d as e,h as m,i as J,b as q,F as ie,p as ue,t as B,z as se,v as $,k as i,B as L,E as v,A as me,f as _e,o as Ie,j as be,u as Pe,G as ke,q as we}from"./index-C3RWE1cf.js";const Ve={style:{color:"#999"}},Ce={style:{"margin-top":"20px",display:"flex","justify-content":"space-between"}},De={__name:"BusinessInstanceModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(M,{emit:Y}){const I=M,W=Y,h=pe({get:()=>I.modelValue,set:u=>W("update:modelValue",u)}),A=P(null),_=P(0),t=ce({instanceName:"",customerId:"",customerName:"",orderId:"",packageId:"",packageName:"",packageType:1,isAnycast:!1,addressType:"IPv4",regionId:"",adsProtection:!0,ccProtection:!1,wafProtection:!1,bandwidth:100,businessBandwidth:50,qps:1e3,protectionIpCount:1,domainCount:10,portCount:10,status:"active",remark:""}),b={instanceName:[{required:!0,message:"请输入业务实例名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"change"}],orderId:[{required:!0,message:"请选择关联订单",trigger:"change"}],addressType:[{required:!0,message:"请选择地址类型",trigger:"change"}],regionId:[{required:!0,message:"请选择地域",trigger:"change"}],status:[{required:!0,message:"请选择实例状态",trigger:"change"}]},D=P([]),f=P([]),k=P([]),T=()=>{t.instanceName="",t.customerId="",t.customerName="",t.orderId="",t.packageId="",t.packageName="",t.packageType=1,t.isAnycast=!1,t.addressType="IPv4",t.regionId="",t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1,t.bandwidth=100,t.businessBandwidth=50,t.qps=1e3,t.protectionIpCount=1,t.domainCount=10,t.portCount=10,t.status="active",t.remark=""};de(()=>I.instanceData,u=>{u?(Object.keys(t).forEach(l=>{u[l]!==void 0&&(t[l]=u[l])}),u.packageName&&(u.packageName==="DDOS防护"?(t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1,t.packageType=1):u.packageName==="WAF标准防护"?(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!1,t.packageType=2):u.packageName==="WAF增强防护"&&(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!0,t.packageType=3)),S()):T()},{immediate:!0,deep:!0}),de(()=>h.value,u=>{u&&(_.value=0,me(()=>{z(),K()}))});const z=async()=>{try{D.value=[{customerId:"CUST1001",customerName:"北京科技有限公司"},{customerId:"CUST1002",customerName:"上海网络科技有限公司"},{customerId:"CUST1003",customerName:"广州信息技术有限公司"},{customerId:"CUST1004",customerName:"深圳互联网有限公司"},{customerId:"CUST1005",customerName:"杭州数字科技有限公司"}]}catch(u){console.error("获取客户列表失败:",u)}},S=async()=>{try{const u=new URLSearchParams;t.customerId&&u.append("customerId",t.customerId);const l=await L.getAvailableOrders({customerId:t.customerId});l.code===200&&(f.value=l.data)}catch(u){console.error("获取订单列表失败:",u)}},K=async()=>{try{k.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(u){console.error("获取地域列表失败:",u)}},X=u=>{t.orderId="";const l=D.value.find(O=>O.customerId===u);l&&(t.customerName=l.customerName),S()},Z=u=>{const l=f.value.find(O=>O.orderId===u);l&&(t.packageName=l.packageName,l.packageName==="DDOS防护"?(t.packageType=1,t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1):l.packageName==="WAF标准防护"?(t.packageType=2,t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!1):l.packageName==="WAF增强防护"&&(t.packageType=3,t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!0))},ee=()=>{_.value>0&&_.value--},te=async()=>{if(_.value===0)try{await A.value.validateField(["instanceName","customerId","orderId"]),_.value++}catch(u){console.error(u)}else if(_.value===1)try{await A.value.validateField(["addressType"]),t.isAnycast||await A.value.validateField(["regionId"]),_.value++}catch(u){console.error(u)}else _.value<4&&_.value++},ae=()=>{h.value=!1,T()},le=async()=>{try{await A.value.validate();const u={...t};t.wafProtection&&t.ccProtection&&t.adsProtection?u.packageName="WAF增强防护":t.ccProtection&&t.adsProtection?u.packageName="WAF标准防护":u.packageName="DDOS防护",u.isAnycast&&(u.regionId="");let l;I.isEdit?l=await L.updateBusinessInstance(I.instanceData.instanceId,u):l=await L.createBusinessInstance(u),l.code===200?(v.success(I.isEdit?"修改成功":"创建成功"),h.value=!1,W("success")):v.error(l.message||(I.isEdit?"修改失败":"创建失败"))}catch(u){console.error("表单验证失败:",u)}},ne=u=>{u===1?(t.adsProtection=!0,t.ccProtection=!1,t.wafProtection=!1):u===2?(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!1):u===3&&(t.adsProtection=!0,t.ccProtection=!0,t.wafProtection=!0)};return(u,l)=>{const O=p("el-step"),d=p("el-steps"),o=p("el-input"),y=p("el-form-item"),w=p("el-option"),F=p("el-select"),G=p("el-switch"),R=p("el-radio"),s=p("el-radio-group"),n=p("el-alert"),N=p("el-tag"),U=p("el-input-number"),Q=p("el-form"),E=p("el-button"),H=p("el-dialog");return g(),C(H,{modelValue:h.value,"onUpdate:modelValue":l[15]||(l[15]=r=>h.value=r),title:M.isEdit?"修改业务实例":"新增业务实例",width:"60%","destroy-on-close":""},{default:a(()=>[e(d,{active:_.value,"finish-status":"success",simple:"",style:{"margin-bottom":"20px"}},{default:a(()=>[e(O,{title:"基本信息"}),e(O,{title:"部署配置"}),e(O,{title:"防护选项"}),e(O,{title:"资源配置"}),e(O,{title:"状态与备注"})]),_:1},8,["active"]),e(Q,{ref_key:"formRef",ref:A,model:t,rules:b,"label-width":"120px",style:{"max-height":"500px","overflow-y":"auto"}},{default:a(()=>[J(m("div",null,[e(y,{label:"业务实例名称",prop:"instanceName"},{default:a(()=>[e(o,{modelValue:t.instanceName,"onUpdate:modelValue":l[0]||(l[0]=r=>t.instanceName=r),placeholder:"请输入业务实例名称"},null,8,["modelValue"])]),_:1}),e(y,{label:"客户",prop:"customerId"},{default:a(()=>[e(F,{modelValue:t.customerId,"onUpdate:modelValue":l[1]||(l[1]=r=>t.customerId=r),placeholder:"请选择客户",filterable:"",style:{width:"100%"},onChange:X},{default:a(()=>[(g(!0),q(ie,null,ue(D.value,r=>(g(),C(w,{key:r.customerId,label:r.customerName,value:r.customerId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"关联订单",prop:"orderId"},{default:a(()=>[e(F,{modelValue:t.orderId,"onUpdate:modelValue":l[2]||(l[2]=r=>t.orderId=r),placeholder:"请选择关联订单",filterable:"",style:{width:"100%"},disabled:!t.customerId,onChange:Z},{default:a(()=>[(g(!0),q(ie,null,ue(f.value,r=>(g(),C(w,{key:r.orderId,label:r.orderId,value:r.orderId},{default:a(()=>[m("div",null,[m("div",null,B(r.orderId),1),m("small",Ve,B(r.packageName),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})],512),[[se,_.value===0]]),J(m("div",null,[e(y,{label:"Anycast",prop:"isAnycast"},{default:a(()=>[e(G,{modelValue:t.isAnycast,"onUpdate:modelValue":l[3]||(l[3]=r=>t.isAnycast=r)},null,8,["modelValue"])]),_:1}),e(y,{label:"地址类型",prop:"addressType"},{default:a(()=>[e(s,{modelValue:t.addressType,"onUpdate:modelValue":l[4]||(l[4]=r=>t.addressType=r)},{default:a(()=>[e(R,{label:"IPv4"},{default:a(()=>l[16]||(l[16]=[i("IPv4")])),_:1,__:[16]}),e(R,{label:"IPv6"},{default:a(()=>l[17]||(l[17]=[i("IPv6")])),_:1,__:[17]}),e(R,{label:"dual"},{default:a(()=>l[18]||(l[18]=[i("双栈")])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1}),t.isAnycast?$("",!0):(g(),C(y,{key:0,label:"地域",prop:"regionId"},{default:a(()=>[e(F,{modelValue:t.regionId,"onUpdate:modelValue":l[5]||(l[5]=r=>t.regionId=r),placeholder:"请选择地域",style:{width:"100%"}},{default:a(()=>[(g(!0),q(ie,null,ue(k.value,r=>(g(),C(w,{key:r.regionId,label:r.regionName,value:r.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}))],512),[[se,_.value===1]]),J(m("div",null,[e(n,{title:"防护配置与套餐对应关系",type:"info",description:"ADS防护 -> DDOS防护；ADS防护+CC防护 -> WAF标准防护；ADS防护+CC防护+WAF防护 -> WAF增强防护",closable:!1,style:{"margin-bottom":"20px"}}),e(y,{label:"套餐选择",prop:"packageType"},{default:a(()=>[e(s,{modelValue:t.packageType,"onUpdate:modelValue":l[6]||(l[6]=r=>t.packageType=r),onChange:ne},{default:a(()=>[e(R,{label:1},{default:a(()=>l[19]||(l[19]=[i("DDOS防护（仅ADS防护）")])),_:1,__:[19]}),e(R,{label:2},{default:a(()=>l[20]||(l[20]=[i("WAF标准防护（ADS+CC防护）")])),_:1,__:[20]}),e(R,{label:3},{default:a(()=>l[21]||(l[21]=[i("WAF增强防护（ADS+CC+WAF防护）")])),_:1,__:[21]})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"防护内容"},{default:a(()=>[t.adsProtection?(g(),C(N,{key:0,type:"success",style:{"margin-right":"5px"}},{default:a(()=>l[22]||(l[22]=[i("ADS防护")])),_:1,__:[22]})):$("",!0),t.ccProtection?(g(),C(N,{key:1,type:"warning",style:{"margin-right":"5px"}},{default:a(()=>l[23]||(l[23]=[i("CC防护")])),_:1,__:[23]})):$("",!0),t.wafProtection?(g(),C(N,{key:2,type:"danger"},{default:a(()=>l[24]||(l[24]=[i("WAF防护")])),_:1,__:[24]})):$("",!0)]),_:1})],512),[[se,_.value===2]]),J(m("div",null,[e(y,{label:"防护带宽(Mbps)",prop:"bandwidth"},{default:a(()=>[e(U,{modelValue:t.bandwidth,"onUpdate:modelValue":l[7]||(l[7]=r=>t.bandwidth=r),min:1,max:1e4},null,8,["modelValue"])]),_:1}),e(y,{label:"业务带宽(Mbps)",prop:"businessBandwidth"},{default:a(()=>[e(U,{modelValue:t.businessBandwidth,"onUpdate:modelValue":l[8]||(l[8]=r=>t.businessBandwidth=r),min:1,max:5e3},null,8,["modelValue"])]),_:1}),e(y,{label:"业务QPS",prop:"qps"},{default:a(()=>[e(U,{modelValue:t.qps,"onUpdate:modelValue":l[9]||(l[9]=r=>t.qps=r),min:1,max:1e5},null,8,["modelValue"])]),_:1}),e(y,{label:"防护IP数",prop:"protectionIpCount"},{default:a(()=>[e(U,{modelValue:t.protectionIpCount,"onUpdate:modelValue":l[10]||(l[10]=r=>t.protectionIpCount=r),min:1,max:100},null,8,["modelValue"])]),_:1}),e(y,{label:"防护域名数",prop:"domainCount"},{default:a(()=>[e(U,{modelValue:t.domainCount,"onUpdate:modelValue":l[11]||(l[11]=r=>t.domainCount=r),min:1,max:1e3},null,8,["modelValue"])]),_:1}),e(y,{label:"端口数量",prop:"portCount"},{default:a(()=>[e(U,{modelValue:t.portCount,"onUpdate:modelValue":l[12]||(l[12]=r=>t.portCount=r),min:1,max:100},null,8,["modelValue"])]),_:1})],512),[[se,_.value===3]]),J(m("div",null,[e(y,{label:"实例状态",prop:"status"},{default:a(()=>[e(s,{modelValue:t.status,"onUpdate:modelValue":l[13]||(l[13]=r=>t.status=r)},{default:a(()=>[e(R,{label:"active"},{default:a(()=>l[25]||(l[25]=[i("启用")])),_:1,__:[25]}),e(R,{label:"inactive"},{default:a(()=>l[26]||(l[26]=[i("禁用")])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"备注",prop:"remark"},{default:a(()=>[e(o,{modelValue:t.remark,"onUpdate:modelValue":l[14]||(l[14]=r=>t.remark=r),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})],512),[[se,_.value===4]])]),_:1},8,["model"]),m("div",Ce,[m("div",null,[_.value>0?(g(),C(E,{key:0,onClick:ee},{default:a(()=>l[27]||(l[27]=[i("上一步")])),_:1,__:[27]})):$("",!0)]),m("div",null,[e(E,{onClick:ae},{default:a(()=>l[28]||(l[28]=[i("取消")])),_:1,__:[28]}),_.value<4?(g(),C(E,{key:0,type:"primary",onClick:te},{default:a(()=>l[29]||(l[29]=[i("下一步")])),_:1,__:[29]})):(g(),C(E,{key:1,type:"primary",onClick:le},{default:a(()=>l[30]||(l[30]=[i("提交")])),_:1,__:[30]}))])])]),_:1},8,["modelValue","title"])}}},Ne=fe(De,[["__scopeId","data-v-268b0618"]]),xe={key:0},Ae={class:"info-section"},Te={class:"info-item"},he={class:"info-item"},Se={class:"info-item"},Ue={class:"info-item"},Be={class:"info-item"},Fe={key:0},$e={class:"allocation-options"},ze={key:2,class:"allocation-form"},Oe={key:3,class:"allocation-form"},Me={key:0,class:"table-footer"},Re={key:0,class:"error-tip"},Ee={key:4,class:"allocation-form"},qe={class:"dialog-footer"},We={__name:"IpAllocationModal",props:{modelValue:{type:Boolean,default:!1},instanceData:{type:Object,default:null}},emits:["update:modelValue","success"],setup(M,{emit:Y}){const I=M,W=Y,h=pe({get:()=>I.modelValue,set:d=>W("update:modelValue",d)}),A=P(!1),_=P("auto"),t=P([]),b=P([]),D=P([]),f=P([]),k=P({count:1}),T=P({ipType:"IPv4",regionId:""}),z=P({ip:""}),S=pe(()=>{if(!I.instanceData)return 0;const d=I.instanceData.protectionIpCount||0,o=f.value.length;return Math.max(0,d-o)}),K=()=>{I.instanceData&&I.instanceData.protectionIps?f.value=Array.isArray(I.instanceData.protectionIps)?I.instanceData.protectionIps.map(d=>typeof d=="object"&&d!==null?d:{ip:d}):[]:f.value=[],_.value="auto",t.value=[],b.value=[],k.value={count:1},T.value={ipType:"IPv4",regionId:""},z.value={ip:""}};de(()=>I.instanceData,d=>{d&&me(()=>{K()})},{immediate:!0}),de(()=>h.value,d=>{d&&me(()=>{K(),Z()})});const X=()=>{h.value=!1,f.value=[]},Z=async()=>{try{D.value=[{regionId:"cn-beijing",regionName:"华北-北京"},{regionId:"cn-shanghai",regionName:"华东-上海"},{regionId:"cn-guangzhou",regionName:"华南-广州"},{regionId:"cn-hangzhou",regionName:"华东-杭州"},{regionId:"cn-shenzhen",regionName:"华南-深圳"}]}catch(d){console.error("获取地域列表失败:",d)}},ee=async()=>{if(!T.value.ipType){v.warning("请选择IP类型");return}if(!I.instanceData.isAnycast&&!T.value.regionId){v.warning("请选择地域");return}A.value=!0;try{const d=await L.getAvailableProtectionIps();d.code===200?(b.value=d.data.filter(o=>!(o.type!==T.value.ipType||I.instanceData.isAnycast!==o.isAnycast||!I.instanceData.isAnycast&&T.value.regionId&&o.region!==T.value.regionId||f.value.some(y=>y.ip===o.ip))),t.value=[]):v.error(d.message||"获取可用IP失败")}catch(d){console.error("获取可用IP列表失败:",d),v.error("获取可用IP列表失败")}finally{A.value=!1}},te=d=>{t.value=d},ae=()=>{if(t.value.length===0){v.warning("请选择要添加的IP");return}if(t.value.length>S.value){v.warning(`最多还可添加${S.value}个IP`);return}const d=t.value.map(o=>({ip:o.ip}));f.value=[...f.value,...d],t.value=[],b.value=[]},le=async()=>{if(k.value.count<=0){v.warning("请输入有效的分配数量");return}if(k.value.count>S.value){v.warning(`最多还可分配${S.value}个IP`);return}A.value=!0;try{const d=await L.getAvailableProtectionIps();if(d.code===200){const y=d.data.filter(w=>!(I.instanceData.addressType==="IPv4"&&w.type!=="IPv4"||I.instanceData.addressType==="IPv6"&&w.type!=="IPv6"||I.instanceData.isAnycast!==w.isAnycast||!I.instanceData.isAnycast&&I.instanceData.regionId&&w.region!==I.instanceData.regionId||f.value.some(F=>F.ip===w.ip))).sort(()=>.5-Math.random()).slice(0,k.value.count).map(w=>({ip:w.ip}));y.length>0?(f.value=[...f.value,...y],v.success(`已自动分配${y.length}个IP`)):v.warning("没有可用的IP可分配")}else v.error(d.message||"自动分配IP失败")}catch(d){console.error("自动分配IP失败:",d),v.error("自动分配IP失败")}finally{A.value=!1}},ne=()=>{if(!z.value.ip){v.warning("请输入IP地址");return}if(S.value<=0){v.warning("IP配额已用完");return}if(f.value.some(o=>o.ip===z.value.ip)){v.warning("该IP已添加");return}f.value.push({ip:z.value.ip}),z.value.ip=""},u=d=>{f.value.splice(d,1)},l=async()=>{if(I.instanceData)try{const d=f.value.map(y=>y.ip),o=await L.allocateProtectionIps(I.instanceData.instanceId,d);o.code===200?(v.success("分配成功"),h.value=!1,W("success")):v.error(o.message||"分配失败")}catch(d){console.error("分配防护IP失败:",d),v.error("分配防护IP失败")}},O=d=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[d]||d;return(d,o)=>{var re;const y=p("el-divider"),w=p("el-table-column"),F=p("el-button"),G=p("el-table"),R=p("el-empty"),s=p("el-radio"),n=p("el-radio-group"),N=p("el-input-number"),U=p("el-form-item"),Q=p("el-form"),E=p("el-option"),H=p("el-select"),r=p("el-input"),x=p("el-dialog"),oe=_e("loading");return g(),C(x,{modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=V=>h.value=V),title:`分配防护IP - ${((re=M.instanceData)==null?void 0:re.instanceName)||""}`,width:"60%","destroy-on-close":""},{footer:a(()=>[m("div",qe,[e(F,{onClick:X},{default:a(()=>o[21]||(o[21]=[i("取消")])),_:1,__:[21]}),e(F,{type:"primary",onClick:l},{default:a(()=>o[22]||(o[22]=[i("确认")])),_:1,__:[22]})])]),default:a(()=>[M.instanceData?(g(),q("div",xe,[m("div",Ae,[m("div",Te,[o[6]||(o[6]=m("span",{class:"label"},"业务实例ID:",-1)),m("span",null,B(M.instanceData.instanceId),1)]),m("div",he,[o[7]||(o[7]=m("span",{class:"label"},"客户名称:",-1)),m("span",null,B(M.instanceData.customerName),1)]),m("div",Se,[o[8]||(o[8]=m("span",{class:"label"},"地址类型:",-1)),m("span",null,B(O(M.instanceData.addressType)),1)]),m("div",Ue,[o[9]||(o[9]=m("span",{class:"label"},"IP数量配额:",-1)),m("span",null,B(M.instanceData.protectionIpCount),1)]),m("div",Be,[o[10]||(o[10]=m("span",{class:"label"},"已分配数量:",-1)),m("span",null,B(f.value.length),1)])]),e(y,{"content-position":"left"},{default:a(()=>o[11]||(o[11]=[i("当前已分配IP")])),_:1,__:[11]}),f.value.length>0?(g(),q("div",Fe,[e(G,{data:f.value,style:{width:"100%"},border:""},{default:a(()=>[e(w,{label:"IP地址",prop:"ip"}),e(w,{label:"操作",width:"100"},{default:a(V=>[e(F,{type:"danger",size:"small",onClick:ve=>u(V.$index)},{default:a(()=>o[12]||(o[12]=[i(" 移除 ")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):(g(),C(R,{key:1,description:"暂无已分配IP"})),e(y,{"content-position":"left"},{default:a(()=>o[13]||(o[13]=[i("分配新IP")])),_:1,__:[13]}),m("div",$e,[e(n,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=V=>_.value=V)},{default:a(()=>[e(s,{label:"auto"},{default:a(()=>o[14]||(o[14]=[i("自动分配")])),_:1,__:[14]}),e(s,{label:"pool"},{default:a(()=>o[15]||(o[15]=[i("从IP池选择")])),_:1,__:[15]}),e(s,{label:"manual"},{default:a(()=>o[16]||(o[16]=[i("手动输入")])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_.value==="auto"?(g(),q("div",ze,[e(Q,{model:k.value,"label-width":"120px"},{default:a(()=>[e(U,{label:"分配数量"},{default:a(()=>[e(N,{modelValue:k.value.count,"onUpdate:modelValue":o[1]||(o[1]=V=>k.value.count=V),min:1,max:S.value,disabled:S.value<=0},null,8,["modelValue","max","disabled"])]),_:1}),e(U,null,{default:a(()=>[e(F,{type:"primary",onClick:le,disabled:S.value<=0},{default:a(()=>o[17]||(o[17]=[i(" 自动分配 ")])),_:1,__:[17]},8,["disabled"])]),_:1})]),_:1},8,["model"])])):$("",!0),_.value==="pool"?(g(),q("div",Oe,[e(Q,{model:T.value,"label-width":"120px"},{default:a(()=>[e(U,{label:"IP类型"},{default:a(()=>[e(H,{modelValue:T.value.ipType,"onUpdate:modelValue":o[2]||(o[2]=V=>T.value.ipType=V),placeholder:"请选择IP类型"},{default:a(()=>[e(E,{label:"IPv4",value:"IPv4"}),e(E,{label:"IPv6",value:"IPv6"})]),_:1},8,["modelValue"])]),_:1}),M.instanceData.isAnycast?$("",!0):(g(),C(U,{key:0,label:"地域"},{default:a(()=>[e(H,{modelValue:T.value.regionId,"onUpdate:modelValue":o[3]||(o[3]=V=>T.value.regionId=V),placeholder:"请选择地域"},{default:a(()=>[(g(!0),q(ie,null,ue(D.value,V=>(g(),C(E,{key:V.regionId,label:V.regionName,value:V.regionId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),e(U,null,{default:a(()=>[e(F,{type:"primary",onClick:ee},{default:a(()=>o[18]||(o[18]=[i(" 查询可用IP ")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"]),e(y,{"content-position":"left"},{default:a(()=>o[19]||(o[19]=[i("可用IP列表")])),_:1,__:[19]}),J((g(),C(G,{data:b.value,style:{width:"100%"},border:"",onSelectionChange:te},{default:a(()=>[e(w,{type:"selection",width:"55"}),e(w,{label:"IP地址",prop:"ip"}),e(w,{label:"类型",prop:"type",width:"100"}),e(w,{label:"Anycast",width:"100"},{default:a(V=>[i(B(V.row.isAnycast?"是":"否"),1)]),_:1}),e(w,{label:"地域",prop:"region",width:"150"})]),_:1},8,["data"])),[[oe,A.value]]),b.value.length>0?(g(),q("div",Me,[e(F,{type:"primary",onClick:ae,disabled:t.value.length===0||t.value.length>S.value},{default:a(()=>[i(" 添加选中IP ("+B(t.value.length)+") ",1)]),_:1},8,["disabled"]),t.value.length>S.value?(g(),q("div",Re," 选择的IP数量超过剩余配额 ")):$("",!0)])):$("",!0)])):$("",!0),_.value==="manual"?(g(),q("div",Ee,[e(Q,{model:z.value,"label-width":"120px"},{default:a(()=>[e(U,{label:"IP地址"},{default:a(()=>[e(r,{modelValue:z.value.ip,"onUpdate:modelValue":o[4]||(o[4]=V=>z.value.ip=V),placeholder:"请输入IP地址",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),e(U,null,{default:a(()=>[e(F,{type:"primary",onClick:ne,disabled:!z.value.ip||S.value<=0},{default:a(()=>o[20]||(o[20]=[i(" 添加 ")])),_:1,__:[20]},8,["disabled"])]),_:1})]),_:1},8,["model"])])):$("",!0)])):$("",!0)]),_:1},8,["modelValue","title"])}}},je=fe(We,[["__scopeId","data-v-3428a2d0"]]),Le={class:"business-instance-container"},Ye={class:"card-header"},Qe={class:"search-area"},Je={class:"pagination-container"},Ke={class:"text-xs text-gray-500 mt-2"},Ge={class:"text-xs text-gray-500 mt-2"},He={__name:"BusinessInstance",setup(M){const Y=P(!1),I=P([]),W=P(!1),h=P(!1),A=P(!1),_=P(!1),t=P(!1),b=P(null),D=ce({keyword:"",dateRange:[]}),f=ce({pageNum:1,pageSize:10,total:0});Ie(()=>{k()});const k=async()=>{Y.value=!0;try{const s=await L.getBusinessInstances({pageNum:f.pageNum,pageSize:f.pageSize,keyword:D.keyword,dateRange:D.dateRange&&D.dateRange.length===2?D.dateRange:void 0});s.code===200?(I.value=s.data.list,f.total=s.data.total):v.error(s.message||"获取数据失败")}catch(s){console.error("获取业务实例列表失败:",s),v.error("获取业务实例列表失败")}finally{Y.value=!1}},T=()=>{f.pageNum=1,k()},z=()=>{D.keyword="",D.dateRange=[],f.pageNum=1,k()},S=s=>{f.pageSize=s,k()},K=s=>{f.pageNum=s,k()},X=()=>{b.value=null,t.value=!1,W.value=!0},Z=s=>{b.value={...s},t.value=!0,W.value=!0},ee=s=>{b.value={...s},A.value=!0},te=async()=>{try{const s=await L.enableBusinessInstance(b.value.instanceId);s.code===200?(v.success("启用成功"),A.value=!1,k()):v.error(s.message||"启用失败")}catch(s){console.error("启用业务实例失败:",s),v.error("启用业务实例失败")}},ae=s=>{b.value={...s},_.value=!0},le=async()=>{try{const s=await L.disableBusinessInstance(b.value.instanceId);s.code===200?(v.success("禁用成功"),_.value=!1,k()):v.error(s.message||"禁用失败")}catch(s){console.error("禁用业务实例失败:",s),v.error("禁用业务实例失败")}},ne=s=>{b.value=JSON.parse(JSON.stringify(s)),h.value=!0},u=s=>{we.confirm("确定要删除该业务实例吗？删除后无法恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const n=await L.deleteBusinessInstance(s.instanceId);n.code===200?(v.success("删除成功"),k()):v.error(n.message||"删除失败")}catch(n){console.error("删除业务实例失败:",n),v.error("删除业务实例失败")}}).catch(()=>{})},l=()=>{k()},O=()=>{k(),b.value=null,h.value=!1},d=(s,n)=>n.status===s,o=(s,n)=>n.isAnycast===s,y=(s,n)=>n.addressType===s,w=s=>({active:"success",inactive:"info"})[s]||"info",F=s=>({active:"已启用",inactive:"已禁用"})[s]||s,G=s=>({IPv4:"primary",IPv6:"success",dual:"warning"})[s]||"info",R=s=>({IPv4:"IPv4",IPv6:"IPv6",dual:"双栈"})[s]||s;return(s,n)=>{const N=p("el-button"),U=p("el-icon"),Q=p("el-input"),E=p("el-form-item"),H=p("el-date-picker"),r=p("el-form"),x=p("el-table-column"),oe=p("el-tag"),re=p("el-table"),V=p("el-pagination"),ve=p("el-card"),ge=p("el-dialog"),ye=_e("loading");return g(),q("div",Le,[e(ve,{class:"box-card"},{header:a(()=>[m("div",Ye,[n[11]||(n[11]=m("span",null,"业务实例管理",-1)),e(N,{type:"primary",onClick:X},{default:a(()=>n[10]||(n[10]=[i("新增业务实例")])),_:1,__:[10]})])]),default:a(()=>[m("div",Qe,[e(r,{inline:!0,model:D,class:"search-form"},{default:a(()=>[e(E,null,{default:a(()=>[e(Q,{modelValue:D.keyword,"onUpdate:modelValue":n[0]||(n[0]=c=>D.keyword=c),placeholder:"搜索业务实例名称/ID/客户名称/订单ID",clearable:"",onKeyup:be(T,["enter"])},{prefix:a(()=>[e(U,null,{default:a(()=>[e(Pe(ke))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(E,null,{default:a(()=>[e(H,{modelValue:D.dateRange,"onUpdate:modelValue":n[1]||(n[1]=c=>D.dateRange=c),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(E,null,{default:a(()=>[e(N,{type:"primary",onClick:T},{default:a(()=>n[12]||(n[12]=[i("搜索")])),_:1,__:[12]}),e(N,{onClick:z},{default:a(()=>n[13]||(n[13]=[i("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),J((g(),C(re,{data:I.value,border:"",stripe:"",style:{width:"100%","min-height":"320px"},"row-key":"instanceId","max-height":"500","row-class-name":"dense-row","header-cell-style":{position:"sticky",top:0,background:"#fff",zIndex:2}},{empty:a(()=>n[19]||(n[19]=[m("div",{class:"text-gray-400 py-10 text-center"},"暂无数据",-1)])),default:a(()=>[e(x,{prop:"instanceId",label:"业务实例ID",width:"150",fixed:"left"}),e(x,{prop:"instanceName",label:"业务实例名称","min-width":"150"}),e(x,{prop:"customerName",label:"客户名称","min-width":"180"}),e(x,{prop:"orderId",label:"订单ID",width:"150"}),e(x,{prop:"packageName",label:"套餐名称",width:"120"}),e(x,{label:"Anycast",width:"100",filters:[{text:"是",value:!0},{text:"否",value:!1}],"filter-method":o,"filter-placement":"bottom-end"},{default:a(({row:c})=>[e(oe,{type:c.isAnycast?"success":"info"},{default:a(()=>[i(B(c.isAnycast?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(x,{prop:"addressType",label:"地址类型",width:"100",filters:[{text:"IPv4",value:"IPv4"},{text:"IPv6",value:"IPv6"},{text:"双栈",value:"dual"}],"filter-method":y,"filter-placement":"bottom-end"},{default:a(({row:c})=>[e(oe,{type:G(c.addressType)},{default:a(()=>[i(B(R(c.addressType)),1)]),_:2},1032,["type"])]),_:1}),e(x,{prop:"bandwidth",label:"防护带宽(Mbps)",width:"140",sortable:""}),e(x,{prop:"businessBandwidth",label:"业务带宽(Mbps)",width:"140",sortable:""}),e(x,{prop:"qps",label:"业务QPS",width:"120",sortable:""}),e(x,{prop:"protectionIpCount",label:"防护IP数",width:"120",sortable:""}),e(x,{prop:"domainCount",label:"防护域名数",width:"120",sortable:""}),e(x,{prop:"portCount",label:"端口数量",width:"120",sortable:""}),e(x,{prop:"status",label:"状态",width:"100",filters:[{text:"已启用",value:"active"},{text:"已禁用",value:"inactive"}],"filter-method":d,"filter-placement":"bottom-end"},{default:a(({row:c})=>[e(oe,{type:w(c.status)},{default:a(()=>[i(B(F(c.status)),1)]),_:2},1032,["type"])]),_:1}),e(x,{prop:"createTime",label:"创建时间",width:"180",sortable:""}),e(x,{label:"操作",width:"320",fixed:"right"},{default:a(({row:c})=>[c.status==="inactive"?(g(),C(N,{key:0,type:"success",link:"",onClick:j=>ee(c)},{default:a(()=>n[14]||(n[14]=[i(" 启用 ")])),_:2,__:[14]},1032,["onClick"])):$("",!0),c.status==="active"?(g(),C(N,{key:1,type:"warning",link:"",onClick:j=>ae(c)},{default:a(()=>n[15]||(n[15]=[i(" 禁用 ")])),_:2,__:[15]},1032,["onClick"])):$("",!0),e(N,{type:"primary",link:"",onClick:j=>Z(c)},{default:a(()=>n[16]||(n[16]=[i(" 修改配置 ")])),_:2,__:[16]},1032,["onClick"]),e(N,{type:"primary",link:"",onClick:j=>ne(c)},{default:a(()=>n[17]||(n[17]=[i(" 分配防护IP ")])),_:2,__:[17]},1032,["onClick"]),e(N,{type:"danger",link:"",onClick:j=>u(c)},{default:a(()=>n[18]||(n[18]=[i(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,Y.value]]),m("div",Je,[e(V,{"current-page":f.pageNum,"onUpdate:currentPage":n[2]||(n[2]=c=>f.pageNum=c),"page-size":f.pageSize,"onUpdate:pageSize":n[3]||(n[3]=c=>f.pageSize=c),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:f.total,background:"",onSizeChange:S,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),_:1}),e(Ne,{modelValue:W.value,"onUpdate:modelValue":n[4]||(n[4]=c=>W.value=c),"instance-data":b.value,"is-edit":t.value,onSuccess:l},null,8,["modelValue","instance-data","is-edit"]),e(je,{modelValue:h.value,"onUpdate:modelValue":n[5]||(n[5]=c=>h.value=c),"instance-data":b.value,onSuccess:O},null,8,["modelValue","instance-data"]),e(ge,{modelValue:A.value,"onUpdate:modelValue":n[7]||(n[7]=c=>A.value=c),title:"确认启用",width:"400px"},{footer:a(()=>[e(N,{onClick:n[6]||(n[6]=c=>A.value=!1)},{default:a(()=>n[22]||(n[22]=[i("取消")])),_:1,__:[22]}),e(N,{type:"success",onClick:te},{default:a(()=>n[23]||(n[23]=[i("确认启用")])),_:1,__:[23]})]),default:a(()=>{var c,j;return[m("div",null,[n[20]||(n[20]=i("确定要启用业务实例 ")),m("b",null,B((c=b.value)==null?void 0:c.instanceName),1),n[21]||(n[21]=i(" 吗？"))]),m("div",Ke,"ID: "+B((j=b.value)==null?void 0:j.instanceId),1)]}),_:1},8,["modelValue"]),e(ge,{modelValue:_.value,"onUpdate:modelValue":n[9]||(n[9]=c=>_.value=c),title:"确认禁用",width:"400px"},{footer:a(()=>[e(N,{onClick:n[8]||(n[8]=c=>_.value=!1)},{default:a(()=>n[26]||(n[26]=[i("取消")])),_:1,__:[26]}),e(N,{type:"warning",onClick:le},{default:a(()=>n[27]||(n[27]=[i("确认禁用")])),_:1,__:[27]})]),default:a(()=>{var c,j;return[m("div",null,[n[24]||(n[24]=i("确定要禁用业务实例 ")),m("b",null,B((c=b.value)==null?void 0:c.instanceName),1),n[25]||(n[25]=i(" 吗？"))]),m("div",Ge,"ID: "+B((j=b.value)==null?void 0:j.instanceId),1)]}),_:1},8,["modelValue"])])}}},Ze=fe(He,[["__scopeId","data-v-295c9121"]]);export{Ze as default};
